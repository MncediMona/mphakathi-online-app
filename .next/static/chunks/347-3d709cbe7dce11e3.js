(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[347],{2394:function(e,t,r){"use strict";r.d(t,{I:function(){return a},a:function(){return n}});var i=r(2265),s=r(3876);function n(e={}){let t=a(e);if(e.projectIdMustMatch&&t.projectId!==e.projectIdMustMatch)throw Error("Unexpected project ID in useStackApp: "+t.projectId);return e.projectIdMustMatch,t.useUser(e)}function a(e={}){let t=(0,i.useContext)(s.SR);if(null===t)throw Error("useStackApp must be used within a StackProvider");let r=t.app;if(e.projectIdMustMatch&&r.projectId!==e.projectIdMustMatch)throw Error("Unexpected project ID in useStackApp: "+r.projectId);return r}},2917:function(e,t,r){"use strict";let i,s;function n(e){return 1e-5>Math.random()&&Math.random()>.99999&&1e-5>Math.random()&&Math.random()>.99999?"this will never happen":e}r.d(t,{f:function(){return sh}});var a,o,c,l,u,d,h=r(3408);function p(...e){return e}var m=r(5829),_=class extends h.vK{constructor(e,t,r){super(e,t),this.statusCode=e,this.humanReadableMessage=t,this.details=r,this.__stackKnownErrorBrand="stack-known-error-brand-sentinel",this.name="KnownError"}static isKnownError(e){return"object"==typeof e&&null!==e&&"__stackKnownErrorBrand"in e&&"stack-known-error-brand-sentinel"===e.__stackKnownErrorBrand}getBody(){return new TextEncoder().encode(JSON.stringify(this.toDescriptiveJson(),void 0,2))}getHeaders(){return{"Content-Type":["application/json; charset=utf-8"],"X-Stack-Known-Error":[this.errorCode]}}toDescriptiveJson(){return{code:this.errorCode,...this.details?{details:this.details}:{},error:this.humanReadableMessage}}get errorCode(){return this.constructor.errorCode??(0,h.fZ)(`Can't find error code for this KnownError. Is its constructor a KnownErrorConstructor? ${this}`)}static constructorArgsFromJson(e){return[400,e.message,e]}static fromJson(e){for(let[t,r]of Object.entries(ti))if(e.code===r.prototype.errorCode){let t=r.constructorArgsFromJson(e);return new r(...t)}throw Error(`Unknown KnownError code. You may need to update your version of Stack to see more detailed information. ${e.code}: ${e.message}`)}};function f(e,t,r,i){let s="inherit"===r?p:r,n="inherit"===i?e.constructorArgsFromJson:i;class a extends e{constructor(...e){super(...s(...e)),this.name=`KnownError<${t}>`,this.constructorArgs=e}static constructorArgsFromJson(e){return n(e.details)}static isInstance(e){if(!_.isKnownError(e))return!1;let r=e;for(;r=Object.getPrototypeOf(r);)if("errorCode"in r.constructor&&r.constructor.errorCode===t)return!0;return!1}}return a.errorCode=t,a}Symbol("knownErrorConstructorErrorCodeSentinel");var y=f(_,"UNSUPPORTED_ERROR",e=>[500,`An error occurred that is not currently supported (possibly because it was added in a version of Stack that is newer than this client). The original unsupported error code was: ${e}`,{originalErrorCode:e}],e=>[e?.originalErrorCode??(0,h.fZ)("originalErrorCode not found in UnsupportedError details")]),w=f(_,"BODY_PARSING_ERROR",e=>[400,e],e=>[e.message]),g=f(_,"SCHEMA_ERROR",e=>[400,e||(0,h.fZ)("SchemaError requires a message"),{message:e}],e=>[e.message]),T=f(_,"ALL_OVERLOADS_FAILED",e=>[400,(0,m.Ac)`
      This endpoint has multiple overloads, but they all failed to process the request.

        ${e.map((e,t)=>(0,m.Ac)`
          Overload ${t+1}: ${JSON.stringify(e,void 0,2)}
        `).join("\n\n")}
    `,{overload_errors:e}],e=>[e?.overload_errors??(0,h.fZ)("overload_errors not found in AllOverloadsFailed details")]),C=f(_,"PROJECT_AUTHENTICATION_ERROR","inherit","inherit"),k=f(C,"INVALID_PROJECT_AUTHENTICATION","inherit","inherit"),A=f(k,"PROJECT_KEY_WITHOUT_ACCESS_TYPE",()=>[400,"Either an API key or an admin access token was provided, but the x-stack-access-type header is missing. Set it to 'client', 'server', or 'admin' as appropriate."],()=>[]),v=f(k,"INVALID_ACCESS_TYPE",e=>[400,`The x-stack-access-type header must be 'client', 'server', or 'admin', but was '${e}'.`],e=>[e?.accessType??(0,h.fZ)("accessType not found in InvalidAccessType details")]),S=f(k,"ACCESS_TYPE_WITHOUT_PROJECT_ID",e=>[400,(0,m.Ac)`
      The x-stack-access-type header was '${e}', but the x-stack-project-id header was not provided.
      
      For more information, see the docs on REST API authentication: https://docs.stack-auth.com/rest-api/overview#authentication
    `,{request_type:e}],e=>[e.request_type]),E=f(k,"ACCESS_TYPE_REQUIRED",()=>[400,(0,m.Ac)`
      You must specify an access level for this Stack project. Make sure project API keys are provided (eg. x-stack-publishable-client-key) and you set the x-stack-access-type header to 'client', 'server', or 'admin'.
      
      For more information, see the docs on REST API authentication: https://docs.stack-auth.com/rest-api/overview#authentication
    `],()=>[]),b=f(k,"INSUFFICIENT_ACCESS_TYPE",(e,t)=>[401,`The x-stack-access-type header must be ${t.map(e=>`'${e}'`).join(" or ")}, but was '${e}'.`,{actual_access_type:e,allowed_access_types:t}],e=>[e.actual_access_type,e.allowed_access_types]),I=f(k,"INVALID_PUBLISHABLE_CLIENT_KEY",e=>[401,`The publishable key is not valid for the project ${JSON.stringify(e)}. Does the project and/or the key exist?`,{project_id:e}],e=>[e.project_id]),R=f(k,"INVALID_SECRET_SERVER_KEY",e=>[401,`The secret server key is not valid for the project ${JSON.stringify(e)}. Does the project and/or the key exist?`,{project_id:e}],e=>[e.project_id]),P=f(k,"INVALID_SUPER_SECRET_ADMIN_KEY",e=>[401,`The super secret admin key is not valid for the project ${JSON.stringify(e)}. Does the project and/or the key exist?`,{project_id:e}],e=>[e.project_id]),O=f(k,"INVALID_ADMIN_ACCESS_TOKEN","inherit","inherit"),U=f(O,"UNPARSABLE_ADMIN_ACCESS_TOKEN",()=>[401,"Admin access token is not parsable."],()=>[]),j=f(O,"ADMIN_ACCESS_TOKEN_EXPIRED",e=>[401,`Admin access token has expired. Please refresh it and try again.${e?` (The access token expired at ${e.toISOString()}.)`:""}`,{expired_at_millis:e?.getTime()??null}],e=>[e.expired_at_millis??void 0]),N=f(O,"INVALID_PROJECT_FOR_ADMIN_ACCESS_TOKEN",()=>[401,"Admin access tokens must be created on the internal project."],()=>[]),x=f(O,"ADMIN_ACCESS_TOKEN_IS_NOT_ADMIN",()=>[401,"Admin access token does not have the required permissions to access this project."],()=>[]),D=f(C,"PROJECT_AUTHENTICATION_REQUIRED","inherit","inherit"),M=f(D,"CLIENT_AUTHENTICATION_REQUIRED",()=>[401,"The publishable client key must be provided."],()=>[]),K=f(D,"SERVER_AUTHENTICATION_REQUIRED",()=>[401,"The secret server key must be provided."],()=>[]),L=f(D,"CLIENT_OR_SERVER_AUTHENTICATION_REQUIRED",()=>[401,"Either the publishable client key or the secret server key must be provided."],()=>[]),$=f(D,"CLIENT_OR_ADMIN_AUTHENTICATION_REQUIRED",()=>[401,"Either the publishable client key or the super secret admin key must be provided."],()=>[]),q=f(D,"CLIENT_OR_SERVER_OR_ADMIN_AUTHENTICATION_REQUIRED",()=>[401,"Either the publishable client key, the secret server key, or the super secret admin key must be provided."],()=>[]),F=f(D,"ADMIN_AUTHENTICATION_REQUIRED",()=>[401,"The super secret admin key must be provided."],()=>[]),J=f(C,"EXPECTED_INTERNAL_PROJECT",()=>[401,"The project ID is expected to be internal."],()=>[]),W=f(_,"SESSION_AUTHENTICATION_ERROR","inherit","inherit"),H=f(W,"INVALID_SESSION_AUTHENTICATION","inherit","inherit"),V=f(H,"INVALID_ACCESS_TOKEN","inherit","inherit"),B=f(V,"UNPARSABLE_ACCESS_TOKEN",()=>[401,"Access token is not parsable."],()=>[]),Y=f(V,"ACCESS_TOKEN_EXPIRED",e=>[401,`Access token has expired. Please refresh it and try again.${e?` (The access token expired at ${e.toISOString()}.)`:""}`,{expired_at_millis:e?.getTime()??null}],e=>[e.expired_at_millis?new Date(e.expired_at_millis):void 0]),G=f(V,"INVALID_PROJECT_FOR_ACCESS_TOKEN",(e,t)=>[401,`Access token not valid for this project. Expected project ID ${JSON.stringify(e)}, but the token is for project ID ${JSON.stringify(t)}.`,{expected_project_id:e,actual_project_id:t}],e=>[e.expected_project_id,e.actual_project_id]),z=f(_,"REFRESH_TOKEN_ERROR","inherit","inherit"),X=f(z,"REFRESH_TOKEN_NOT_FOUND_OR_EXPIRED",()=>[401,"Refresh token not found for this project, or the session has expired/been revoked."],()=>[]),Z=f(z,"CANNOT_DELETE_CURRENT_SESSION",()=>[400,"Cannot delete the current session."],()=>[]),Q=f(z,"PROVIDER_REJECTED",()=>[401,"The provider refused to refresh their token. This usually means that the provider used to authenticate the user no longer regards this session as valid, and the user must re-authenticate."],()=>[]),ee=f(_,"USER_EMAIL_ALREADY_EXISTS",e=>[409,`A user with email ${JSON.stringify(e)} already exists.`,{email:e}],e=>[e.email]),et=f(_,"EMAIL_NOT_VERIFIED",()=>[400,"The email is not verified."],()=>[]),er=f(_,"CANNOT_GET_OWN_USER_WITHOUT_USER",()=>[400,"You have specified 'me' as a userId, but did not provide authentication for a user."],()=>[]),ei=f(_,"USER_ID_DOES_NOT_EXIST",e=>[400,`The given user with the ID ${e} does not exist.`,{user_id:e}],e=>[e.user_id]),es=f(_,"USER_NOT_FOUND",()=>[404,"User not found."],()=>[]),en=f(_,"PROJECT_NOT_FOUND",e=>{if("string"!=typeof e)throw new h.AJ("projectId of KnownErrors.ProjectNotFound must be a string");return[404,`Project ${e} not found or is not accessible with the current user.`,{project_id:e}]},e=>[e.project_id]),ea=f(_,"BRANCH_DOES_NOT_EXIST",e=>[400,`The branch with ID ${e} does not exist.`,{branch_id:e}],e=>[e.branch_id]),eo=f(_,"SIGN_UP_NOT_ENABLED",()=>[400,"Creation of new accounts is not enabled for this project. Please ask the project owner to enable it."],()=>[]),ec=f(_,"PASSWORD_AUTHENTICATION_NOT_ENABLED",()=>[400,"Password authentication is not enabled for this project."],()=>[]),el=f(_,"PASSKEY_AUTHENTICATION_NOT_ENABLED",()=>[400,"Passkey authentication is not enabled for this project."],()=>[]),eu=f(_,"ANONYMOUS_ACCOUNTS_NOT_ENABLED",()=>[400,"Anonymous accounts are not enabled for this project."],()=>[]),ed=f(_,"EMAIL_PASSWORD_MISMATCH",()=>[400,"Wrong e-mail or password."],()=>[]),eh=f(_,"REDIRECT_URL_NOT_WHITELISTED",()=>[400,"Redirect URL not whitelisted. Did you forget to add this domain to the trusted domains list on the Stack Auth dashboard?"],()=>[]),ep=f(_,"PASSWORD_REQUIREMENTS_NOT_MET","inherit","inherit"),em=f(ep,"PASSWORD_TOO_SHORT",e=>[400,`Password too short. Minimum length is ${e}.`,{min_length:e}],e=>[e?.min_length??(0,h.fZ)("min_length not found in PasswordTooShort details")]),e_=f(ep,"PASSWORD_TOO_LONG",e=>[400,`Password too long. Maximum length is ${e}.`,{maxLength:e}],e=>[e?.maxLength??(0,h.fZ)("maxLength not found in PasswordTooLong details")]),ef=f(_,"USER_DOES_NOT_HAVE_PASSWORD",()=>[400,"This user does not have password authentication enabled."],()=>[]),ey=f(_,"VERIFICATION_ERROR","inherit","inherit"),ew=f(ey,"VERIFICATION_CODE_NOT_FOUND",()=>[404,"The verification code does not exist for this project."],()=>[]),eg=f(ey,"VERIFICATION_CODE_EXPIRED",()=>[400,"The verification code has expired."],()=>[]),eT=f(ey,"VERIFICATION_CODE_ALREADY_USED",()=>[409,"The verification link has already been used."],()=>[]),eC=f(ey,"VERIFICATION_CODE_MAX_ATTEMPTS_REACHED",()=>[400,"The verification code nonce has reached the maximum number of attempts. This code is not valid anymore."],()=>[]),ek=f(_,"PASSWORD_CONFIRMATION_MISMATCH",()=>[400,"Passwords do not match."],()=>[]),eA=f(_,"EMAIL_ALREADY_VERIFIED",()=>[409,"The e-mail is already verified."],()=>[]),ev=f(_,"EMAIL_NOT_ASSOCIATED_WITH_USER",()=>[400,"The e-mail is not associated with a user that could log in with that e-mail."],()=>[]),eS=f(_,"EMAIL_IS_NOT_PRIMARY_EMAIL",(e,t)=>[400,`The given e-mail (${e}) must equal the user's primary e-mail (${t}).`,{email:e,primary_email:t}],e=>[e.email,e.primary_email]),eE=f(_,"PASSKEY_REGISTRATION_FAILED",e=>[400,e],e=>[e.message]),eb=f(_,"PASSKEY_WEBAUTHN_ERROR",(e,t)=>[400,e,{message:e,code:t}],e=>[e.message,e.code]),eI=f(_,"PASSKEY_AUTHENTICATION_FAILED",e=>[400,e],e=>[e.message]),eR=f(_,"PERMISSION_NOT_FOUND",e=>[404,`Permission "${e}" not found. Make sure you created it on the dashboard.`,{permission_id:e}],e=>[e.permission_id]),eP=f(_,"WRONG_PERMISSION_SCOPE",(e,t,r)=>[404,`Permission ${JSON.stringify(e)} not found. (It was found for a different scope ${JSON.stringify(r)}, but scope ${JSON.stringify(t)} was expected.)`,{permission_id:e,expected_scope:t,actual_scope:r}],e=>[e.permission_id,e.expected_scope,e.actual_scope]),eO=f(_,"CONTAINED_PERMISSION_NOT_FOUND",e=>[400,`Contained permission with ID "${e}" not found. Make sure you created it on the dashboard.`,{permission_id:e}],e=>[e.permission_id]),eU=f(_,"TEAM_NOT_FOUND",e=>[404,`Team ${e} not found.`,{team_id:e}],e=>[e.team_id]);f(_,"TEAM_ALREADY_EXISTS",e=>[409,`Team ${e} already exists.`,{team_id:e}],e=>[e.team_id]);var ej=f(_,"TEAM_MEMBERSHIP_NOT_FOUND",(e,t)=>[404,`User ${t} is not found in team ${e}.`,{team_id:e,user_id:t}],e=>[e.team_id,e.user_id]),eN=f(_,"EMAIL_TEMPLATE_ALREADY_EXISTS",()=>[409,"Email template already exists."],()=>[]),ex=f(_,"OAUTH_CONNECTION_NOT_CONNECTED_TO_USER",()=>[400,"The OAuth connection is not connected to any user."],()=>[]),eD=f(_,"OAUTH_CONNECTION_ALREADY_CONNECTED_TO_ANOTHER_USER",()=>[409,"The OAuth connection is already connected to another user."],()=>[]),eM=f(_,"OAUTH_CONNECTION_DOES_NOT_HAVE_REQUIRED_SCOPE",()=>[400,"The OAuth connection does not have the required scope."],()=>[]),eK=f(_,"OAUTH_EXTRA_SCOPE_NOT_AVAILABLE_WITH_SHARED_OAUTH_KEYS",()=>[400,"Extra scopes are not available with shared OAuth keys. Please add your own OAuth keys on the Stack dashboard to use extra scopes."],()=>[]),eL=f(_,"OAUTH_ACCESS_TOKEN_NOT_AVAILABLE_WITH_SHARED_OAUTH_KEYS",()=>[400,"Access tokens are not available with shared OAuth keys. Please add your own OAuth keys on the Stack dashboard to use access tokens."],()=>[]),e$=f(_,"INVALID_OAUTH_CLIENT_ID_OR_SECRET",e=>[400,"The OAuth client ID or secret is invalid. The client ID must be equal to the project ID (potentially with a hash and a branch ID), and the client secret must be a publishable client key.",{client_id:e??null}],e=>[e.client_id??void 0]),eq=f(_,"INVALID_SCOPE",e=>[400,`The scope "${e}" is not a valid OAuth scope for Stack.`],e=>[e.scope]),eF=f(_,"USER_ALREADY_CONNECTED_TO_ANOTHER_OAUTH_CONNECTION",()=>[409,"The user is already connected to another OAuth account. Did you maybe selected the wrong account?"],()=>[]),eJ=f(_,"OUTER_OAUTH_TIMEOUT",()=>[408,"The OAuth flow has timed out. Please sign in again."],()=>[]),eW=f(_,"OAUTH_PROVIDER_NOT_FOUND_OR_NOT_ENABLED",()=>[400,"The OAuth provider is not found or not enabled."],()=>[]),eH=f(_,"MULTI_FACTOR_AUTHENTICATION_REQUIRED",e=>[400,"Multi-factor authentication is required for this user.",{attempt_code:e}],e=>[e.attempt_code]),eV=f(_,"INVALID_TOTP_CODE",()=>[400,"The TOTP code is invalid. Please try again."],()=>[]),eB=f(_,"USER_AUTHENTICATION_REQUIRED",()=>[401,"User authentication required for this endpoint."],()=>[]),eY=f(_,"TEAM_MEMBERSHIP_ALREADY_EXISTS",()=>[409,"Team membership already exists."],()=>[]),eG=f(_,"PROJECT_PERMISSION_REQUIRED",(e,t)=>[401,`User ${e} does not have permission ${t}.`,{user_id:e,permission_id:t}],e=>[e.user_id,e.permission_id]),ez=f(_,"TEAM_PERMISSION_REQUIRED",(e,t,r)=>[401,`User ${t} does not have permission ${r} in team ${e}.`,{team_id:e,user_id:t,permission_id:r}],e=>[e.team_id,e.user_id,e.permission_id]),eX=f(_,"TEAM_PERMISSION_NOT_FOUND",(e,t,r)=>[401,`User ${t} does not have permission ${r} in team ${e}.`,{team_id:e,user_id:t,permission_id:r}],e=>[e.team_id,e.user_id,e.permission_id]),eZ=f(_,"INVALID_SHARED_OAUTH_PROVIDER_ID",e=>[400,`The shared OAuth provider with ID ${e} is not valid.`,{provider_id:e}],e=>[e.provider_id]),eQ=f(_,"INVALID_STANDARD_OAUTH_PROVIDER_ID",e=>[400,`The standard OAuth provider with ID ${e} is not valid.`,{provider_id:e}],e=>[e.provider_id]),e0=f(_,"INVALID_AUTHORIZATION_CODE",()=>[400,"The given authorization code is invalid."],()=>[]),e1=f(_,"OAUTH_PROVIDER_ACCESS_DENIED",()=>[400,"The OAuth provider denied access to the user."],()=>[]),e4=f(_,"CONTACT_CHANNEL_ALREADY_USED_FOR_AUTH_BY_SOMEONE_ELSE",(e,t)=>[409,t?`The ${e} (${t}) is already used for authentication by another account.`:`This ${e} is already used for authentication by another account.`,{type:e,contact_channel_value:t??null}],e=>[e.type,e.contact_channel_value]),e2=f(_,"INVALID_POLLING_CODE",e=>[400,"The polling code is invalid or does not exist.",e],e=>[e]),e5=f(_,"CLI_AUTH_ERROR",e=>[400,e],e=>[e.message]),e3=f(_,"CLI_AUTH_EXPIRED_ERROR",(e="CLI authentication request expired. Please try again.")=>[400,e],e=>[e.message]),e9=f(_,"CLI_AUTH_USED_ERROR",(e="This authentication token has already been used.")=>[400,e],e=>[e.message]),e6=f(_,"API_KEY_NOT_VALID","inherit","inherit"),e8=f(e6,"API_KEY_EXPIRED",()=>[401,"API key has expired."],()=>[]),e7=f(e6,"API_KEY_REVOKED",()=>[401,"API key has been revoked."],()=>[]),te=f(e6,"WRONG_API_KEY_TYPE",(e,t)=>[400,`This endpoint is for ${e} API keys, but a ${t} API key was provided.`,{expected_type:e,actual_type:t}],e=>[e.expected_type,e.actual_type]),tt=f(e6,"API_KEY_NOT_FOUND",()=>[404,"API key not found."],()=>[]),tr=f(e6,"PUBLIC_API_KEY_CANNOT_BE_REVOKED",()=>[400,"Public API keys cannot be revoked by the secretscanner endpoint."],()=>[]),ti={CannotDeleteCurrentSession:Z,UnsupportedError:y,BodyParsingError:w,SchemaError:g,AllOverloadsFailed:T,ProjectAuthenticationError:C,PermissionIdAlreadyExists:f(_,"PERMISSION_ID_ALREADY_EXISTS",e=>[400,`Permission with ID "${e}" already exists. Choose a different ID.`,{permission_id:e}],e=>[e.permission_id]),CliAuthError:e5,CliAuthExpiredError:e3,CliAuthUsedError:e9,InvalidProjectAuthentication:k,ProjectKeyWithoutAccessType:A,InvalidAccessType:v,AccessTypeWithoutProjectId:S,AccessTypeRequired:E,CannotGetOwnUserWithoutUser:er,InsufficientAccessType:b,InvalidPublishableClientKey:I,InvalidSecretServerKey:R,InvalidSuperSecretAdminKey:P,InvalidAdminAccessToken:O,UnparsableAdminAccessToken:U,AdminAccessTokenExpired:j,InvalidProjectForAdminAccessToken:N,AdminAccessTokenIsNotAdmin:x,ProjectAuthenticationRequired:D,ClientAuthenticationRequired:M,ServerAuthenticationRequired:K,ClientOrServerAuthenticationRequired:L,ClientOrAdminAuthenticationRequired:$,ClientOrServerOrAdminAuthenticationRequired:q,AdminAuthenticationRequired:F,ExpectedInternalProject:J,SessionAuthenticationError:W,InvalidSessionAuthentication:H,InvalidAccessToken:V,UnparsableAccessToken:B,AccessTokenExpired:Y,InvalidProjectForAccessToken:G,RefreshTokenError:z,ProviderRejected:Q,RefreshTokenNotFoundOrExpired:X,UserWithEmailAlreadyExists:ee,EmailNotVerified:et,UserIdDoesNotExist:ei,UserNotFound:es,ApiKeyNotFound:tt,PublicApiKeyCannotBeRevoked:tr,ProjectNotFound:en,BranchDoesNotExist:ea,SignUpNotEnabled:eo,PasswordAuthenticationNotEnabled:ec,PasskeyAuthenticationNotEnabled:el,AnonymousAccountsNotEnabled:eu,EmailPasswordMismatch:ed,RedirectUrlNotWhitelisted:eh,PasswordRequirementsNotMet:ep,PasswordTooShort:em,PasswordTooLong:e_,UserDoesNotHavePassword:ef,VerificationCodeError:ey,VerificationCodeNotFound:ew,VerificationCodeExpired:eg,VerificationCodeAlreadyUsed:eT,VerificationCodeMaxAttemptsReached:eC,PasswordConfirmationMismatch:ek,EmailAlreadyVerified:eA,EmailNotAssociatedWithUser:ev,EmailIsNotPrimaryEmail:eS,PasskeyRegistrationFailed:eE,PasskeyWebAuthnError:eb,PasskeyAuthenticationFailed:eI,PermissionNotFound:eR,PermissionScopeMismatch:eP,ContainedPermissionNotFound:eO,TeamNotFound:eU,TeamMembershipNotFound:ej,EmailTemplateAlreadyExists:eN,OAuthConnectionNotConnectedToUser:ex,OAuthConnectionAlreadyConnectedToAnotherUser:eD,OAuthConnectionDoesNotHaveRequiredScope:eM,OAuthExtraScopeNotAvailableWithSharedOAuthKeys:eK,OAuthAccessTokenNotAvailableWithSharedOAuthKeys:eL,InvalidOAuthClientIdOrSecret:e$,InvalidScope:eq,UserAlreadyConnectedToAnotherOAuthConnection:eF,OuterOAuthTimeout:eJ,OAuthProviderNotFoundOrNotEnabled:eW,MultiFactorAuthenticationRequired:eH,InvalidTotpCode:eV,UserAuthenticationRequired:eB,TeamMembershipAlreadyExists:eY,ProjectPermissionRequired:eG,TeamPermissionRequired:ez,InvalidSharedOAuthProviderId:eZ,InvalidStandardOAuthProviderId:eQ,InvalidAuthorizationCode:e0,TeamPermissionNotFound:eX,OAuthProviderAccessDenied:e1,ContactChannelAlreadyUsedForAuthBySomeoneElse:e4,InvalidPollingCodeError:e2,ApiKeyNotValid:e6,ApiKeyExpired:e8,ApiKeyRevoked:e7,WrongApiKeyType:te},ts=new Set;for(let[e,t]of Object.entries(ti)){if(ts.has(t.errorCode))throw Error(`Duplicate known error code: ${t.errorCode}`);ts.add(t.errorCode)}var tn=r(7974),ta=class{constructor(e){"undefined"==typeof WeakRef?this._ref={deref:()=>e}:this._ref=new WeakRef(e)}deref(){return this._ref.deref()}},to=class{constructor(e){this[a]="IterableWeakMap";let t=e?.map(e=>[e[0],{value:e[1],keyRef:new ta(e[0])}]);this._weakMap=new WeakMap(t??[]),this._keyRefs=new Set(t?.map(e=>e[1].keyRef)??[])}get(e){return this._weakMap.get(e)?.value}set(e,t){let r=this._weakMap.get(e),i={value:t,keyRef:r?.keyRef??new ta(e)};return this._weakMap.set(e,i),this._keyRefs.add(i.keyRef),this}delete(e){let t=this._weakMap.get(e);return!!t&&(this._weakMap.delete(e),this._keyRefs.delete(t.keyRef),!0)}has(e){return this._weakMap.has(e)&&this._keyRefs.has(this._weakMap.get(e).keyRef)}*[(o=Symbol.iterator,a=Symbol.toStringTag,o)](){for(let e of this._keyRefs){let t=e.deref(),r=t?this._weakMap.get(t):void 0;t?r&&(yield[t,r.value]):this._keyRefs.delete(e)}}},tc=class{constructor(e){this[c]="MaybeWeakMap";let t=[...e??[]];this._primitiveMap=new Map(t.filter(e=>!this._isAllowedInWeakMap(e[0]))),this._weakMap=new to(t.filter(e=>this._isAllowedInWeakMap(e[0])))}_isAllowedInWeakMap(e){return"object"==typeof e&&null!==e||"symbol"==typeof e&&void 0===Symbol.keyFor(e)}get(e){return this._isAllowedInWeakMap(e)?this._weakMap.get(e):this._primitiveMap.get(e)}set(e,t){return this._isAllowedInWeakMap(e)?this._weakMap.set(e,t):this._primitiveMap.set(e,t),this}delete(e){return this._isAllowedInWeakMap(e)?this._weakMap.delete(e):this._primitiveMap.delete(e)}has(e){return this._isAllowedInWeakMap(e)?this._weakMap.has(e):this._primitiveMap.has(e)}*[(l=Symbol.iterator,c=Symbol.toStringTag,l)](){yield*this._primitiveMap,yield*this._weakMap}},tl=class{constructor(){this._inner={map:new tc,hasValue:!1,value:void 0},this[u]="DependenciesMap"}_valueToResult(e){return e.hasValue?tv.ok(e.value):tv.error(void 0)}_unwrapFromInner(e,t){if(0===e.length)return this._valueToResult(t);{let[r,...i]=e,s=t.map.get(r);return s?this._unwrapFromInner(i,s):tv.error(void 0)}}_setInInner(e,t,r){if(0===e.length){let e=this._valueToResult(r);return"ok"===t.status?(r.hasValue=!0,r.value=t.data):(r.hasValue=!1,r.value=void 0),e}{let[i,...s]=e,n=r.map.get(i);return n||r.map.set(i,n={map:new tc,hasValue:!1,value:void 0}),this._setInInner(s,t,n)}}*_iterateInner(e,t){for(let[r,i]of(t.hasValue&&(yield[e,t.value]),t.map))yield*this._iterateInner([...e,r],i)}get(e){return tv.or(this._unwrapFromInner(e,this._inner),void 0)}set(e,t){return this._setInInner(e,tv.ok(t),this._inner),this}delete(e){return"ok"===this._setInInner(e,tv.error(void 0),this._inner).status}has(e){return"ok"===this._unwrapFromInner(e,this._inner).status}clear(){this._inner={map:new tc,hasValue:!1,value:void 0}}*[(d=Symbol.iterator,u=Symbol.toStringTag,d)](){yield*this._iterateInner([],this._inner)}},tu="0123456789ABCDEFGHJKMNPQRSTVWXYZ";function td(e){if(e<0||e>=tu.length)throw new h.AJ(`Invalid base32 index: ${e}`);return tu[e]}function th(e){return btoa(String.fromCharCode(...e))}var tp=r(5250);function tm(e){if(!tp.z.crypto)throw new h.AJ("Crypto API is not available in this environment. Are you using an old browser?");if(!tp.z.crypto.getRandomValues)throw new h.AJ("crypto.getRandomValues is not available in this environment. Are you using an old browser?");return tp.z.crypto.getRandomValues(e)}function t_(e=224){let t=Math.ceil(e/5),r=function(e){let t=0,r=0,i="";for(let s=0;s<e.length;s++)for(r=r<<8|e[s],t+=8;t>=5;)i+=td(r>>>t-5&31),t-=5;if(t>0&&(i+=td(r<<5-t&31)),!function(e){for(let t of e){if(" "===t)continue;let e=t.toUpperCase();if(!tu.includes(e))return!1}return!0}(i))throw new h.AJ("Invalid base32 output; this should never happen");return i}(tm(new Uint8Array(Math.ceil(5*t/8))));return r.slice(r.length-t).toLowerCase()}function tf(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^tm(new Uint8Array(1))[0]&15>>+e/4).toString(16))}r(257);var ty=null;function tw(e){if((ty??=new tl).has([e]))return ty.get([e]);let t=Object.assign(Promise.resolve(e),{status:"fulfilled",value:e});return ty.set([e],t),t}var tg=null,tT=tC(new Promise(()=>{}));function tC(e,t={}){let r=e.then(e=>(r.status="fulfilled",r.value=e,e),e=>{throw r.status="rejected",r.reason=e,e});return r.status="pending",r}async function tk(e){if(!Number.isFinite(e)||e<0)throw new h.AJ(`wait() requires a non-negative integer number of milliseconds to wait. (found: ${e}ms)`);if(e>=2147483648)throw new h.AJ("The maximum timeout for wait() is 2147483647ms (2**31 - 1). (found: ${ms}ms)");return await new Promise(t=>setTimeout(t,e))}function tA(e,t={}){"function"==typeof e&&(e=e());let r=Error();e?.catch(e=>{t.onError?.(e);let i=new h.AJ("Uncaught error in asynchronous function: "+e.toString(),{cause:e});h.PV(i,r),t.noErrorLogging||h.O7("runAsynchronously",i)})}var tv={fromThrowing:tb,fromThrowingAsync:tI,fromPromise:tE,ok:e=>({status:"ok",data:e}),error:e=>({status:"error",error:e}),map:tR,or:(e,t)=>"ok"===e.status?e.data:t,orThrow:e=>{if("error"===e.status)throw e.error;return e.data},orThrowAsync:async e=>tv.orThrow(await e),retry:tO},tS={fromThrowing:tb,fromPromise:tE,ok:tv.ok,error:tv.error,pending:function(e){return{status:"pending",progress:e}},map:tR,or:(e,t)=>"pending"===e.status?t:tv.or(e,t),orThrow:e=>{if("pending"===e.status)throw Error("Result still pending");return tv.orThrow(e)},retry:tO};async function tE(e){try{let t=await e;return tv.ok(t)}catch(e){return tv.error(e)}}function tb(e){try{return tv.ok(e())}catch(e){return tv.error(e)}}async function tI(e){try{return tv.ok(await e())}catch(e){return tv.error(e)}}function tR(e,t){return"error"===e.status?{status:"error",error:e.error}:"pending"===e.status?{status:"pending",..."progress"in e?{progress:e.progress}:{}}:tv.ok(t(e.data))}var tP=class extends AggregateError{constructor(e){let t=e.map(e=>(0,m.NZ)(e));super(e,(0,m.Ac)`
      Error after ${e.length} attempts.
      
      ${t.length>1&&t.every(e=>e===t[0])?(0,m.Ac)`
        Attempts 1-${e.length}:
          ${t[0]}
      `:t.map((e,t)=>(0,m.Ac)`
          Attempt ${t+1}:
            ${e}
        `).join("\n\n")}
      `,{cause:e[e.length-1]}),this.errors=e,this.name="RetryError"}get attempts(){return this.errors.length}};async function tO(e,t,{exponentialDelayBase:r=1e3}={}){let i=[];for(let s=0;s<t;s++){let n=await e(s);if("ok"===n.status)return Object.assign(tv.ok(n.data),{attempts:s+1});i.push(n.error),s<t-1&&await tk((Math.random()+.5)*r*2**s)}return Object.assign(tv.error(new tP(i)),{attempts:t})}function tU(...e){try{return new URL(...e)}catch(e){return null}}function tj(e){return e.pathname+e.search+e.hash}function tN(e,...t){return(0,m.yz)(e,...t.map(encodeURIComponent))}function tx(e,t){if(null==e)return!1;try{return e instanceof t||Object.getPrototypeOf(e)[Symbol.toStringTag]===t.prototype[Symbol.toStringTag]}catch{return!1}}tP.prototype.name="RetryError","undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(i="oauth4webapi/v2.17.0");let tD=Symbol(),tM=Symbol(),tK=Symbol(),tL=Symbol(),t$=Symbol();Symbol();let tq=Symbol(),tF=new TextEncoder,tJ=new TextDecoder;function tW(e){return"string"==typeof e?tF.encode(e):tJ.decode(e)}function tH(e){return"string"==typeof e?function(e){try{let t=atob(e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}catch(e){throw new tG("The input to be decoded is not correctly encoded.",{cause:e})}}(e):function(e){e instanceof ArrayBuffer&&(e=new Uint8Array(e));let t=[];for(let r=0;r<e.byteLength;r+=32768)t.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return btoa(t.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(e)}class tV{constructor(e){this.cache=new Map,this._cache=new Map,this.maxSize=e}get(e){let t=this.cache.get(e);return t||((t=this._cache.get(e))?(this.update(e,t),t):void 0)}has(e){return this.cache.has(e)||this._cache.has(e)}set(e,t){return this.cache.has(e)?this.cache.set(e,t):this.update(e,t),this}delete(e){return this.cache.has(e)?this.cache.delete(e):!!this._cache.has(e)&&this._cache.delete(e)}update(e,t){this.cache.set(e,t),this.cache.size>=this.maxSize&&(this._cache=this.cache,this.cache=new Map)}}class tB extends Error{constructor(e){super(e??"operation not supported"),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class tY extends Error{constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}let tG=tY,tz=new tV(100);function tX(e){return e instanceof CryptoKey}function tZ(e){return tX(e)&&"private"===e.type}function tQ(e){try{let t=e.headers.get("dpop-nonce");t&&tz.set(new URL(e.url).origin,t)}catch{}return e}function t0(e){return!(null===e||"object"!=typeof e||Array.isArray(e))}function t1(e){return"string"==typeof e&&0!==e.length}function t4(){return tH(crypto.getRandomValues(new Uint8Array(32)))}async function t2(e){if(!t1(e))throw TypeError('"codeVerifier" must be a non-empty string');return tH(await crypto.subtle.digest("SHA-256",tW(e)))}function t5(e){return encodeURIComponent(e).replace(/%20/g,"+")}function t3(e){switch(e.algorithm.name){case"RSA-PSS":return function(e){switch(e.algorithm.hash.name){case"SHA-256":return"PS256";case"SHA-384":return"PS384";case"SHA-512":return"PS512";default:throw new tB("unsupported RsaHashedKeyAlgorithm hash name")}}(e);case"RSASSA-PKCS1-v1_5":return function(e){switch(e.algorithm.hash.name){case"SHA-256":return"RS256";case"SHA-384":return"RS384";case"SHA-512":return"RS512";default:throw new tB("unsupported RsaHashedKeyAlgorithm hash name")}}(e);case"ECDSA":return function(e){switch(e.algorithm.namedCurve){case"P-256":return"ES256";case"P-384":return"ES384";case"P-521":return"ES512";default:throw new tB("unsupported EcKeyAlgorithm namedCurve")}}(e);case"Ed25519":case"Ed448":return"EdDSA";default:throw new tB("unsupported CryptoKey algorithm name")}}function t9(e){let t=e?.[tD];return"number"==typeof t&&Number.isFinite(t)?t:0}function t6(){return Math.floor(Date.now()/1e3)}async function t8(e,t,r,i,s){let n={alg:t3(r),kid:i},a=function(e,t){let r=t6()+t9(t);return{jti:t4(),aud:[e.issuer,e.token_endpoint],exp:r+60,iat:r,nbf:r,iss:t.client_id,sub:t.client_id}}(e,t);return s?.(n,a),rn(n,a,r)}function t7(e){if("object"!=typeof e||null===e)throw TypeError('"as" must be an object');if(!t1(e.issuer))throw TypeError('"as.issuer" property must be a non-empty string');return!0}function re(e){if("object"!=typeof e||null===e)throw TypeError('"client" must be an object');if(!t1(e.client_id))throw TypeError('"client.client_id" property must be a non-empty string');return!0}function rt(e){if(!t1(e))throw TypeError('"client.client_secret" property must be a non-empty string');return e}function rr(e,t){if(void 0!==t)throw TypeError(`"options.clientPrivateKey" property must not be provided when ${e} client authentication method is used.`)}function ri(e,t){if(void 0!==t)throw TypeError(`"client.client_secret" property must not be provided when ${e} client authentication method is used.`)}async function rs(e,t,r,i,s){switch(r.delete("client_secret"),r.delete("client_assertion_type"),r.delete("client_assertion"),t.token_endpoint_auth_method){case void 0:case"client_secret_basic":rr("client_secret_basic",s),i.set("authorization",function(e,t){let r=t5(e),i=t5(t),s=btoa(`${r}:${i}`);return`Basic ${s}`}(t.client_id,rt(t.client_secret)));break;case"client_secret_post":rr("client_secret_post",s),r.set("client_id",t.client_id),r.set("client_secret",rt(t.client_secret));break;case"private_key_jwt":{if(ri("private_key_jwt",t.client_secret),void 0===s)throw TypeError('"options.clientPrivateKey" must be provided when "client.token_endpoint_auth_method" is "private_key_jwt"');let{key:i,kid:n,modifyAssertion:a}=function(e){if(e instanceof CryptoKey)return{key:e};if(!(e?.key instanceof CryptoKey))return{};if(void 0!==e.kid&&!t1(e.kid))throw TypeError('"kid" must be a non-empty string');return{key:e.key,kid:e.kid,modifyAssertion:e[tL]}}(s);if(!tZ(i))throw TypeError('"options.clientPrivateKey.key" must be a private CryptoKey');r.set("client_id",t.client_id),r.set("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),r.set("client_assertion",await t8(e,t,i,n,a));break}case"tls_client_auth":case"self_signed_tls_client_auth":case"none":ri(t.token_endpoint_auth_method,t.client_secret),rr(t.token_endpoint_auth_method,s),r.set("client_id",t.client_id);break;default:throw new tB("unsupported client token_endpoint_auth_method")}}async function rn(e,t,r){if(!r.usages.includes("sign"))throw TypeError('CryptoKey instances used for signing assertions must include "sign" in their "usages"');let i=`${tH(tW(JSON.stringify(e)))}.${tH(tW(JSON.stringify(t)))}`,s=tH(await crypto.subtle.sign(rb(r),r,tW(i)));return`${i}.${s}`}async function ra(e,t,r,i,s,n){let{privateKey:a,publicKey:o,nonce:c=tz.get(r.origin)}=t;if(!tZ(a))throw TypeError('"DPoP.privateKey" must be a private CryptoKey');if(!(tX(o)&&"public"===o.type))throw TypeError('"DPoP.publicKey" must be a public CryptoKey');if(void 0!==c&&!t1(c))throw TypeError('"DPoP.nonce" must be a non-empty string or undefined');if(!o.extractable)throw TypeError('"DPoP.publicKey.extractable" must be true');let l=t6()+s,u={alg:t3(a),typ:"dpop+jwt",jwk:await rc(o)},d={iat:l,jti:t4(),htm:i,nonce:c,htu:`${r.origin}${r.pathname}`,ath:n?tH(await crypto.subtle.digest("SHA-256",tW(n))):void 0};t[tL]?.(u,d),e.set("dpop",await rn(u,d,a))}async function ro(e){let{kty:t,e:r,n:i,x:n,y:a,crv:o}=await crypto.subtle.exportKey("jwk",e),c={kty:t,e:r,n:i,x:n,y:a,crv:o};return s.set(e,c),c}async function rc(e){return s||(s=new WeakMap),s.get(e)||ro(e)}function rl(e,t,r){if("string"!=typeof e){if(r)throw TypeError(`"as.mtls_endpoint_aliases.${t}" must be a string`);throw TypeError(`"as.${t}" must be a string`)}return new URL(e)}function ru(e){return!("object"!=typeof e||Array.isArray(e))&&null!==e&&void 0!==e.error}async function rd(e,t,r,i,s,n,a){return await rs(e,t,s,n,a?.clientPrivateKey),n.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),(a?.[tK]||fetch)(i.href,{body:s,headers:Object.fromEntries(n.entries()),method:r,redirect:"manual",signal:a?.signal?function(e){if("function"==typeof e&&(e=e()),!(e instanceof AbortSignal))throw TypeError('"options.signal" must return or be an instance of AbortSignal');return e}(a.signal):null}).then(tQ)}async function rh(e,t,r,s,n){let a=function(e,t,r=!1){return r&&e.mtls_endpoint_aliases&&t in e.mtls_endpoint_aliases?rl(e.mtls_endpoint_aliases[t],t,r):rl(e[t],t,r)}(e,"token_endpoint",!!(t.use_mtls_endpoint_aliases||n?.[tq]));s.set("grant_type",r);let o=function(e){tx(e,Headers)&&(e=Object.fromEntries(e.entries()));let t=new Headers(e);if(i&&!t.has("user-agent")&&t.set("user-agent",i),t.has("authorization"))throw TypeError('"options.headers" must not include the "authorization" header name');if(t.has("dpop"))throw TypeError('"options.headers" must not include the "dpop" header name');return t}(n?.headers);return o.set("accept","application/json"),n?.DPoP!==void 0&&await ra(o,n.DPoP,a,"POST",t9(t)),rd(e,t,"POST",a,s,o,n)}async function rp(e,t,r,i){if(t7(e),re(t),!t1(r))throw TypeError('"refreshToken" must be a non-empty string');let s=new URLSearchParams(i?.additionalParameters);return s.set("refresh_token",r),rh(e,t,"refresh_token",s,i)}Symbol();let rm=new WeakMap;async function r_(e,t,r,i=!1,s=!1){let n;if(t7(e),re(t),!tx(r,Response))throw TypeError('"response" must be an instance of Response');if(200!==r.status){let e;if(e=await rS(r))return e;throw new tG('"response" is not a conform Token Endpoint response')}rv(r);try{n=await r.json()}catch(e){throw new tG('failed to parse "response" body as JSON',{cause:e})}if(!t0(n))throw new tG('"response" body must be a top level object');if(!t1(n.access_token))throw new tG('"response" body "access_token" property must be a non-empty string');if(!t1(n.token_type))throw new tG('"response" body "token_type" property must be a non-empty string');if(n.token_type=n.token_type.toLowerCase(),"dpop"!==n.token_type&&"bearer"!==n.token_type)throw new tB("unsupported `token_type` value");if(void 0!==n.expires_in&&("number"!=typeof n.expires_in||n.expires_in<=0))throw new tG('"response" body "expires_in" property must be a positive number');if(!s&&void 0!==n.refresh_token&&!t1(n.refresh_token))throw new tG('"response" body "refresh_token" property must be a non-empty string');if(void 0!==n.scope&&"string"!=typeof n.scope)throw new tG('"response" body "scope" property must be a string');if(!i){if(void 0!==n.id_token&&!t1(n.id_token))throw new tG('"response" body "id_token" property must be a non-empty string');if(n.id_token){let{claims:r,jwt:i}=await rP(n.id_token,rO.bind(void 0,t.id_token_signed_response_alg,e.id_token_signing_alg_values_supported),rI,t9(t),function(e){let t=e?.[tM];return"number"==typeof t&&Number.isFinite(t)&&-1!==Math.sign(t)?t:30}(t),t[t$]).then(rk.bind(void 0,["aud","exp","iat","iss","sub"])).then(rw.bind(void 0,e.issuer)).then(ry.bind(void 0,t.client_id));if(Array.isArray(r.aud)&&1!==r.aud.length){if(void 0===r.azp)throw new tG('ID Token "aud" (audience) claim includes additional untrusted audiences');if(r.azp!==t.client_id)throw new tG('unexpected ID Token "azp" (authorized party) claim value')}if(void 0!==r.auth_time&&(!Number.isFinite(r.auth_time)||1!==Math.sign(r.auth_time)))throw new tG('ID Token "auth_time" (authentication time) must be a positive number');rm.set(n,[r,i])}}return n}async function rf(e,t,r){return r_(e,t,r)}function ry(e,t){if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(e))throw new tG('unexpected JWT "aud" (audience) claim value')}else if(t.claims.aud!==e)throw new tG('unexpected JWT "aud" (audience) claim value');return t}function rw(e,t){if(t.claims.iss!==e)throw new tG('unexpected JWT "iss" (issuer) claim value');return t}new WeakMap;let rg=new WeakSet;async function rT(e,t,r,i,s,n){if(t7(e),re(t),!rg.has(r))throw TypeError('"callbackParameters" must be an instance of URLSearchParams obtained from "validateAuthResponse()", or "validateJwtAuthResponse()');if(!t1(i))throw TypeError('"redirectUri" must be a non-empty string');if(!t1(s))throw TypeError('"codeVerifier" must be a non-empty string');let a=rU(r,"code");if(!a)throw new tG('no authorization code in "callbackParameters"');let o=new URLSearchParams(n?.additionalParameters);return o.set("redirect_uri",i),o.set("code_verifier",s),o.set("code",a),rh(e,t,"authorization_code",o,n)}let rC={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation"};function rk(e,t){for(let r of e)if(void 0===t.claims[r])throw new tG(`JWT "${r}" (${rC[r]}) claim missing`);return t}async function rA(e,t,r){let i=await r_(e,t,r,!0);if(ru(i))return i;if(void 0!==i.id_token){if("string"==typeof i.id_token&&i.id_token.length)throw new tG("Unexpected ID Token returned, use processAuthorizationCodeOpenIDResponse() for OpenID Connect callback processing");delete i.id_token}return i}function rv(e){if(e.bodyUsed)throw TypeError('"response" body has been used already')}async function rS(e){if(e.status>399&&e.status<500){rv(e);try{let t=await e.json();if(t0(t)&&"string"==typeof t.error&&t.error.length)return void 0!==t.error_description&&"string"!=typeof t.error_description&&delete t.error_description,void 0!==t.error_uri&&"string"!=typeof t.error_uri&&delete t.error_uri,void 0!==t.algs&&"string"!=typeof t.algs&&delete t.algs,void 0!==t.scope&&"string"!=typeof t.scope&&delete t.scope,t}catch{}}}function rE(e){if("number"!=typeof e.modulusLength||e.modulusLength<2048)throw new tG(`${e.name} modulusLength must be at least 2048 bits`)}function rb(e){switch(e.algorithm.name){case"ECDSA":return{name:e.algorithm.name,hash:function(e){switch(e){case"P-256":return"SHA-256";case"P-384":return"SHA-384";case"P-521":return"SHA-512";default:throw new tB}}(e.algorithm.namedCurve)};case"RSA-PSS":switch(rE(e.algorithm),e.algorithm.hash.name){case"SHA-256":case"SHA-384":case"SHA-512":return{name:e.algorithm.name,saltLength:parseInt(e.algorithm.hash.name.slice(-3),10)>>3};default:throw new tB}case"RSASSA-PKCS1-v1_5":return rE(e.algorithm),e.algorithm.name;case"Ed448":case"Ed25519":return e.algorithm.name}throw new tB}Symbol(),Symbol();let rI=Symbol();async function rR(e,t,r,i){let s=`${e}.${t}`;if(!await crypto.subtle.verify(rb(r),r,i,tW(s)))throw new tG("JWT signature verification failed")}async function rP(e,t,r,i,s,n){let a,o,c,{0:l,1:u,2:d,length:h}=e.split(".");if(5===h){if(void 0!==n)e=await n(e),{0:l,1:u,2:d,length:h}=e.split(".");else throw new tB("JWE structure JWTs are not supported")}if(3!==h)throw new tG("Invalid JWT");try{a=JSON.parse(tW(tH(l)))}catch(e){throw new tG("failed to parse JWT Header body as base64url encoded JSON",{cause:e})}if(!t0(a))throw new tG("JWT Header must be a top level object");if(t(a),void 0!==a.crit)throw new tG('unexpected JWT "crit" header parameter');let p=tH(d);r!==rI&&(o=await r(a),await rR(l,u,o,p));try{c=JSON.parse(tW(tH(u)))}catch(e){throw new tG("failed to parse JWT Payload body as base64url encoded JSON",{cause:e})}if(!t0(c))throw new tG("JWT Payload must be a top level object");let m=t6()+i;if(void 0!==c.exp){if("number"!=typeof c.exp)throw new tG('unexpected JWT "exp" (expiration time) claim type');if(c.exp<=m-s)throw new tG('unexpected JWT "exp" (expiration time) claim value, timestamp is <= now()')}if(void 0!==c.iat&&"number"!=typeof c.iat)throw new tG('unexpected JWT "iat" (issued at) claim type');if(void 0!==c.iss&&"string"!=typeof c.iss)throw new tG('unexpected JWT "iss" (issuer) claim type');if(void 0!==c.nbf){if("number"!=typeof c.nbf)throw new tG('unexpected JWT "nbf" (not before) claim type');if(c.nbf>m+s)throw new tG('unexpected JWT "nbf" (not before) claim value, timestamp is > now()')}if(void 0!==c.aud&&"string"!=typeof c.aud&&!Array.isArray(c.aud))throw new tG('unexpected JWT "aud" (audience) claim type');return{header:a,claims:c,signature:p,key:o,jwt:e}}function rO(e,t,r){if(void 0!==e){if(r.alg!==e)throw new tG('unexpected JWT "alg" header parameter');return}if(Array.isArray(t)){if(!t.includes(r.alg))throw new tG('unexpected JWT "alg" header parameter');return}if("RS256"!==r.alg)throw new tG('unexpected JWT "alg" header parameter')}function rU(e,t){let{0:r,length:i}=e.getAll(t);if(i>1)throw new tG(`"${t}" parameter must be provided only once`);return r}let rj=Symbol(),rN=Symbol();new TextEncoder;let rx=new TextDecoder,rD=e=>{let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r},rM=e=>{let t=e;t instanceof Uint8Array&&(t=rx.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return rD(t)}catch{throw TypeError("The input to be decoded is not correctly encoded.")}};class rK extends Error{constructor(e,t){super(e,t),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}rK.code="ERR_JOSE_GENERIC";class rL extends rK{constructor(e,t,r="unspecified",i="unspecified"){super(e,{cause:{claim:r,reason:i,payload:t}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=r,this.reason=i,this.payload=t}}rL.code="ERR_JWT_CLAIM_VALIDATION_FAILED";class r$ extends rK{constructor(e,t,r="unspecified",i="unspecified"){super(e,{cause:{claim:r,reason:i,payload:t}}),this.code="ERR_JWT_EXPIRED",this.claim=r,this.reason=i,this.payload=t}}r$.code="ERR_JWT_EXPIRED";class rq extends rK{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}rq.code="ERR_JOSE_ALG_NOT_ALLOWED";class rF extends rK{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}}rF.code="ERR_JOSE_NOT_SUPPORTED";class rJ extends rK{constructor(e="decryption operation failed",t){super(e,t),this.code="ERR_JWE_DECRYPTION_FAILED"}}rJ.code="ERR_JWE_DECRYPTION_FAILED";class rW extends rK{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}}rW.code="ERR_JWE_INVALID";class rH extends rK{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}}rH.code="ERR_JWS_INVALID";class rV extends rK{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}rV.code="ERR_JWT_INVALID";class rB extends rK{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}}rB.code="ERR_JWK_INVALID";class rY extends rK{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}}rY.code="ERR_JWKS_INVALID";class rG extends rK{constructor(e="no applicable key found in the JSON Web Key Set",t){super(e,t),this.code="ERR_JWKS_NO_MATCHING_KEY"}}rG.code="ERR_JWKS_NO_MATCHING_KEY";class rz extends rK{constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}rz.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";class rX extends rK{constructor(e="request timed out",t){super(e,t),this.code="ERR_JWKS_TIMEOUT"}}rX.code="ERR_JWKS_TIMEOUT";class rZ extends rK{constructor(e="signature verification failed",t){super(e,t),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}rZ.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",Error("timeout while waiting for mutex to become available"),Error("mutex already locked");let rQ=Error("request for lock canceled");class r0{constructor(e,t=rQ){this._value=e,this._cancelError=t,this._queue=[],this._weightedWaiters=[]}acquire(e=1,t=0){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);return new Promise((r,i)=>{let s={resolve:r,reject:i,weight:e,priority:t},n=r1(this._queue,e=>t<=e.priority);-1===n&&e<=this._value?this._dispatchItem(s):this._queue.splice(n+1,0,s)})}runExclusive(e){var t,r,i,s;return t=this,r=arguments,i=void 0,s=function*(e,t=1,r=0){let[i,s]=yield this.acquire(t,r);try{return yield e(i)}finally{s()}},new(i||(i=Promise))(function(e,n){function a(e){try{c(s.next(e))}catch(e){n(e)}}function o(e){try{c(s.throw(e))}catch(e){n(e)}}function c(t){var r;t.done?e(t.value):((r=t.value)instanceof i?r:new i(function(e){e(r)})).then(a,o)}c((s=s.apply(t,r||[])).next())})}waitForUnlock(e=1,t=0){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);return this._couldLockImmediately(e,t)?Promise.resolve():new Promise(r=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),function(e,t){let r=r1(e,e=>t.priority<=e.priority);e.splice(r+1,0,t)}(this._weightedWaiters[e-1],{resolve:r,priority:t})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatchQueue()}release(e=1){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatchQueue()}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(e){let t=this._value;this._value-=e.weight,e.resolve([t,this._newReleaser(e.weight)])}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){if(0===this._queue.length)for(let e=this._value;e>0;e--){let t=this._weightedWaiters[e-1];t&&(t.forEach(e=>e.resolve()),this._weightedWaiters[e-1]=[])}else{let e=this._queue[0].priority;for(let t=this._value;t>0;t--){let r=this._weightedWaiters[t-1];if(!r)continue;let i=r.findIndex(t=>t.priority<=e);(-1===i?r:r.splice(0,i)).forEach(e=>e.resolve())}}}_couldLockImmediately(e,t){return(0===this._queue.length||this._queue[0].priority<t)&&e<=this._value}}function r1(e,t){for(let r=e.length-1;r>=0;r--)if(t(e[r]))return r;return -1}var r4=class{constructor(e){this._value=e,this._callbacks=new Map}get(){return this._value}set(e){let t=this._value;this._value=e,this._callbacks.forEach(r=>r(e,t))}update(e){let t=e(this._value);return this.set(t),t}onChange(e){let t=tf();return this._callbacks.set(t,e),{unsubscribe:()=>{this._callbacks.delete(t)}}}onceChange(e){let{unsubscribe:t}=this.onChange((...r)=>{t(),e(...r)});return{unsubscribe:t}}},r2=new class{constructor(){this.semaphore=new r0(1),this.readers=0,this.readersMutex=new r0(1)}async withReadLock(e){await this._acquireReadLock();try{return await e()}finally{await this._releaseReadLock()}}async withWriteLock(e){await this._acquireWriteLock();try{return await e()}finally{await this._releaseWriteLock()}}async _acquireReadLock(){await this.readersMutex.acquire();try{this.readers+=1,1===this.readers&&await this.semaphore.acquire()}finally{this.readersMutex.release()}}async _releaseReadLock(){await this.readersMutex.acquire();try{this.readers-=1,0===this.readers&&this.semaphore.release()}finally{this.readersMutex.release()}}async _acquireWriteLock(){await this.semaphore.acquire()}async _releaseWriteLock(){this.semaphore.release()}},r5=class e{constructor(...e){this._mostRecentOkValue=void 0,this._isRejected=!1,this._waitingRejectFunctions=new Map,this._callbacks=new Map,this._updateCounter=0,this._lastSuccessfulUpdate=-1,0===e.length?this._isAvailable=!1:(this._isAvailable=!0,this._mostRecentOkValue=e[0])}isAvailable(){return this._isAvailable}isRejected(){return this._isRejected}get(){return this.isRejected()?tS.error(this._rejectionError):this.isAvailable()?tS.ok(this._mostRecentOkValue):tS.pending()}getOrWait(){let e=tf();return this.isRejected()?function(e){if((tg??=new tl).has([e]))return tg.get([e]);let t=Promise.reject(e);!function(e){e.catch(()=>{})}(t);let r=Object.assign(t,{status:"rejected",reason:e});return tg.set([e],r),r}(this._rejectionError):this.isAvailable()?tw(this._mostRecentOkValue):tC(new Promise((t,r)=>{this.onceChange(e=>{t(e)}),this._waitingRejectFunctions.set(e,r)}).finally(()=>{this._waitingRejectFunctions.delete(e)}))}_setIfLatest(e,t){let r=this.get(),i=this._mostRecentOkValue;if(t>this._lastSuccessfulUpdate)switch(e.status){case"ok":if(!this._isAvailable||this._isRejected||this._mostRecentOkValue!==e.data)return this._lastSuccessfulUpdate=t,this._isAvailable=!0,this._isRejected=!1,this._mostRecentOkValue=e.data,this._rejectionError=void 0,this._callbacks.forEach(e=>e({state:this.get(),oldState:r,lastOkValue:i})),!0;break;case"error":return this._lastSuccessfulUpdate=t,this._isAvailable=!1,this._isRejected=!0,this._rejectionError=e.error,this._waitingRejectFunctions.forEach(t=>t(e.error)),this._callbacks.forEach(e=>e({state:this.get(),oldState:r,lastOkValue:i})),!0}return!1}set(e){this._setIfLatest(tv.ok(e),++this._updateCounter)}update(e){let t=e(this._mostRecentOkValue);return this.set(t),t}async setAsync(e){return await r2.withReadLock(async()=>{let t=++this._updateCounter,r=await tv.fromPromise(e);return this._setIfLatest(r,t)})}setUnavailable(){this._lastSuccessfulUpdate=++this._updateCounter,this._isAvailable=!1,this._isRejected=!1,this._rejectionError=void 0}setRejected(e){this._setIfLatest(tv.error(e),++this._updateCounter)}map(t){let r=new e;return this.onChange(e=>{r.set(t(e))}),r}onChange(e){return this.onStateChange(({state:t,lastOkValue:r})=>{"ok"===t.status&&e(t.data,r)})}onStateChange(e){let t=tf();return this._callbacks.set(t,e),{unsubscribe:()=>{this._callbacks.delete(t)}}}onceChange(e){let{unsubscribe:t}=this.onChange((...r)=>{t(),e(...r)});return{unsubscribe:t}}onceStateChange(e){let{unsubscribe:t}=this.onStateChange((...r)=>{t(),e(...r)});return{unsubscribe:t}}},r3=class{constructor(e){if(this.token=e,"undefined"===e)throw new h.AJ("Access token is the string 'undefined'; it's unlikely this is the correct value. They're supposed to be unguessable!")}get decoded(){return function(e){let t,r;if("string"!=typeof e)throw new rV("JWTs must use Compact JWS serialization, JWT must be a string");let{1:i,length:s}=e.split(".");if(5===s)throw new rV("Only JWTs using Compact JWS serialization can be decoded");if(3!==s)throw new rV("Invalid JWT");if(!i)throw new rV("JWTs must contain a payload");try{t=rM(i)}catch{throw new rV("Failed to base64url decode the payload")}try{r=JSON.parse(rx.decode(t))}catch{throw new rV("Failed to parse the decoded payload as JSON")}if(!function(e){if(!("object"==typeof e&&null!==e)||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(r))throw new rV("Invalid JWT Claims Set");return r}(this.token)}get expiresAt(){let{exp:e}=this.decoded;return new Date(void 0===e?864e13:1e3*e)}get expiresInMillis(){return Math.max(0,this.expiresAt.getTime()-Date.now())}isExpired(){return this.expiresInMillis<=0}},r9=class{constructor(e){if(this.token=e,"undefined"===e)throw new h.AJ("Refresh token is the string 'undefined'; it's unlikely this is the correct value. They're supposed to be unguessable!")}},r6=class e{constructor(t){this._options=t,this._knownToBeInvalid=new r4(!1),this._refreshPromise=null,this._accessToken=new r4(t.accessToken?new r3(t.accessToken):null),this._refreshToken=t.refreshToken?new r9(t.refreshToken):null,null===t.accessToken&&null===t.refreshToken&&this._knownToBeInvalid.set(!0),this.sessionKey=e.calculateSessionKey({accessToken:t.accessToken??null,refreshToken:t.refreshToken})}static calculateSessionKey(e){return e.refreshToken?`refresh-${e.refreshToken}`:e.accessToken?`access-${e.accessToken}`:"not-logged-in"}isKnownToBeInvalid(){return this._knownToBeInvalid.get()}markInvalid(){this._accessToken.set(null),this._knownToBeInvalid.set(!0)}onInvalidate(e){return this._knownToBeInvalid.onChange(()=>e())}async getOrFetchLikelyValidTokens(e){if(e>=6e4)throw Error(`Required access token expiry ${e}ms is too long; access tokens are too short to be used for more than 60s`);let t=this._getPotentiallyInvalidAccessTokenIfAvailable();if(!t||t.expiresInMillis<e){let t=await this.fetchNewTokens(),r=t?.accessToken.expiresInMillis;if(r&&r<e)throw new h.AJ(`Required access token expiry ${e}ms is too long; access tokens are too short when they're generated (${r}ms)`);return t}return{accessToken:t,refreshToken:this._refreshToken}}async fetchNewTokens(){let e=await this._getNewlyFetchedAccessToken();return e?{accessToken:e,refreshToken:this._refreshToken}:null}markAccessTokenExpired(e){this._accessToken.get()===e&&this._accessToken.set(null)}onAccessTokenChange(e){return this._accessToken.onChange(e)}_getPotentiallyInvalidAccessTokenIfAvailable(){if(!this._refreshToken||this.isKnownToBeInvalid())return null;let e=this._accessToken.get();return e&&!e.isExpired()?e:null}async _getNewlyFetchedAccessToken(){return!this._refreshToken||this._knownToBeInvalid.get()?null:(this._refreshPromise||this._refreshAndSetRefreshPromise(this._refreshToken),await this._refreshPromise)}_refreshAndSetRefreshPromise(e){let t=this._options.refreshAccessTokenCallback(e).then(e=>(t!==this._refreshPromise||(this._refreshPromise=null,this._accessToken.set(e),e||this.markInvalid()),e));this._refreshPromise=t}},r8={GET:{safe:!0,idempotent:!0},POST:{safe:!1,idempotent:!1},PUT:{safe:!1,idempotent:!0},DELETE:{safe:!1,idempotent:!0},PATCH:{safe:!1,idempotent:!1},OPTIONS:{safe:!0,idempotent:!0},HEAD:{safe:!0,idempotent:!0},TRACE:{safe:!0,idempotent:!0},CONNECT:{safe:!1,idempotent:!1}},r7=class{constructor(e){this.options=e}get projectId(){return this.options.projectId}getApiUrl(){return this.options.getBaseUrl()+"/api/v1"}async runNetworkDiagnostics(e,t){let r=async e=>{try{return await e(),"OK"}catch(e){return`${e}`}},i=await r(async()=>{let e=await fetch("https://1.1.1.1/cdn-cgi/trace");if(!e.ok)throw Error(`${e.status} ${e.statusText}: ${await e.text()}`)}),s=void 0!==e&&void 0!==t?await r(async()=>{let r=await this.sendClientRequestInner("/",{},e,t);if("error"===r.status)throw r.error}):"Not tested",n=await r(async()=>{let e=await fetch(new URL("/health",this.getApiUrl()));if(!e.ok)throw Error(`${e.status} ${e.statusText}: ${await e.text()}`)}),a=await r(async()=>{let e=await fetch("https://app.stack-auth.com/health");if(!e.ok)throw Error(`${e.status} ${e.statusText}: ${await e.text()}`)}),o=await r(async()=>{let e=await fetch("https://api.stack-auth.com/health");if(!e.ok)throw Error(`${e.status} ${e.statusText}: ${await e.text()}`)});return{"navigator?.onLine":tp.z.navigator?.onLine,cfTrace:i,apiRoot:s,baseUrlBackend:n,prodDashboard:a,prodBackend:o}}async _createNetworkError(e,t,r){return Error((0,m.Ac)`
      Stack Auth is unable to connect to the server. Please check your internet connection and try again.

      If the problem persists, please contact support and provide a screenshot of your entire browser console.

      ${e}

      ${JSON.stringify(await this.runNetworkDiagnostics(t,r),null,2)}
    `,{cause:e})}async _networkRetry(e,t,r){let i=await tv.retry(e,5,{exponentialDelayBase:1e3});if("error"===i.status){if(tp.z.navigator&&!tp.z.navigator.onLine)throw Error("Failed to send Stack network request. It seems like you are offline, please check your internet connection and try again. This is not an error with Stack Auth. (window.navigator.onLine is falsy)",{cause:i.error});throw await this._createNetworkError(i.error,t,r)}return i.data}async _networkRetryException(e,t,r){return await this._networkRetry(async()=>await tv.fromThrowingAsync(e),t,r)}async fetchNewAccessToken(e){if(!("publishableClientKey"in this.options))throw Error("Admin session token is currently not supported for fetching new access token. Did you try to log in on a StackApp initiated with the admin session?");let t={issuer:this.options.getBaseUrl(),algorithm:"oauth2",token_endpoint:this.getApiUrl()+"/auth/oauth/token"},r={client_id:this.projectId,client_secret:this.options.publishableClientKey,token_endpoint_auth_method:"client_secret_post"},i=await this._networkRetryException(async()=>await rp(t,r,e.token)),s=await this._processResponse(i);if("error"===s.status){let e=s.error;if(ti.RefreshTokenError.isInstance(e))return null;throw e}if(!s.data.ok){let e=await s.data.text();throw Error(`Failed to send refresh token request: ${s.status} ${e}`)}let n=await rf(t,r,s.data);if(ru(n))throw new h.AJ("OAuth error",{result:n});if(!n.access_token)throw new h.AJ("Access token not found in token endpoint response, this is weird!");return new r3(n.access_token)}async sendClientRequest(e,t,r,i="client"){return r??=this.createSession({refreshToken:null}),await this._networkRetry(()=>this.sendClientRequestInner(e,t,r,i),r,i)}createSession(e){return new r6({refreshAccessTokenCallback:async e=>await this.fetchNewAccessToken(e),...e})}async sendClientRequestAndCatchKnownError(e,t,r,i){try{return tv.ok(await this.sendClientRequest(e,t,r))}catch(e){for(let t of i)if(t.isInstance(e))return tv.error(e);throw e}}async sendClientRequestInner(e,t,r,i){let s,n=await r.getOrFetchLikelyValidTokens(2e4),a="projectOwnerSession"in this.options?this.options.projectOwnerSession:null,o=a?await a.getOrFetchLikelyValidTokens(2e4):null;await this.options.prepareRequest?.();let c=this.getApiUrl()+e;c.endsWith("/")&&(c=c.slice(0,-1));let l={..."WebSocketPair"in tp.z?{}:{credentials:"omit"},...t,headers:{"X-Stack-Override-Error-Status":"true","X-Stack-Project-Id":this.projectId,"X-Stack-Access-Type":i,"X-Stack-Client-Version":this.options.clientVersion,...n?{"X-Stack-Access-Token":n.accessToken.token}:{},...n?.refreshToken?{"X-Stack-Refresh-Token":n.refreshToken.token}:{},..."publishableClientKey"in this.options?{"X-Stack-Publishable-Client-Key":this.options.publishableClientKey}:{},...o?{"X-Stack-Admin-Access-Token":o.accessToken.token}:{},"X-Stack-Random-Nonce":t_(),"ngrok-skip-browser-warning":"true",...this.options.extraRequestHeaders,...t.headers},..."WebSocketPair"in tp.z?{}:{cache:"no-store"}};try{s=await fetch(c,l)}catch(e){if(e instanceof TypeError){if(r8[l.method??"GET"].idempotent)return tv.error(e);throw await this._createNetworkError(e,r,i)}throw e}let u=await this._processResponse(s);if("error"===u.status){if(ti.InvalidAccessToken.isInstance(u.error)){if(!n)throw new h.AJ("Received invalid access token, but session is not logged in",{tokenObj:n,processedRes:u});return r.markAccessTokenExpired(n.accessToken),tv.error(u.error)}if(a&&(ti.InvalidAdminAccessToken.isInstance(u.error)||ti.ApiKeyNotFound.isInstance(u.error))){if(!o)throw new h.AJ("Received invalid admin access token, but admin session is not logged in",{adminTokenObj:o,processedRes:u});return a.markAccessTokenExpired(o.accessToken),tv.error(u.error)}throw u.error}let d=Object.assign(u.data,{usedTokens:n});if(d.ok)return tv.ok(d);if(429===d.status){let e=d.headers.get("Retry-After");return null!==e?(console.log(`Rate limited while sending request to ${c}. Will retry after ${e} seconds...`),await tk(1e3*Number(e)),tv.error(Error(`Rate limited, retrying after ${e} seconds`))):(console.log(`Rate limited while sending request to ${c}, no retry-after header received. Retrying...`),tv.error(Error("Rate limited, no retry-after header received")))}{let t=await d.text(),r=new h.AJ(`Failed to send request to ${c}: ${d.status} ${t}`,{request:l,res:d,path:e});if(508===d.status&&t.includes("INFINITE_LOOP_DETECTED"))return tv.error(r);throw r}}async _processResponse(e){let t=e;if(e.headers.has("x-stack-actual-status")){let r=Number(e.headers.get("x-stack-actual-status"));t=new Response(e.body,{status:r,statusText:e.statusText,headers:e.headers})}if(t.headers.has("x-stack-known-error")){let e=await t.json();if(t.headers.get("x-stack-known-error")!==e.code)throw new h.AJ("Mismatch between x-stack-known-error header and error code in body; the server's response is invalid");let r=_.fromJson(e);return tv.error(r)}return tv.ok(t)}async checkFeatureSupport(e){let t=await this.sendClientRequest("/check-feature-support",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},null);throw new h.AJ(await t.text())}async sendForgotPasswordEmail(e,t){let r=await this.sendClientRequestAndCatchKnownError("/auth/password/send-reset-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,callback_url:t})},null,[ti.UserNotFound]);return"error"===r.status?tv.error(r.error):tv.ok(void 0)}async sendVerificationEmail(e,t,r){let i=await this.sendClientRequestAndCatchKnownError("/contact-channels/send-verification-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,callback_url:t})},r,[ti.EmailAlreadyVerified]);if("error"===i.status)return i.error}async sendMagicLinkEmail(e,t){let r=await this.sendClientRequestAndCatchKnownError("/auth/otp/send-sign-in-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,callback_url:t})},null,[ti.RedirectUrlNotWhitelisted]);return"error"===r.status?tv.error(r.error):tv.ok(await r.data.json())}async resetPassword(e){let t=await this.sendClientRequestAndCatchKnownError("onlyVerifyCode"in e?"/auth/password/reset/check-code":"/auth/password/reset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e.code,..."password"in e?{password:e.password}:{}})},null,[ti.VerificationCodeError]);return"error"===t.status?tv.error(t.error):tv.ok(void 0)}async updatePassword(e,t){let r=await this.sendClientRequestAndCatchKnownError("/auth/password/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({old_password:e.oldPassword,new_password:e.newPassword})},t,[ti.PasswordConfirmationMismatch,ti.PasswordRequirementsNotMet]);if("error"===r.status)return r.error}async setPassword(e,t){let r=await this.sendClientRequestAndCatchKnownError("/auth/password/set",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},t,[ti.PasswordRequirementsNotMet]);if("error"===r.status)return r.error}async verifyPasswordResetCode(e){let t=await this.resetPassword({code:e,onlyVerifyCode:!0});return"error"===t.status?tv.error(t.error):tv.ok(void 0)}async verifyEmail(e){let t=await this.sendClientRequestAndCatchKnownError("/contact-channels/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})},null,[ti.VerificationCodeError]);return"error"===t.status?tv.error(t.error):tv.ok(void 0)}async initiatePasskeyRegistration(e,t){let r=await this.sendClientRequestAndCatchKnownError("/auth/passkey/initiate-passkey-registration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},t,[]);return"error"===r.status?tv.error(r.error):tv.ok(await r.data.json())}async registerPasskey(e,t){let r=await this.sendClientRequestAndCatchKnownError("/auth/passkey/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},t,[ti.PasskeyRegistrationFailed]);return"error"===r.status?tv.error(r.error):tv.ok(void 0)}async initiatePasskeyAuthentication(e,t){let r=await this.sendClientRequestAndCatchKnownError("/auth/passkey/initiate-passkey-authentication",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},t,[]);return"error"===r.status?tv.error(r.error):tv.ok(await r.data.json())}async sendTeamInvitation(e){await this.sendClientRequest("/team-invitations/send-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,team_id:e.teamId,callback_url:e.callbackUrl})},e.session)}async acceptTeamInvitation(e){let t=await this.sendClientRequestAndCatchKnownError("check"===e.type?"/team-invitations/accept/check-code":"details"===e.type?"/team-invitations/accept/details":"/team-invitations/accept",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e.code})},e.session,[ti.VerificationCodeError]);return"error"===t.status?tv.error(t.error):tv.ok(await t.data.json())}async totpMfa(e,t,r){let i=await this.sendClientRequest("/auth/mfa/sign-in",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,type:"totp",totp:t})},r),s=await i.json();return{accessToken:s.access_token,refreshToken:s.refresh_token,newUser:s.is_new_user}}async signInWithCredential(e,t,r){let i=await this.sendClientRequestAndCatchKnownError("/auth/password/sign-in",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})},r,[ti.EmailPasswordMismatch]);if("error"===i.status)return tv.error(i.error);let s=await i.data.json();return tv.ok({accessToken:s.access_token,refreshToken:s.refresh_token})}async signUpWithCredential(e,t,r,i){let s=await this.sendClientRequestAndCatchKnownError("/auth/password/sign-up",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({email:e,password:t,verification_callback_url:r})},i,[ti.UserWithEmailAlreadyExists,ti.PasswordRequirementsNotMet]);if("error"===s.status)return tv.error(s.error);let n=await s.data.json();return tv.ok({accessToken:n.access_token,refreshToken:n.refresh_token})}async signUpAnonymously(e){let t=await this.sendClientRequestAndCatchKnownError("/auth/anonymous/sign-up",{method:"POST"},e,[]);if("error"===t.status)return tv.error(t.error);let r=await t.data.json();return tv.ok({accessToken:r.access_token,refreshToken:r.refresh_token})}async signInWithMagicLink(e){let t=await this.sendClientRequestAndCatchKnownError("/auth/otp/sign-in",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})},null,[ti.VerificationCodeError]);if("error"===t.status)return tv.error(t.error);let r=await t.data.json();return tv.ok({accessToken:r.access_token,refreshToken:r.refresh_token,newUser:r.is_new_user})}async signInWithMfa(e,t){let r=await this.sendClientRequestAndCatchKnownError("/auth/mfa/sign-in",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"totp",totp:e,code:t})},null,[ti.VerificationCodeError]);if("error"===r.status)return tv.error(r.error);let i=await r.data.json();return tv.ok({accessToken:i.access_token,refreshToken:i.refresh_token,newUser:i.is_new_user})}async signInWithPasskey(e){let t=await this.sendClientRequestAndCatchKnownError("/auth/passkey/sign-in",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},null,[ti.PasskeyAuthenticationFailed]);if("error"===t.status)return tv.error(t.error);let r=await t.data.json();return tv.ok({accessToken:r.access_token,refreshToken:r.refresh_token})}async getOAuthUrl(e){let t=new URL(e.redirectUrl);for(let e of["code","state"])t.searchParams.has(e)&&console.warn("Redirect URL already contains "+e+" parameter, removing it as it will be overwritten by the OAuth callback"),t.searchParams.delete(e);if(!("publishableClientKey"in this.options))throw Error("Admin session token is currently not supported for OAuth");let r=new URL(this.getApiUrl()+"/auth/oauth/authorize/"+e.provider.toLowerCase());if(r.searchParams.set("client_id",this.projectId),r.searchParams.set("client_secret",this.options.publishableClientKey),r.searchParams.set("redirect_uri",t.toString()),r.searchParams.set("scope","legacy"),r.searchParams.set("state",e.state),r.searchParams.set("grant_type","authorization_code"),r.searchParams.set("code_challenge",e.codeChallenge),r.searchParams.set("code_challenge_method","S256"),r.searchParams.set("response_type","code"),r.searchParams.set("type",e.type),r.searchParams.set("error_redirect_url",e.errorRedirectUrl),e.afterCallbackRedirectUrl&&r.searchParams.set("after_callback_redirect_url",e.afterCallbackRedirectUrl),"link"===e.type){let t=await e.session.getOrFetchLikelyValidTokens(2e4);r.searchParams.set("token",t?.accessToken.token||""),e.providerScope&&r.searchParams.set("provider_scope",e.providerScope)}return r.toString()}async callOAuthCallback(e){if(!("publishableClientKey"in this.options))throw Error("Admin session token is currently not supported for OAuth");let t={issuer:this.options.getBaseUrl(),algorithm:"oauth2",token_endpoint:this.getApiUrl()+"/auth/oauth/token"},r={client_id:this.projectId,client_secret:this.options.publishableClientKey,token_endpoint_auth_method:"client_secret_post"},i=await this._networkRetryException(async()=>(function(e,t,r,i){var s;if(t7(e),re(t),r instanceof URL&&(r=r.searchParams),!(r instanceof URLSearchParams))throw TypeError('"parameters" must be an instance of URLSearchParams, or URL');if(rU(r,"response"))throw new tG('"parameters" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()');let n=rU(r,"iss"),a=rU(r,"state");if(!n&&e.authorization_response_iss_parameter_supported)throw new tG('response parameter "iss" (issuer) missing');if(n&&n!==e.issuer)throw new tG('unexpected "iss" (issuer) response parameter value');switch(i){case void 0:case rN:if(void 0!==a)throw new tG('unexpected "state" response parameter encountered');break;case rj:break;default:if(!t1(i))throw new tG('"expectedState" must be a non-empty string');if(void 0===a)throw new tG('response parameter "state" missing');if(a!==i)throw new tG('unexpected "state" response parameter value')}let o=rU(r,"error");if(o)return{error:o,error_description:rU(r,"error_description"),error_uri:rU(r,"error_uri")};let c=rU(r,"id_token"),l=rU(r,"token");if(void 0!==c||void 0!==l)throw new tB("implicit and hybrid flows are not supported");return s=new URLSearchParams(r),rg.add(s),s})(t,r,e.oauthParams,e.state));if(ru(i))throw new h.AJ("Error validating outer OAuth response",{params:i});let s=await rT(t,r,i,e.redirectUri,e.codeVerifier),n=await rA(t,r,s);if(ru(n)){if("code"in n&&"MULTI_FACTOR_AUTHENTICATION_REQUIRED"===n.code)throw new ti.MultiFactorAuthenticationRequired(n.details.attempt_code);throw new h.AJ("Outer OAuth error during authorization code response",{result:n})}return{newUser:n.is_new_user,afterCallbackRedirectUrl:n.after_callback_redirect_url,accessToken:n.access_token,refreshToken:n.refresh_token??(0,h.fZ)("Refresh token not found in outer OAuth response")}}async signOut(e){if(await e.getOrFetchLikelyValidTokens(2e4)){let t=await this.sendClientRequestAndCatchKnownError("/auth/sessions/current",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({})},e,[ti.RefreshTokenError]);if("error"===t.status){if(ti.RefreshTokenError.isInstance(t.error));else throw new h.AJ("Unexpected error",{error:t.error})}}e.markInvalid()}async getClientUserByToken(e){let t=await this.sendClientRequestAndCatchKnownError("/users/me",{},e,[ti.CannotGetOwnUserWithoutUser]);if("error"===t.status){if(ti.CannotGetOwnUserWithoutUser.isInstance(t.error))return null;throw new h.AJ("Unexpected uncaught error",{cause:t.error})}let r=t.data,i=await r.json();if(!i)throw new h.AJ("User endpoint returned null; this should never happen");return i}async listTeamInvitations(e,t){let r=await this.sendClientRequest("/team-invitations?"+new URLSearchParams({team_id:e.teamId}),{},t);return(await r.json()).items}async revokeTeamInvitation(e,t,r){await this.sendClientRequest(`/team-invitations/${e}?team_id=${t}`,{method:"DELETE"},r)}async listTeamMemberProfiles(e,t){let r=await this.sendClientRequest("/team-member-profiles?"+new URLSearchParams((0,tn.YU)({team_id:e.teamId,user_id:e.userId})),{},t);return(await r.json()).items}async getTeamMemberProfile(e,t){let r=await this.sendClientRequest(`/team-member-profiles/${e.teamId}/${e.userId}`,{},t);return await r.json()}async leaveTeam(e,t){await this.sendClientRequest(`/team-memberships/${e}/me`,{method:"DELETE",headers:{"content-type":"application/json"},body:JSON.stringify({})},t)}async updateTeamMemberProfile(e,t){await this.sendClientRequest(`/team-member-profiles/${e.teamId}/${e.userId}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(e.profile)},t)}async updateTeam(e,t){await this.sendClientRequest(`/teams/${e.teamId}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(e.data)},t)}async listCurrentUserTeamPermissions(e,t){let r=await this.sendClientRequest(`/team-permissions?team_id=${e.teamId}&user_id=me&recursive=${e.recursive}`,{},t);return(await r.json()).items}async listCurrentUserProjectPermissions(e,t){let r=await this.sendClientRequest(`/project-permissions?user_id=me&recursive=${e.recursive}`,{},t);return(await r.json()).items}async listCurrentUserTeams(e){let t=await this.sendClientRequest("/teams?user_id=me",{},e);return(await t.json()).items}async getClientProject(){let e=await this.sendClientRequestAndCatchKnownError("/projects/current",{},null,[ti.ProjectNotFound]);if("error"===e.status)return tv.error(e.error);let t=e.data,r=await t.json();return tv.ok(r)}async updateClientUser(e,t){await this.sendClientRequest("/users/me",{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(e)},t)}async listProjects(e){let t=await this.sendClientRequest("/internal/projects",{},e);if(!t.ok)throw Error("Failed to list projects: "+t.status+" "+await t.text());return(await t.json()).items}async createProject(e,t){let r=await this.sendClientRequest("/internal/projects",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},t);if(!r.ok)throw Error("Failed to create project: "+r.status+" "+await r.text());return await r.json()}async createProviderAccessToken(e,t,r){let i=await this.sendClientRequest(`/connected-accounts/me/${e}/access-token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({scope:t})},r);return await i.json()}async createClientTeam(e,t){let r=await this.sendClientRequest("/teams",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},t);return await r.json()}async deleteTeam(e,t){await this.sendClientRequest(`/teams/${e}`,{method:"DELETE"},t)}async deleteCurrentUser(e){await this.sendClientRequest("/users/me",{method:"DELETE"},e)}async createClientContactChannel(e,t){let r=await this.sendClientRequest("/contact-channels",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},t);return await r.json()}async updateClientContactChannel(e,t,r){let i=await this.sendClientRequest(`/contact-channels/me/${e}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(t)},r);return await i.json()}async deleteClientContactChannel(e,t){await this.sendClientRequest(`/contact-channels/me/${e}`,{method:"DELETE"},t)}async deleteSession(e,t){await this.sendClientRequest(`/auth/sessions/${e}?user_id=me`,{method:"DELETE"},t)}async listSessions(e){let t=await this.sendClientRequest("/auth/sessions?user_id=me",{method:"GET"},e);return await t.json()}async listClientContactChannels(e){let t=await this.sendClientRequest("/contact-channels?user_id=me",{method:"GET"},e);return(await t.json()).items}async sendCurrentUserContactChannelVerificationEmail(e,t,r){let i=await this.sendClientRequestAndCatchKnownError(`/contact-channels/me/${e}/send-verification-code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({callback_url:t})},r,[ti.EmailAlreadyVerified]);return"error"===i.status?tv.error(i.error):tv.ok(void 0)}async cliLogin(e,t,r){let i=await this.sendClientRequestAndCatchKnownError("/auth/cli/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({login_code:e,refresh_token:t})},r,[ti.SchemaError]);return"error"===i.status?tv.error(i.error):tv.ok(void 0)}async _getApiKeyRequestInfo(e){if("user_id"in e&&"team_id"in e)throw new h.AJ("Cannot specify both user_id and team_id in _getApiKeyRequestInfo");return{endpoint:"team_id"in e?"/team-api-keys":"/user-api-keys",queryParams:new URLSearchParams((0,tn.ye)(e))}}async listProjectApiKeys(e,t,r){let i=("client"===r?this.sendClientRequest:this.sendServerRequest).bind(this),{endpoint:s,queryParams:n}=await this._getApiKeyRequestInfo(e),a=await i(`${s}?${n.toString()}`,{method:"GET"},t,r);return(await a.json()).items}async createProjectApiKey(e,t,r){let i=("client"===r?this.sendClientRequest:this.sendServerRequest).bind(this),{endpoint:s}=await this._getApiKeyRequestInfo(e),n=await i(`${s}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},t,r);return await n.json()}async getProjectApiKey(e,t,r,i){let s=("client"===i?this.sendClientRequest:this.sendServerRequest).bind(this),{endpoint:n,queryParams:a}=await this._getApiKeyRequestInfo(e),o=await s(`${n}/${t}?${a.toString()}`,{method:"GET"},r,i);return await o.json()}async updateProjectApiKey(e,t,r,i,s){let n=("client"===s?this.sendClientRequest:this.sendServerRequest).bind(this),{endpoint:a,queryParams:o}=await this._getApiKeyRequestInfo(e),c=await n(`${a}/${t}?${o.toString()}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(r)},i,s);return await c.json()}async checkProjectApiKey(e,t,r,i){let s=("client"===i?this.sendClientRequestAndCatchKnownError:this.sendServerRequestAndCatchKnownError).bind(this),n=await s(`/${e}-api-keys/check`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({api_key:t})},r,[ti.ApiKeyNotValid]);return"error"===n.status?null:await n.data.json()}},ie=class extends r7{constructor(e){super(e),this.options=e}async sendServerRequest(e,t,r,i="server"){return await this.sendClientRequest(e,{...t,headers:{"x-stack-secret-server-key":"secretServerKey"in this.options?this.options.secretServerKey:"",...t.headers}},r,i)}async sendServerRequestAndCatchKnownError(e,t,r,i){try{return tv.ok(await this.sendServerRequest(e,t,r))}catch(e){for(let t of i)if(t.isInstance(e))return tv.error(e);throw e}}async createServerUser(e){let t=await this.sendServerRequest("/users",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},null);return await t.json()}async getServerUserByToken(e){let t=await this.sendServerRequestAndCatchKnownError("/users/me",{},e,[ti.CannotGetOwnUserWithoutUser]);if("error"===t.status){if(ti.CannotGetOwnUserWithoutUser.isInstance(t.error))return null;throw new h.AJ("Unexpected uncaught error",{cause:t.error})}let r=t.data,i=await r.json();if(!i)throw new h.AJ("User endpoint returned null; this should never happen");return i}async getServerUserById(e){let t=await this.sendServerRequestAndCatchKnownError(tN`/users/${e}`,{},null,[ti.UserNotFound]);if("error"===t.status)return tv.error(t.error);let r=await t.data.json();return tv.ok(r)}async listServerTeamInvitations(e){let t=await this.sendServerRequest(tN`/team-invitations?team_id=${e.teamId}`,{},null);return(await t.json()).items}async revokeServerTeamInvitation(e,t){await this.sendServerRequest(tN`/team-invitations/${e}?team_id=${t}`,{method:"DELETE"},null)}async listServerTeamMemberProfiles(e){let t=await this.sendServerRequest(tN`/team-member-profiles?team_id=${e.teamId}`,{},null);return(await t.json()).items}async getServerTeamMemberProfile(e){let t=await this.sendServerRequest(tN`/team-member-profiles/${e.teamId}/${e.userId}`,{},null);return await t.json()}async listServerTeamPermissions(e,t){let r=await this.sendServerRequest(`/team-permissions?${new URLSearchParams((0,tn.YU)({user_id:e.userId,team_id:e.teamId,recursive:e.recursive.toString()}))}`,{},t);return(await r.json()).items}async listServerProjectPermissions(e,t){let r=await this.sendServerRequest(`/project-permissions?${new URLSearchParams((0,tn.YU)({user_id:e.userId,recursive:e.recursive.toString()}))}`,{},t);return(await r.json()).items}async listServerUsers(e){let t=new URLSearchParams((0,tn.YU)({cursor:e.cursor,limit:e.limit?.toString(),desc:e.desc?.toString(),...e.orderBy?{order_by:({signedUpAt:"signed_up_at"})[e.orderBy]}:{},...e.query?{query:e.query}:{}})),r=await this.sendServerRequest("/users?"+t.toString(),{},null);return await r.json()}async listServerTeams(e){let t=await this.sendServerRequest(`/teams?${new URLSearchParams((0,tn.YU)({user_id:e?.userId}))}`,{},null);return(await t.json()).items}async getServerTeam(e){let t=await this.sendServerRequest(`/teams/${e}`,{},null);return await t.json()}async listServerTeamUsers(e){let t=await this.sendServerRequest(`/users?team_id=${e}`,{},null);return(await t.json()).items}async createServerTeam(e){let t=await this.sendServerRequest("/teams",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},null);return await t.json()}async updateServerTeam(e,t){let r=await this.sendServerRequest(tN`/teams/${e}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(t)},null);return await r.json()}async deleteServerTeam(e){await this.sendServerRequest(tN`/teams/${e}`,{method:"DELETE"},null)}async addServerUserToTeam(e){let t=await this.sendServerRequest(tN`/team-memberships/${e.teamId}/${e.userId}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({})},null);return await t.json()}async removeServerUserFromTeam(e){await this.sendServerRequest(tN`/team-memberships/${e.teamId}/${e.userId}`,{method:"DELETE",headers:{"content-type":"application/json"},body:JSON.stringify({})},null)}async updateServerUser(e,t){let r=await this.sendServerRequest(tN`/users/${e}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(t)},null);return await r.json()}async createServerProviderAccessToken(e,t,r){let i=await this.sendServerRequest(tN`/connected-accounts/${e}/${t}/access-token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({scope:r})},null);return await i.json()}async createServerUserSession(e,t,r){let i=await this.sendServerRequest("/auth/sessions",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({user_id:e,expires_in_millis:t,is_impersonation:r})},null),s=await i.json();return{accessToken:s.access_token,refreshToken:s.refresh_token}}async leaveServerTeam(e){await this.sendClientRequest(tN`/team-memberships/${e.teamId}/${e.userId}`,{method:"DELETE",headers:{"content-type":"application/json"},body:JSON.stringify({})},null)}async updateServerTeamMemberProfile(e){await this.sendServerRequest(tN`/team-member-profiles/${e.teamId}/${e.userId}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(e.profile)},null)}async grantServerTeamUserPermission(e,t,r){await this.sendServerRequest(tN`/team-permissions/${e}/${t}/${r}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({})},null)}async grantServerProjectPermission(e,t){await this.sendServerRequest(tN`/project-permissions/${e}/${t}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({})},null)}async revokeServerTeamUserPermission(e,t,r){await this.sendServerRequest(tN`/team-permissions/${e}/${t}/${r}`,{method:"DELETE",headers:{"content-type":"application/json"},body:JSON.stringify({})},null)}async revokeServerProjectPermission(e,t){await this.sendServerRequest(tN`/project-permissions/${e}/${t}`,{method:"DELETE",headers:{"content-type":"application/json"},body:JSON.stringify({})},null)}async deleteServerUser(e){await this.sendServerRequest(tN`/users/${e}`,{method:"DELETE",headers:{"content-type":"application/json"},body:JSON.stringify({})},null)}async createServerContactChannel(e){let t=await this.sendServerRequest("/contact-channels",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},null);return await t.json()}async updateServerContactChannel(e,t,r){let i=await this.sendServerRequest(tN`/contact-channels/${e}/${t}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(r)},null);return await i.json()}async deleteServerContactChannel(e,t){await this.sendServerRequest(tN`/contact-channels/${e}/${t}`,{method:"DELETE"},null)}async listServerContactChannels(e){let t=await this.sendServerRequest(tN`/contact-channels?user_id=${e}`,{method:"GET"},null);return(await t.json()).items}async sendServerContactChannelVerificationEmail(e,t,r){await this.sendServerRequest(tN`/contact-channels/${e}/${t}/send-verification-code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({callback_url:r})},null)}async listServerSessions(e){let t=await this.sendServerRequest(tN`/auth/sessions?user_id=${e}`,{method:"GET"},null);return await t.json()}async deleteServerSession(e){await this.sendServerRequest(tN`/auth/sessions/${e}`,{method:"DELETE"},null)}async sendServerTeamInvitation(e){await this.sendServerRequest("/team-invitations/send-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,team_id:e.teamId,callback_url:e.callbackUrl})},null)}async updatePassword(e){let t=await this.sendServerRequestAndCatchKnownError("/auth/password/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({old_password:e.oldPassword,new_password:e.newPassword})},null,[ti.PasswordConfirmationMismatch,ti.PasswordRequirementsNotMet]);if("error"===t.status)return t.error}},it=class extends ie{constructor(e){super(e),this.options=e}async sendAdminRequest(e,t,r,i="admin"){return await this.sendServerRequest(e,{...t,headers:{"x-stack-super-secret-admin-key":"superSecretAdminKey"in this.options?this.options.superSecretAdminKey:"",...t.headers}},r,i)}async getProject(){let e=await this.sendAdminRequest("/internal/projects/current",{method:"GET"},null);return await e.json()}async updateProject(e){let t=await this.sendAdminRequest("/internal/projects/current",{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(e)},null);return await t.json()}async createInternalApiKey(e){let t=await this.sendAdminRequest("/internal/api-keys",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},null);return await t.json()}async listInternalApiKeys(){let e=await this.sendAdminRequest("/internal/api-keys",{},null);return(await e.json()).items}async revokeInternalApiKeyById(e){await this.sendAdminRequest(`/internal/api-keys/${e}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({revoked:!0})},null)}async getInternalApiKey(e,t){let r=await this.sendAdminRequest(`/internal/api-keys/${e}`,{},t);return await r.json()}async listEmailTemplates(){let e=await this.sendAdminRequest("/email-templates",{},null);return(await e.json()).items}async updateEmailTemplate(e,t){let r=await this.sendAdminRequest(`/email-templates/${e}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(t)},null);return await r.json()}async resetEmailTemplate(e){await this.sendAdminRequest(`/email-templates/${e}`,{method:"DELETE"},null)}async listTeamPermissionDefinitions(){let e=await this.sendAdminRequest("/team-permission-definitions",{},null);return(await e.json()).items}async createTeamPermissionDefinition(e){let t=await this.sendAdminRequest("/team-permission-definitions",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},null);return await t.json()}async updateTeamPermissionDefinition(e,t){let r=await this.sendAdminRequest(`/team-permission-definitions/${e}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(t)},null);return await r.json()}async deleteTeamPermissionDefinition(e){await this.sendAdminRequest(`/team-permission-definitions/${e}`,{method:"DELETE"},null)}async listProjectPermissionDefinitions(){let e=await this.sendAdminRequest("/project-permission-definitions",{},null);return(await e.json()).items}async createProjectPermissionDefinition(e){let t=await this.sendAdminRequest("/project-permission-definitions",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},null);return await t.json()}async updateProjectPermissionDefinition(e,t){let r=await this.sendAdminRequest(`/project-permission-definitions/${e}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(t)},null);return await r.json()}async deleteProjectPermissionDefinition(e){await this.sendAdminRequest(`/project-permission-definitions/${e}`,{method:"DELETE"},null)}async getSvixToken(){let e=await this.sendAdminRequest("/webhooks/svix-token",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({})},null);return await e.json()}async deleteProject(){await this.sendAdminRequest("/internal/projects/current",{method:"DELETE"},null)}async getMetrics(){let e=await this.sendAdminRequest("/internal/metrics",{method:"GET"},null);return await e.json()}async sendTestEmail(e){let t=await this.sendAdminRequest("/internal/send-test-email",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},null);return await t.json()}async listSentEmails(){let e=await this.sendAdminRequest("/internal/emails",{method:"GET"},null);return await e.json()}};function ir(e){let t=[],r=`/projects/${e.id}/domains`;for(let{domain:i}of(e.config.allow_localhost&&t.push({message:"Localhost is not allowed in production mode, turn off 'Allow localhost' in project settings",relativeFixUrl:r}),e.config.domains)){let s;try{s=new URL(i)}catch(s){(0,h.O7)("production-mode-domain-not-valid",new h.AJ("Domain was somehow not a valid URL; we should've caught this when setting the domain in the first place",{domain:i,projectId:e})),t.push({message:"Trusted domain is not a valid URL: "+i,relativeFixUrl:r});continue}!function(e){let t=tU(e);return!!t&&!!("localhost"===t.hostname||t.hostname.endsWith(".localhost")||t.hostname.match(/^127\.\d+\.\d+\.\d+$/))}(s)?s.hostname.match(/^\d+(\.\d+)*$/)?t.push({message:"Direct IPs are not valid for trusted domains in production mode: "+i,relativeFixUrl:r}):"https:"!==s.protocol&&t.push({message:"Trusted domains should be HTTPS: "+i,relativeFixUrl:r}):t.push({message:"Localhost domains are not allowed to be trusted in production mode: "+i,relativeFixUrl:r})}return t}var ii=r(2265),is=r(8019);function ia(e){return{display_name:e.displayName,description:e.description,is_production_mode:e.isProductionMode,config:{domains:e.config?.domains?.map(e=>({domain:e.domain,handler_path:e.handlerPath})),oauth_providers:e.config?.oauthProviders?.map(e=>({id:e.id,type:e.type,..."standard"===e.type&&{client_id:e.clientId,client_secret:e.clientSecret,facebook_config_id:e.facebookConfigId,microsoft_tenant_id:e.microsoftTenantId}})),email_config:e.config?.emailConfig&&("shared"===e.config.emailConfig.type?{type:"shared"}:{type:"standard",host:e.config.emailConfig.host,port:e.config.emailConfig.port,username:e.config.emailConfig.username,password:e.config.emailConfig.password,sender_name:e.config.emailConfig.senderName,sender_email:e.config.emailConfig.senderEmail}),sign_up_enabled:e.config?.signUpEnabled,credential_enabled:e.config?.credentialEnabled,magic_link_enabled:e.config?.magicLinkEnabled,passkey_enabled:e.config?.passkeyEnabled,allow_localhost:e.config?.allowLocalhost,create_team_on_sign_up:e.config?.createTeamOnSignUp,client_team_creation_enabled:e.config?.clientTeamCreationEnabled,client_user_deletion_enabled:e.config?.clientUserDeletionEnabled,team_creator_default_permissions:e.config?.teamCreatorDefaultPermissions,team_member_default_permissions:e.config?.teamMemberDefaultPermissions,user_default_permissions:e.config?.userDefaultPermissions,oauth_account_merge_strategy:e.config?.oauthAccountMergeStrategy,allow_user_api_keys:e.config?.allowUserApiKeys,allow_team_api_keys:e.config?.allowTeamApiKeys}}}var io=class{constructor(e,t={}){this._fetcher=e,this._options=t,this._map=new tl,this.isCacheAvailable=this._createKeyed("isCacheAvailable"),this.getIfCached=this._createKeyed("getIfCached"),this.getOrWait=this._createKeyed("getOrWait"),this.forceSetCachedValue=this._createKeyed("forceSetCachedValue"),this.forceSetCachedValueAsync=this._createKeyed("forceSetCachedValueAsync"),this.refresh=this._createKeyed("refresh"),this.invalidate=this._createKeyed("invalidate"),this.onStateChange=this._createKeyed("onStateChange")}_createKeyed(e){return(t,...r)=>{let i=this.getValueCache(t);return i[e].apply(i,r)}}getValueCache(e){let t=this._map.get(e);return t||(t=new ic(async()=>await this._fetcher(e),{...this._options,onSubscribe:this._options.onSubscribe?t=>this._options.onSubscribe(e,t):void 0}),this._map.set(e,t)),t}async refreshWhere(e){let t=[];for(let[r,i]of this._map)e(r)&&t.push(i.refresh());await Promise.all(t)}},ic=class{constructor(e,t={}){this._options=t,this._subscriptionsCount=0,this._unsubscribers=[],this._mostRecentRefreshPromiseIndex=0,this._store=new r5,this._rateLimitOptions={concurrency:1,throttleMs:300,...(0,tn.YU)(t.rateLimiter??{})},this._fetcher=function(e,t){let r=performance.now(),i=[],s=new Map,n=async()=>{for(;;)if(r>performance.now())await tk(Math.max(1,r-performance.now()+1));else if(0===i.length){let e=tf();await new Promise(t=>{s.set(e,t)}),s.delete(e)}else break;let n=t.batchCalls?i.splice(0,i.length):[i.shift()],a=performance.now(),o=await tv.fromPromise(e()),c=performance.now();for(let e of(r=Math.max(r,a+(t.throttleMs??0),c+(t.gapMs??0)),n))"ok"===o.status?e[0](o.data):e[1](o.error)};return tA(async()=>{for(;;)await n()}),()=>new Promise((e,n)=>{r=Math.max(r,performance.now()+(t.debounceMs??0)),i.push([e,n]),s.forEach(e=>e())})}(e,{...this._rateLimitOptions,batchCalls:!0})}isCacheAvailable(){return this._store.isAvailable()}getIfCached(){return this._store.get()}getOrWait(e){let t=this.getIfCached();return"read-write"===e&&"ok"===t.status?tw(t.data):this._refetch(e)}_set(e){this._store.set(e)}_setAsync(e){let t=tC(e);return this._pendingPromise=t,tC(this._store.setAsync(t))}_refetch(e){if("read-write"===e&&this._pendingPromise)return this._pendingPromise;let t=tC(this._fetcher());return"never"===e?t:tC(this._setAsync(t).then(()=>t))}forceSetCachedValue(e){this._set(e)}forceSetCachedValueAsync(e){return this._setAsync(e)}async refresh(){return await this.getOrWait("write-only")}invalidate(){this._store.setUnavailable(),this._pendingPromise=void 0,this._subscriptionsCount>0&&tA(this.refresh())}onStateChange(e){let t=this._store.onChange(e);if(tA(this.getOrWait("read-write")),0==this._subscriptionsCount++&&this._options.onSubscribe){let e=this._options.onSubscribe(()=>{tA(this.refresh())});this._unsubscribers.push(e)}let r=!1;return{unsubscribe:()=>{if(!r&&(r=!0,t.unsubscribe(),0==--this._subscriptionsCount)){let e=++this._mostRecentRefreshPromiseIndex;for(let t of(tA(async()=>{await tk(5e3),0===this._subscriptionsCount&&e===this._mostRecentRefreshPromiseIndex&&this.invalidate()}),this._unsubscribers))t()}}}}};function il(){return"undefined"!=typeof window&&"undefined"!=typeof document&&void 0!==document.createElement}function iu(){throw ii.use(tT),Error("Somehow a Promise that never resolves was resolved?")}r(257);var id=class extends Error{constructor(e){super((0,m.Ac)`
      ${e.caller??"This code path"} attempted to display a loading indicator, but didn't find a Suspense boundary above it. Please read the error message below carefully.
      
      The fix depends on which of the 3 scenarios caused it:
      
      1. You are missing a loading.tsx file in your app directory. Fix it by adding a loading.tsx file in your app directory.

      2. The component is rendered in the root (outermost) layout.tsx or template.tsx file. Next.js does not wrap those files in a Suspense boundary, even if there is a loading.tsx file in the same folder. To fix it, wrap your layout inside a route group like this:

        - app
        - - layout.tsx  // contains <html> and <body>, alongside providers and other components that don't need ${e.caller??"this code path"}
        - - loading.tsx  // required for suspense
        - - (main)
        - - - layout.tsx  // contains the main layout of your app, like a sidebar or a header, and can use ${e.caller??"this code path"}
        - - - route.tsx  // your actual main page
        - - - the rest of your app

        For more information on this approach, see Next's documentation on route groups: https://nextjs.org/docs/app/building-your-application/routing/route-groups
      
      3. You caught this error with try-catch or a custom error boundary. Fix this by rethrowing the error or not catching it in the first place.

      See: https://nextjs.org/docs/messages/missing-suspense-with-csr-bailout

      More information on SSR and Suspense boundaries: https://react.dev/reference/react/Suspense#providing-a-fallback-for-server-errors-and-client-only-content
    `),this.name="NoSuspenseBoundaryError",this.reason=e.caller??"suspendIfSsr()",this.digest="BAILOUT_TO_CLIENT_SIDE_RENDERING"}};function ih(e){if(!il())throw new id({caller:e})}var ip=r(257),im="js @stackframe/stack@2.8.16";if(im.startsWith("STACK_COMPILE_TIME"))throw new h.AJ("Client version was not replaced. Something went wrong during build!");var i_=e=>new io(async t=>await tv.fromThrowingAsync(async()=>await e(t)),{}),iy=e=>new io(async([t,...r])=>await tv.fromThrowingAsync(async()=>await e(t,r)),{onSubscribe:([e],t)=>{let r=e.onInvalidate(()=>t());return()=>r.unsubscribe()}});function iw(){return"39e32132-4994-4c0c-90db-05150db4054e"}function ig(){return"pck_vzrmv65na39bvj84erejggxshygga2vxrvtkj1n1cfg5g"}function iT(){return ip.env.STACK_SECRET_SERVER_KEY||(0,h.fZ)(Error("No secret server key provided. Please copy your key from the Stack dashboard and put it in the STACK_SECRET_SERVER_KEY environment variable."))}function iC(e){let t;return(t=e?"string"==typeof e?e:il()?e.browser:e.server:(t=il()?ip.env.NEXT_PUBLIC_BROWSER_STACK_API_URL:ip.env.NEXT_PUBLIC_SERVER_STACK_API_URL)||ip.env.NEXT_PUBLIC_STACK_API_URL||ip.env.NEXT_PUBLIC_STACK_URL||ik).endsWith("/")?t.slice(0,-1):t}var ik="https://api.stack-auth.com";function iA(){return new r4({refreshToken:null,accessToken:null})}var iv=new Map;function iS(e,t,r){ih(r);let i=ii.useId(),s=(0,ii.useCallback)(r=>{let{unsubscribe:s}=e.onStateChange(t,()=>{iv.delete(i),r()});return s},[e,...t]),n=(0,ii.useCallback)(()=>(iv.has(i)||iv.set(i,e.getOrWait(t,"read-write")),iv.get(i)),[e,...t]),a=ii.useSyncExternalStore(s,n,()=>(0,h.fZ)(Error("getServerSnapshot should never be called in useAsyncCache because we restrict to CSR earlier"))),o=ii.use(a);if("error"===o.status){let e=o.error;throw e instanceof Error&&!e.__stackHasConcatenatedStacktraces&&((0,h.PV)(e,Error()),e.__stackHasConcatenatedStacktraces=!0),e}return o.data}function iE(e,t){if("undefined"==typeof window||!window.location)throw new h.AJ(`${t} option is required in a non-browser environment.`,{redirectUrl:e});let r=new URL(window.location.href),i=e?new URL(e,window.location.href):new URL(window.location.href);for(let e of["after_auth_return_to"])r.searchParams.has(e)&&i.searchParams.set(e,r.searchParams.get(e));return i.hash="",i.toString()}async function ib(e,t,r){return{description:r.description,expires_at_millis:null==r.expiresAt?r.expiresAt:r.expiresAt.getTime(),is_public:r.isPublic,..."user"===e?{user_id:t}:{team_id:t}}}async function iI(e,t){return(0,tn.YU)({description:t.description,expires_at_millis:null==t.expiresAt?t.expiresAt:t.expiresAt.getTime(),revoked:t.revoked})}function iR(e){return{display_name:e.displayName,profile_image_url:e.profileImageUrl,creator_user_id:e.creatorUserId}}function iP(e){let t=new Uint8Array(e),r="";for(let e of t)r+=String.fromCharCode(e);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function iO(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),r=(4-t.length%4)%4,i=atob(t.padEnd(t.length+r,"=")),s=new ArrayBuffer(i.length),n=new Uint8Array(s);for(let e=0;e<i.length;e++)n[e]=i.charCodeAt(e);return s}function iU(){return window?.PublicKeyCredential!==void 0&&"function"==typeof window.PublicKeyCredential}function ij(e){let{id:t}=e;return{...e,id:iO(t),transports:e.transports}}function iN(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}class ix extends Error{constructor({message:e,code:t,cause:r,name:i}){super(e,{cause:r}),this.name=i??r.name,this.code=t}}class iD{createNewAbortSignal(){if(this.controller){let e=Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}let e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){let e=Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}let iM=new iD,iK=["cross-platform","platform"];function iL(e){if(!(!e||0>iK.indexOf(e)))return e}async function i$(e){let t,r,i,s,n;let{optionsJSON:a,useAutoRegister:o=!1}=e;if(!iU())throw Error("WebAuthn is not supported in this browser");let c={...a,challenge:iO(a.challenge),user:{...a.user,id:iO(a.user.id)},excludeCredentials:a.excludeCredentials?.map(ij)},l={};o&&(l.mediation="conditional"),l.publicKey=c,l.signal=iM.createNewAbortSignal();try{t=await navigator.credentials.create(l)}catch(e){throw function({error:e,options:t}){let{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new ix({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("ConstraintError"===e.name){if(r.authenticatorSelection?.requireResidentKey===!0)return new ix({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if("conditional"===t.mediation&&r.authenticatorSelection?.userVerification==="required")return new ix({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(r.authenticatorSelection?.userVerification==="required")return new ix({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else if("InvalidStateError"===e.name)return new ix({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});else if("NotAllowedError"===e.name)return new ix({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});else if("NotSupportedError"===e.name)return new ix(0===r.pubKeyCredParams.filter(e=>"public-key"===e.type).length?{message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}:{message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});else if("SecurityError"===e.name){let t=window.location.hostname;if(!iN(t))return new ix({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(r.rp.id!==t)return new ix({message:`The RP ID "${r.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("TypeError"===e.name){if(r.user.id.byteLength<1||r.user.id.byteLength>64)return new ix({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if("UnknownError"===e.name)return new ix({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e});return e}({error:e,options:l})}if(!t)throw Error("Registration was not completed");let{id:u,rawId:d,response:h,type:p}=t;if("function"==typeof h.getTransports&&(i=h.getTransports()),"function"==typeof h.getPublicKeyAlgorithm)try{s=h.getPublicKeyAlgorithm()}catch(e){iq("getPublicKeyAlgorithm()",e)}if("function"==typeof h.getPublicKey)try{let e=h.getPublicKey();null!==e&&(n=iP(e))}catch(e){iq("getPublicKey()",e)}if("function"==typeof h.getAuthenticatorData)try{r=iP(h.getAuthenticatorData())}catch(e){iq("getAuthenticatorData()",e)}return{id:u,rawId:iP(d),response:{attestationObject:iP(h.attestationObject),clientDataJSON:iP(h.clientDataJSON),transports:i,publicKeyAlgorithm:s,publicKey:n,authenticatorData:r},type:p,clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:iL(t.authenticatorAttachment)}}function iq(e,t){console.warn(`The browser extension that intercepted this WebAuthn API call incorrectly implemented ${e}. You should report this error to them.
`,t)}async function iF(e){let t,r,i;let{optionsJSON:s,useBrowserAutofill:n=!1,verifyBrowserAutofillInput:a=!0}=e;if(!iU())throw Error("WebAuthn is not supported in this browser");s.allowCredentials?.length!==0&&(t=s.allowCredentials?.map(ij));let o={...s,challenge:iO(s.challenge),allowCredentials:t},c={};if(n){if(!await function(){if(!iU())return new Promise(e=>e(!1));let e=window.PublicKeyCredential;return void 0===e.isConditionalMediationAvailable?new Promise(e=>e(!1)):e.isConditionalMediationAvailable()}())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete$='webauthn']").length<1&&a)throw Error('No <input> with "webauthn" as the only or last value in its `autocomplete` attribute was detected');c.mediation="conditional",o.allowCredentials=[]}c.publicKey=o,c.signal=iM.createNewAbortSignal();try{r=await navigator.credentials.get(c)}catch(e){throw function({error:e,options:t}){let{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new ix({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("NotAllowedError"===e.name)return new ix({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});else if("SecurityError"===e.name){let t=window.location.hostname;if(!iN(t))return new ix({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(r.rpId!==t)return new ix({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("UnknownError"===e.name)return new ix({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e});return e}({error:e,options:c})}if(!r)throw Error("Authentication was not completed");let{id:l,rawId:u,response:d,type:h}=r;return d.userHandle&&(i=iP(d.userHandle)),{id:l,rawId:iP(u),response:{authenticatorData:iP(d.authenticatorData),clientDataJSON:iP(d.clientDataJSON),signature:iP(d.signature),userHandle:i},type:h,clientExtensionResults:r.getClientExtensionResults(),authenticatorAttachment:iL(r.authenticatorAttachment)}}var iJ=r(469),iW=r(2439);let iH=iW.cookies,iV=iW.headers;function iB(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)e[i]=r[i]}return e}var iY=function e(t,r){function i(e,i,s){if("undefined"!=typeof document){"number"==typeof(s=iB({},r,s)).expires&&(s.expires=new Date(Date.now()+864e5*s.expires)),s.expires&&(s.expires=s.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var n="";for(var a in s)s[a]&&(n+="; "+a,!0!==s[a]&&(n+="="+s[a].split(";")[0]));return document.cookie=e+"="+t.write(i,e)+n}}return Object.create({set:i,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var r=document.cookie?document.cookie.split("; "):[],i={},s=0;s<r.length;s++){var n=r[s].split("="),a=n.slice(1).join("=");try{var o=decodeURIComponent(n[0]);if(i[o]=t.read(a,o),e===o)break}catch(e){}}return e?i[e]:i}},remove:function(e,t){i(e,"",iB({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,iB({},this.attributes,t))},withConverter:function(t){return e(iB({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});function iG(){if(!il())throw Error("cookieClient functions can only be called in a browser environment, yet window is undefined")}async function iz(){function e(){throw new h.AJ("Throwing cookie helper is just a placeholder. This should never be called")}return{get:e,set:e,setOrDelete:e,delete:e}}async function iX(){var e,t;return il()?iZ():(e=await iH(),t=await iV(),{get:t=>{try{e.set("stack-is-https","true",{secure:!0})}catch(e){if("object"==typeof e&&null!==e&&"message"in e&&"string"==typeof e.message&&e.message.includes("Cookies can only be modified in a Server Action or Route Handler"));else throw e}return e.get(t)?.value??null},set:(r,i,s)=>{let n=!!e.get("stack-is-https");"https"===t.get("x-forwarded-proto")&&(n=!0);try{e.set(r,i,{secure:n,maxAge:s.maxAge})}catch(e){iQ(e,s)}},setOrDelete(e,t,r={}){null===t?this.delete(e,r):this.set(e,t,r)},delete(t,r={}){try{e.delete(t)}catch(e){iQ(e,r)}}})}function iZ(){return{get:i0,set:i5,setOrDelete:i1,delete:i2}}function iQ(e,t){if(e instanceof Error&&e.message.includes("Cookies can only be modified in")){if(t.noOpIfServerComponent);else throw new h.AJ("Attempted to set cookie in server component. Pass { noOpIfServerComponent: true } in the options of Stack's cookie functions if this is intentional and you want to ignore this error. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#options")}else throw e}function i0(e){return iG(),iY.set("stack-is-https","true",{secure:!0}),iY.get(e)??null}function i1(e,t,r={}){iG(),null===t?i2(e,r):i5(e,t,r)}async function i4(e,t,r={}){(await iX()).setOrDelete(e,t,r)}function i2(e,t={}){iG(),iY.remove(e)}function i5(e,t,r={}){iG(),iY.set(e,t,{expires:void 0===r.maxAge?void 0:new Date(Date.now()+1e3*r.maxAge)})}async function i3(e,t,r={}){(await iX()).set(e,t,r)}async function i9(){let e=t4(),t=await t2(e),r=t4();return await i3("stack-oauth-outer-"+r,e,{maxAge:3600}),{codeChallenge:t,state:r}}async function i6(e,t){let{codeChallenge:r,state:i}=await i9(),s=await e.getOAuthUrl({provider:t.provider,redirectUrl:iE(t.redirectUrl,"redirectUrl"),errorRedirectUrl:iE(t.errorRedirectUrl,"errorRedirectUrl"),codeChallenge:r,state:i,type:"authenticate",providerScope:t.providerScope});window.location.assign(s),await tT}async function i8(e,t,r){let{codeChallenge:i,state:s}=await i9(),n=await e.getOAuthUrl({provider:t.provider,redirectUrl:iE(t.redirectUrl,"redirectUrl"),errorRedirectUrl:iE(t.errorRedirectUrl,"errorRedirectUrl"),afterCallbackRedirectUrl:iE(window.location.href,"afterCallbackRedirectUrl"),codeChallenge:i,state:s,type:"link",session:r,providerScope:t.providerScope});window.location.assign(n),await tT}async function i7(e,t){let r=function(){let e=["code","state"],t=new URL(window.location.href);for(let r of e)if(!t.searchParams.has(r))return console.warn(Error(`Missing required query parameter on OAuth callback: ${r}. Maybe you opened or reloaded the oauth-callback page from your history?`)),null;let r=t.searchParams.get("state")??(0,h.fZ)("This should never happen; isn't state required above?"),i=function(e){iG();let t="stack-oauth-outer-"+e,r=i0(t);return r?(i2(t),{codeVerifier:r}):null}(r);if(!i)return console.warn((0,m.Ac)`
      Stack found an outer OAuth callback state in the query parameters, but not in cookies.
      
      This could have multiple reasons:
        - The cookie expired, because the OAuth flow took too long.
        - The user's browser deleted the cookie, either manually or because of a very strict cookie policy.
        - The cookie was already consumed by this page, and the user already logged in.
        - You are using another OAuth client library with the same callback URL as Stack.
        - The user opened the OAuth callback page from their history.

      Either way, it is probably safe to ignore this warning unless you are debugging an OAuth issue.
    `),null;let s=new URL(t);for(let t of e)s.searchParams.delete(t);return window.history.replaceState({},"",s.toString()),{originalUrl:t,codeVerifier:i.codeVerifier,state:r}}();if(!r)return tv.ok(void 0);try{return tv.ok(await e.callOAuthCallback({oauthParams:r.originalUrl.searchParams,redirectUri:iE(t,"redirectUri"),codeVerifier:r.codeVerifier,state:r.state}))}catch(e){if(_.isKnownError(e))throw e;throw new h.AJ("Error signing in during OAuth callback. Please try again.",{cause:e})}}var se=r(9376);let st=void 0;var sr=!1;sr=!1;var si=n(se),ss=new Map,sn=class e{constructor(t){if(this._options=t,this._uniqueIdentifier=void 0,this.__DEMO_ENABLE_SLIGHT_FETCH_DELAY=!1,this._ownedAdminApps=new tl,this._currentUserCache=iy(async e=>(this.__DEMO_ENABLE_SLIGHT_FETCH_DELAY&&await tk(2e3),e.isKnownToBeInvalid())?null:await this._interface.getClientUserByToken(e)),this._currentProjectCache=i_(async()=>tv.orThrow(await this._interface.getClientProject())),this._ownedProjectsCache=iy(async e=>await this._interface.listProjects(e)),this._currentUserPermissionsCache=iy(async(e,[t,r])=>await this._interface.listCurrentUserTeamPermissions({teamId:t,recursive:r},e)),this._currentUserProjectPermissionsCache=iy(async(e,[t])=>await this._interface.listCurrentUserProjectPermissions({recursive:t},e)),this._currentUserTeamsCache=iy(async e=>await this._interface.listCurrentUserTeams(e)),this._currentUserOAuthConnectionAccessTokensCache=iy(async(e,[t,r])=>{try{return{accessToken:(await this._interface.createProviderAccessToken(t,r||"",e)).access_token}}catch(e){if(!(ti.OAuthConnectionDoesNotHaveRequiredScope.isInstance(e)||ti.OAuthConnectionNotConnectedToUser.isInstance(e)))throw e}return null}),this._currentUserOAuthConnectionCache=iy(async(e,[t,r,i])=>await this._getUserOAuthConnectionCacheFn({getUser:async()=>tv.orThrow(await this._currentUserCache.getOrWait([e],"write-only")),getOrWaitOAuthToken:async()=>tv.orThrow(await this._currentUserOAuthConnectionAccessTokensCache.getOrWait([e,t,r||""],"write-only")),useOAuthToken:()=>iS(this._currentUserOAuthConnectionAccessTokensCache,[e,t,r||""],"useOAuthToken"),providerId:t,scope:r,redirect:i,session:e})),this._teamMemberProfilesCache=iy(async(e,[t])=>await this._interface.listTeamMemberProfiles({teamId:t},e)),this._teamInvitationsCache=iy(async(e,[t])=>await this._interface.listTeamInvitations({teamId:t},e)),this._currentUserTeamProfileCache=iy(async(e,[t])=>await this._interface.getTeamMemberProfile({teamId:t,userId:"me"},e)),this._clientContactChannelsCache=iy(async e=>await this._interface.listClientContactChannels(e)),this._userApiKeysCache=iy(async e=>await this._interface.listProjectApiKeys({user_id:"me"},e,"client")),this._teamApiKeysCache=iy(async(e,[t])=>await this._interface.listProjectApiKeys({team_id:t},e,"client")),this._anonymousSignUpInProgress=null,this._memoryTokenStore=iA(),this._nextServerCookiesTokenStores=new WeakMap,this._requestTokenStores=new WeakMap,this._storedBrowserCookieTokenStore=null,this._sessionsByTokenStoreAndSessionKey=new WeakMap,!e.LazyStackAdminAppImpl.value)throw new h.AJ("Admin app implementation not initialized. Did you import the _StackClientApp from stack-app/apps/implementations/index.ts? You can't import it directly from ./apps/implementations/client-app-impl.ts as that causes a circular dependency (see the comment at _LazyStackAdminAppImpl for more details).");"interface"in t?this._interface=t.interface:this._interface=new r7({getBaseUrl:()=>iC(t.baseUrl),extraRequestHeaders:t.extraRequestHeaders??JSON.parse(ip.env.NEXT_PUBLIC_STACK_EXTRA_REQUEST_HEADERS||"{}"),projectId:t.projectId??iw(),clientVersion:im,publishableClientKey:t.publishableClientKey??ig(),prepareRequest:async()=>{await st?.()}}),this._tokenStoreInit=t.tokenStore,this._redirectMethod=t.redirectMethod||"none",this._redirectMethod=t.redirectMethod||"nextjs",this._urlOptions=t.urls??{},this._oauthScopesOnSignIn=t.oauthScopesOnSignIn??{},t.uniqueIdentifier&&(this._uniqueIdentifier=t.uniqueIdentifier,this._initUniqueIdentifier())}async _createCookieHelper(){return"nextjs-cookie"===this._tokenStoreInit||"cookie"===this._tokenStoreInit?await iX():await iz()}async _getUserOAuthConnectionCacheFn(e){let t=await e.getUser(),r=!0;if(t&&t.oauth_providers.find(t=>t.id===e.providerId)||(r=!1),await e.getOrWaitOAuthToken()||(r=!1),!r&&e.redirect){if(!e.session)throw Error((0,m.Ac)`
          Cannot add new scopes to a user that is not a CurrentUser. Please ensure that you are calling this function on a CurrentUser object, or remove the 'or: redirect' option.

          Often, you can solve this by calling this function in the browser instead, or by removing the 'or: redirect' option and dealing with the case where the user doesn't have enough permissions.
        `);return await i8(this._interface,{provider:e.providerId,redirectUrl:this.urls.oauthCallback,errorRedirectUrl:this.urls.error,providerScope:(0,m.yf)(e.scope||"",(this._oauthScopesOnSignIn[e.providerId]??[]).join(" "))},e.session),await tT}return r?{id:e.providerId,async getAccessToken(){let t=await e.getOrWaitOAuthToken();if(!t)throw new h.AJ("No access token available");return t},useAccessToken(){let t=e.useOAuthToken();if(!t)throw new h.AJ("No access token available");return t}}:null}_initUniqueIdentifier(){if(!this._uniqueIdentifier)throw new h.AJ("Unique identifier not initialized");if(ss.has(this._uniqueIdentifier))throw new h.AJ("A Stack client app with the same unique identifier already exists");ss.set(this._uniqueIdentifier,[this._options.checkString??void 0,this])}_getUniqueIdentifier(){return this._uniqueIdentifier||(this._uniqueIdentifier=tf(),this._initUniqueIdentifier()),this._uniqueIdentifier}async _checkFeatureSupport(e,t){return await this._interface.checkFeatureSupport({...t,name:e})}_useCheckFeatureSupport(e,t){throw tA(this._checkFeatureSupport(e,t)),new h.AJ(`${e} is not currently supported. Please reach out to Stack support for more information.`)}get _refreshTokenCookieName(){return`stack-refresh-${this.projectId}`}_getTokensFromCookies(e){let t=e.refreshTokenCookie,r=e.accessTokenCookie?.startsWith('["')?JSON.parse(e.accessTokenCookie):null,i=r&&t===r[0]?r[1]:null;return{refreshToken:t,accessToken:i}}get _accessTokenCookieName(){return"stack-access"}_getBrowserCookieTokenStore(){if(!il())throw Error("Cannot use cookie token store on the server!");if(null===this._storedBrowserCookieTokenStore){let e=e=>{let t=this._getTokensFromCookies({refreshTokenCookie:i0(this._refreshTokenCookieName)??i0("stack-refresh"),accessTokenCookie:i0(this._accessTokenCookieName)});return{refreshToken:t.refreshToken,accessToken:t.accessToken??(e?.refreshToken===t.refreshToken?e.accessToken:null)}};this._storedBrowserCookieTokenStore=new r4(e(null));let t=!0;setInterval(()=>{if(t){let t=this._storedBrowserCookieTokenStore.get(),r=e(t);(0,tn.JT)(r,t)||this._storedBrowserCookieTokenStore.set(r)}},100),this._storedBrowserCookieTokenStore.onChange(e=>{try{i1(this._refreshTokenCookieName,e.refreshToken,{maxAge:31536e3}),i1(this._accessTokenCookieName,e.accessToken?JSON.stringify([e.refreshToken,e.accessToken]):null,{maxAge:86400}),i2("stack-refresh"),t=!0}catch(e){if(il())throw e;t=!1}})}return this._storedBrowserCookieTokenStore}_getOrCreateTokenStore(e,t){let r=void 0===t?this._tokenStoreInit:t;switch(r){case"cookie":return this._getBrowserCookieTokenStore();case"nextjs-cookie":if(il())return this._getBrowserCookieTokenStore();{let t=new r4(this._getTokensFromCookies({refreshTokenCookie:e.get(this._refreshTokenCookieName)??e.get("stack-refresh"),accessTokenCookie:e.get(this._accessTokenCookieName)}));return t.onChange(e=>{tA(async()=>{await Promise.all([i4(this._refreshTokenCookieName,e.refreshToken,{maxAge:31536e3,noOpIfServerComponent:!0}),i4(this._accessTokenCookieName,e.accessToken?JSON.stringify([e.refreshToken,e.accessToken]):null,{maxAge:86400,noOpIfServerComponent:!0})])})}),t}case"memory":return this._memoryTokenStore;default:if(null===r)return iA();if("object"==typeof r&&"headers"in r){if(this._requestTokenStores.has(r))return this._requestTokenStores.get(r);let t=r.headers.get("x-stack-auth");if(t){let r;try{if(r=JSON.parse(t),"object"!=typeof r)throw Error("x-stack-auth header must be a JSON object");if(null===r)throw Error("x-stack-auth header must not be null")}catch(e){throw Error(`Invalid x-stack-auth header: ${t}`,{cause:e})}return this._getOrCreateTokenStore(e,{accessToken:r.accessToken??null,refreshToken:r.refreshToken??null})}let i=r.headers.get("cookie"),s=iJ.Q(i||""),n=new r4({refreshToken:s[this._refreshTokenCookieName]||s["stack-refresh"]||null,accessToken:s[this._accessTokenCookieName]||null});return this._requestTokenStores.set(r,n),n}if("accessToken"in r||"refreshToken"in r)return new r4({refreshToken:r.refreshToken,accessToken:r.accessToken});throw Error(`Invalid token store ${r}`)}}_useTokenStore(e){ih();let t=iZ();return this._getOrCreateTokenStore(t,e)}_getSessionFromTokenStore(e){let t=e.get(),r=r6.calculateSessionKey(t),i=r?this._sessionsByTokenStoreAndSessionKey.get(e)?.get(r):null;if(i)return i;let s=this._interface.createSession({refreshToken:t.refreshToken,accessToken:t.accessToken});s.onAccessTokenChange(t=>{e.update(e=>({...e,accessToken:t?.token??null}))}),s.onInvalidate(()=>{e.update(e=>({...e,accessToken:null,refreshToken:null}))});let n=this._sessionsByTokenStoreAndSessionKey.get(e)??new Map;return this._sessionsByTokenStoreAndSessionKey.set(e,n),n.set(r,s),s}async _getSession(e){let t=this._getOrCreateTokenStore(await this._createCookieHelper(),e);return this._getSessionFromTokenStore(t)}_useSession(e){let t=this._useTokenStore(e),r=(0,ii.useCallback)(e=>{let{unsubscribe:r}=t.onChange(()=>{e()});return r},[t]),i=(0,ii.useCallback)(()=>this._getSessionFromTokenStore(t),[t]);return ii.useSyncExternalStore(r,i,i)}async _signInToAccountWithTokens(e){if(!("accessToken"in e)||!("refreshToken"in e))throw new h.AJ("Invalid tokens object; can't sign in with this",{tokens:e});this._getOrCreateTokenStore(await this._createCookieHelper()).set(e)}_hasPersistentTokenStore(e){return(void 0!==e?e:this._tokenStoreInit)!==null}_ensurePersistentTokenStore(e){if(!this._hasPersistentTokenStore(e))throw Error("Cannot call this function on a Stack app without a persistent token store. Make sure the tokenStore option on the constructor is set to a non-null value when initializing Stack.\n\nStack uses token stores to access access tokens of the current user. For example, on web frontends it is commonly the string value 'cookies' for cookie storage.")}_isInternalProject(){return"internal"===this.projectId}_ensureInternalProject(){if(!this._isInternalProject())throw Error("Cannot call this function on a Stack app with a project ID other than 'internal'.")}_clientProjectFromCrud(e){return{id:e.id,displayName:e.display_name,config:{signUpEnabled:e.config.sign_up_enabled,credentialEnabled:e.config.credential_enabled,magicLinkEnabled:e.config.magic_link_enabled,passkeyEnabled:e.config.passkey_enabled,clientTeamCreationEnabled:e.config.client_team_creation_enabled,clientUserDeletionEnabled:e.config.client_user_deletion_enabled,allowTeamApiKeys:e.config.allow_team_api_keys,allowUserApiKeys:e.config.allow_user_api_keys,oauthProviders:e.config.enabled_oauth_providers.map(e=>({id:e.id}))}}}_clientPermissionFromCrud(e){return{id:e.id}}_clientTeamUserFromCrud(e){return{id:e.user_id,teamProfile:{displayName:e.display_name,profileImageUrl:e.profile_image_url}}}_clientTeamInvitationFromCrud(e,t){return{id:t.id,recipientEmail:t.recipient_email,expiresAt:new Date(t.expires_at_millis),revoke:async()=>{await this._interface.revokeTeamInvitation(t.id,t.team_id,e),await this._teamInvitationsCache.refresh([e,t.team_id])}}}_baseApiKeyFromCrud(e){return{id:e.id,description:e.description,expiresAt:e.expires_at_millis?new Date(e.expires_at_millis):void 0,manuallyRevokedAt:e.manually_revoked_at_millis?new Date(e.manually_revoked_at_millis):null,createdAt:new Date(e.created_at_millis),..."team"===e.type?{type:"team",teamId:e.team_id}:{type:"user",userId:e.user_id},value:"string"==typeof e.value?e.value:{lastFour:e.value.last_four},isValid:function(){return null===this.whyInvalid()},whyInvalid:function(){return this.manuallyRevokedAt?"manually-revoked":this.expiresAt&&this.expiresAt<new Date?"expired":null}}}_clientApiKeyFromCrud(e,t){return{...this._baseApiKeyFromCrud(t),async revoke(){await this.update({revoked:!0})},update:async r=>{await this._interface.updateProjectApiKey("team"===t.type?{team_id:t.team_id}:{user_id:t.user_id},t.id,r,e,"client"),"team"===t.type?await this._teamApiKeysCache.refresh([e,t.team_id]):await this._userApiKeysCache.refresh([e])}}}_clientTeamFromCrud(e,t){let r=this;return{id:e.id,displayName:e.display_name,profileImageUrl:e.profile_image_url,clientMetadata:e.client_metadata,clientReadOnlyMetadata:e.client_read_only_metadata,async inviteUser(i){await r._interface.sendTeamInvitation({teamId:e.id,email:i.email,session:t,callbackUrl:i.callbackUrl??iE(r.urls.teamInvitation,"callbackUrl")}),await r._teamInvitationsCache.refresh([t,e.id])},listUsers:async()=>tv.orThrow(await r._teamMemberProfilesCache.getOrWait([t,e.id],"write-only")).map(e=>r._clientTeamUserFromCrud(e)),useUsers:()=>iS(r._teamMemberProfilesCache,[t,e.id],"team.useUsers()").map(e=>r._clientTeamUserFromCrud(e)),listInvitations:async()=>tv.orThrow(await r._teamInvitationsCache.getOrWait([t,e.id],"write-only")).map(e=>r._clientTeamInvitationFromCrud(t,e)),useInvitations:()=>iS(r._teamInvitationsCache,[t,e.id],"team.useInvitations()").map(e=>r._clientTeamInvitationFromCrud(t,e)),async update(i){await r._interface.updateTeam({data:{display_name:i.displayName,profile_image_url:i.profileImageUrl,client_metadata:i.clientMetadata},teamId:e.id},t),await r._currentUserTeamsCache.refresh([t])},async delete(){await r._interface.deleteTeam(e.id,t),await r._currentUserTeamsCache.refresh([t])},useApiKeys:()=>iS(r._teamApiKeysCache,[t,e.id],"team.useApiKeys()").map(e=>r._clientApiKeyFromCrud(t,e)),listApiKeys:async()=>tv.orThrow(await r._teamApiKeysCache.getOrWait([t,e.id],"write-only")).map(e=>r._clientApiKeyFromCrud(t,e)),async createApiKey(i){let s=await r._interface.createProjectApiKey(await ib("team",e.id,i),t,"client");return await r._teamApiKeysCache.refresh([t,e.id]),r._clientApiKeyFromCrud(t,s)}}}_clientContactChannelFromCrud(e,t){let r=this;return{id:e.id,value:e.value,type:e.type,isVerified:e.is_verified,isPrimary:e.is_primary,usedForAuth:e.used_for_auth,async sendVerificationEmail(i){await r._interface.sendCurrentUserContactChannelVerificationEmail(e.id,i?.callbackUrl||iE(r.urls.emailVerification,"callbackUrl"),t)},async update(i){await r._interface.updateClientContactChannel(e.id,{value:i.value,used_for_auth:i.usedForAuth,is_primary:i.isPrimary},t),await r._clientContactChannelsCache.refresh([t])},async delete(){await r._interface.deleteClientContactChannel(e.id,t),await r._clientContactChannelsCache.refresh([t])}}}_createAuth(e){let t=this;return{_internalSession:e,currentSession:{async getTokens(){let t=await e.getOrFetchLikelyValidTokens(2e4);return{accessToken:t?.accessToken.token??null,refreshToken:t?.refreshToken?.token??null}}},async getAuthHeaders(){return{"x-stack-auth":JSON.stringify(await this.getAuthJson())}},async getAuthJson(){return await this.currentSession.getTokens()},async registerPasskey(r){let i;let s=(await t._getCurrentUrl())?.hostname;if(!s)throw new h.AJ("hostname must be provided if the Stack App does not have a redirect method");let n=await t._interface.initiatePasskeyRegistration({},e);if("ok"!==n.status)return tv.error(new ti.PasskeyRegistrationFailed("Failed to get initiation options for passkey registration"));let{options_json:a,code:o}=n.data;if("THIS_VALUE_WILL_BE_REPLACED.example.com"!==a.rp.id)throw new h.AJ(`Expected returned RP ID from server to equal sentinel, but found ${a.rp.id}`);a.rp.id=s;try{i=await i$({optionsJSON:a})}catch(e){if(e instanceof ix)return tv.error(new ti.PasskeyWebAuthnError(e.message,e.name));return(0,h.O7)("passkey-registration-failed",e),tv.error(new ti.PasskeyRegistrationFailed("Failed to start passkey registration due to unknown error"))}let c=await t._interface.registerPasskey({credential:i,code:o},e);return await t._refreshUser(e),c},signOut:r=>t._signOut(e,r)}}_editableTeamProfileFromCrud(e,t){let r=this;return{displayName:e.display_name,profileImageUrl:e.profile_image_url,async update(i){await r._interface.updateTeamMemberProfile({teamId:e.team_id,userId:e.user_id,profile:{display_name:i.displayName,profile_image_url:i.profileImageUrl}},t),await r._currentUserTeamProfileCache.refresh([t,e.team_id])}}}_createBaseUser(e){return{id:e.id,displayName:e.display_name,primaryEmail:e.primary_email,primaryEmailVerified:e.primary_email_verified,profileImageUrl:e.profile_image_url,signedUpAt:new Date(e.signed_up_at_millis),clientMetadata:e.client_metadata,clientReadOnlyMetadata:e.client_read_only_metadata,hasPassword:e.has_password,emailAuthEnabled:e.auth_with_email,otpAuthEnabled:e.otp_auth_enabled,oauthProviders:e.oauth_providers,passkeyAuthEnabled:e.passkey_auth_enabled,isMultiFactorRequired:e.requires_totp_mfa,isAnonymous:e.is_anonymous,toClientJson:()=>e}}_createUserExtraFromCurrent(e,t){let r=this;return{getActiveSessions:async()=>(await r._interface.listSessions(t)).items.map(e=>r._clientSessionFromCrud(e)),async revokeSession(e){await r._interface.deleteSession(e,t)},setDisplayName(e){return this.update({displayName:e})},setClientMetadata(e){return this.update({clientMetadata:e})},async setSelectedTeam(e){await this.update({selectedTeamId:e?.id??null})},getConnectedAccount:async function(e,i){let s=i?.scopes?.join(" ");return tv.orThrow(await r._currentUserOAuthConnectionCache.getOrWait([t,e,s||"",i?.or==="redirect"],"write-only"))},useConnectedAccount:function(e,i){let s=i?.scopes?.join(" ");return iS(r._currentUserOAuthConnectionCache,[t,e,s||"",i?.or==="redirect"],"user.useConnectedAccount()")},async getTeam(e){return(await this.listTeams()).find(t=>t.id===e)??null},useTeam(e){let t=this.useTeams();return(0,ii.useMemo)(()=>t.find(t=>t.id===e)??null,[t,e])},listTeams:async()=>tv.orThrow(await r._currentUserTeamsCache.getOrWait([t],"write-only")).map(e=>r._clientTeamFromCrud(e,t)),useTeams(){let e=iS(r._currentUserTeamsCache,[t],"user.useTeams()");return(0,ii.useMemo)(()=>e.map(e=>r._clientTeamFromCrud(e,t)),[e])},async createTeam(e){let i=await r._interface.createClientTeam({display_name:e.displayName,profile_image_url:e.profileImageUrl,creator_user_id:"me"},t);return await r._currentUserTeamsCache.refresh([t]),await this.update({selectedTeamId:i.id}),r._clientTeamFromCrud(i,t)},async leaveTeam(e){await r._interface.leaveTeam(e.id,t)},async listPermissions(e,i){if(e&&"id"in e){let s=i?.recursive??!0;return tv.orThrow(await r._currentUserPermissionsCache.getOrWait([t,e.id,s],"write-only")).map(e=>r._clientPermissionFromCrud(e))}{let i=e?.recursive??!0;return tv.orThrow(await r._currentUserProjectPermissionsCache.getOrWait([t,i],"write-only")).map(e=>r._clientPermissionFromCrud(e))}},usePermissions(e,i){if(e&&"id"in e){let s=i?.recursive??!0,n=iS(r._currentUserPermissionsCache,[t,e.id,s],"user.usePermissions()");return(0,ii.useMemo)(()=>n.map(e=>r._clientPermissionFromCrud(e)),[n])}{let i=e?.recursive??!0,s=iS(r._currentUserProjectPermissionsCache,[t,i],"user.usePermissions()");return(0,ii.useMemo)(()=>s.map(e=>r._clientPermissionFromCrud(e)),[s])}},usePermission(e,t){if(e&&"string"!=typeof e){let r=this.usePermissions(e);return(0,ii.useMemo)(()=>r.find(e=>e.id===t)??null,[r,t])}{let t=this.usePermissions();return(0,ii.useMemo)(()=>t.find(t=>t.id===e)??null,[t,e])}},async getPermission(e,t){return e&&"string"!=typeof e?(await this.listPermissions(e)).find(e=>e.id===t)??null:(await this.listPermissions()).find(t=>t.id===e)??null},async hasPermission(e,t){return e&&"string"!=typeof e?await this.getPermission(e,t)!==null:await this.getPermission(e)!==null},update:async e=>await r._updateClientUser(e,t),async sendVerificationEmail(i){if(!e.primary_email)throw new h.AJ("User does not have a primary email");return await r._interface.sendVerificationEmail(e.primary_email,i?.callbackUrl??iE(r.urls.emailVerification,"callbackUrl"),t)},async updatePassword(e){let i=await r._interface.updatePassword(e,t);return await r._currentUserCache.refresh([t]),i},async setPassword(e){let i=await r._interface.setPassword(e,t);return await r._currentUserCache.refresh([t]),i},selectedTeam:e.selected_team&&this._clientTeamFromCrud(e.selected_team,t),async getTeamProfile(e){let i=tv.orThrow(await r._currentUserTeamProfileCache.getOrWait([t,e.id],"write-only"));return r._editableTeamProfileFromCrud(i,t)},useTeamProfile(e){let i=iS(r._currentUserTeamProfileCache,[t,e.id],"user.useTeamProfile()");return r._editableTeamProfileFromCrud(i,t)},async delete(){await r._interface.deleteCurrentUser(t),t.markInvalid()},listContactChannels:async()=>tv.orThrow(await r._clientContactChannelsCache.getOrWait([t],"write-only")).map(e=>r._clientContactChannelFromCrud(e,t)),useContactChannels:()=>iS(r._clientContactChannelsCache,[t],"user.useContactChannels()").map(e=>r._clientContactChannelFromCrud(e,t)),async createContactChannel(e){let i=await r._interface.createClientContactChannel({value:e.value,type:e.type,used_for_auth:e.usedForAuth,is_primary:e.isPrimary,user_id:"me"},t);return await r._clientContactChannelsCache.refresh([t]),r._clientContactChannelFromCrud(i,t)},useApiKeys:()=>iS(r._userApiKeysCache,[t],"user.useApiKeys()").map(e=>r._clientApiKeyFromCrud(t,e)),listApiKeys:async()=>(await r._interface.listProjectApiKeys({user_id:"me"},t,"client")).map(e=>r._clientApiKeyFromCrud(t,e)),async createApiKey(e){let i=await r._interface.createProjectApiKey(await ib("user","me",e),t,"client");return await r._userApiKeysCache.refresh([t]),r._clientApiKeyFromCrud(t,i)}}}_createInternalUserExtra(e){let t=this;return this._ensureInternalProject(),{createProject:r=>t._createProject(e,r),listOwnedProjects:()=>t._listOwnedProjects(e),useOwnedProjects:()=>t._useOwnedProjects(e)}}_currentUserFromCrud(e,t){let r={...this._createBaseUser(e),...this._createAuth(t),...this._createUserExtraFromCurrent(e,t),...this._isInternalProject()?this._createInternalUserExtra(t):{}};return Object.freeze(r),r}_clientSessionFromCrud(e){return{id:e.id,userId:e.user_id,createdAt:new Date(e.created_at),isImpersonation:e.is_impersonation,lastUsedAt:e.last_used_at?new Date(e.last_used_at):void 0,isCurrentSession:e.is_current_session??!1,geoInfo:e.last_used_at_end_user_ip_info}}_getOwnedAdminApp(t,r){return this._ownedAdminApps.has([r,t])||this._ownedAdminApps.set([r,t],new e.LazyStackAdminAppImpl.value({baseUrl:this._interface.options.getBaseUrl(),projectId:t,tokenStore:null,projectOwnerSession:r,noAutomaticPrefetch:!0})),this._ownedAdminApps.get([r,t])}get projectId(){return this._interface.projectId}async _isTrusted(e){return function(e){let t=`${t_()}.stack-auth.example.com`,r=tU(e,`https://${t}`);return!!r&&r.host===t&&"https:"===r.protocol}(e)}get urls(){return function(e){let t=e.handler??"/handler",r=e.home??"/",i=e.afterSignIn??r;return{handler:t,signIn:`${t}/sign-in`,afterSignIn:r,signUp:`${t}/sign-up`,afterSignUp:i,signOut:`${t}/sign-out`,afterSignOut:r,emailVerification:`${t}/email-verification`,passwordReset:`${t}/password-reset`,forgotPassword:`${t}/forgot-password`,oauthCallback:`${t}/oauth-callback`,magicLinkCallback:`${t}/magic-link-callback`,home:r,accountSettings:`${t}/account-settings`,error:`${t}/error`,teamInvitation:`${t}/team-invitation`,mfa:`${t}/mfa`,...(0,tn.YU)(e)}}(this._urlOptions)}async _getCurrentUrl(){return"none"===this._redirectMethod?null:new URL(window.location.href)}async _redirectTo(e){"none"!==this._redirectMethod&&(sr&&"nextjs"===this._redirectMethod?si.redirect(e.url.toString(),e.replace?si.RedirectType.replace:si.RedirectType.push):"object"==typeof this._redirectMethod&&this._redirectMethod.navigate?this._redirectMethod.navigate(e.url.toString()):e.replace?window.location.replace(e.url):window.location.assign(e.url),await tk(2e3))}useNavigate(){if("object"==typeof this._redirectMethod)return this._redirectMethod.useNavigate();if("window"===this._redirectMethod)return e=>window.location.assign(e);if("nextjs"!==this._redirectMethod)return e=>{};{let e=si.useRouter();return t=>e.push(t)}}async _redirectIfTrusted(e,t){if(!await this._isTrusted(e))throw Error(`Redirect URL ${e} is not trusted; should be relative.`);return await this._redirectTo({url:e,...t})}async _redirectToHandler(e,t){let r=this.urls[e];if(!r)throw Error(`No URL for handler name ${e}`);if(!t?.noRedirectBack){if("afterSignIn"===e||"afterSignUp"===e)sr||"undefined"==typeof window||(r=new URLSearchParams(window.location.search).get("after_auth_return_to")||r);else if("signIn"===e||"signUp"===e){if(sr||"undefined"==typeof window);else{let e=new URL(window.location.href),t=new URL(r,e);e.searchParams.has("after_auth_return_to")?t.searchParams.set("after_auth_return_to",e.searchParams.get("after_auth_return_to")):e.protocol===t.protocol&&e.host===t.host&&t.searchParams.set("after_auth_return_to",tj(e)),r=tj(t)}}}await this._redirectIfTrusted(r,t)}async redirectToSignIn(e){return await this._redirectToHandler("signIn",e)}async redirectToSignUp(e){return await this._redirectToHandler("signUp",e)}async redirectToSignOut(e){return await this._redirectToHandler("signOut",e)}async redirectToEmailVerification(e){return await this._redirectToHandler("emailVerification",e)}async redirectToPasswordReset(e){return await this._redirectToHandler("passwordReset",e)}async redirectToForgotPassword(e){return await this._redirectToHandler("forgotPassword",e)}async redirectToHome(e){return await this._redirectToHandler("home",e)}async redirectToOAuthCallback(e){return await this._redirectToHandler("oauthCallback",e)}async redirectToMagicLinkCallback(e){return await this._redirectToHandler("magicLinkCallback",e)}async redirectToAfterSignIn(e){return await this._redirectToHandler("afterSignIn",e)}async redirectToAfterSignUp(e){return await this._redirectToHandler("afterSignUp",e)}async redirectToAfterSignOut(e){return await this._redirectToHandler("afterSignOut",e)}async redirectToAccountSettings(e){return await this._redirectToHandler("accountSettings",e)}async redirectToError(e){return await this._redirectToHandler("error",e)}async redirectToTeamInvitation(e){return await this._redirectToHandler("teamInvitation",e)}async redirectToMfa(e){return await this._redirectToHandler("mfa",e)}async sendForgotPasswordEmail(e,t){return await this._interface.sendForgotPasswordEmail(e,t?.callbackUrl??iE(this.urls.passwordReset,"callbackUrl"))}async sendMagicLinkEmail(e,t){return await this._interface.sendMagicLinkEmail(e,t?.callbackUrl??iE(this.urls.magicLinkCallback,"callbackUrl"))}async resetPassword(e){return await this._interface.resetPassword(e)}async verifyPasswordResetCode(e){return await this._interface.verifyPasswordResetCode(e)}async verifyTeamInvitationCode(e){return await this._interface.acceptTeamInvitation({type:"check",code:e,session:await this._getSession()})}async acceptTeamInvitation(e){let t=await this._interface.acceptTeamInvitation({type:"use",code:e,session:await this._getSession()});return"ok"===t.status?tv.ok(void 0):tv.error(t.error)}async getTeamInvitationDetails(e){let t=await this._interface.acceptTeamInvitation({type:"details",code:e,session:await this._getSession()});return"ok"===t.status?tv.ok({teamDisplayName:t.data.team_display_name}):tv.error(t.error)}async verifyEmail(e){let t=await this._interface.verifyEmail(e);return await this._currentUserCache.refresh([await this._getSession()]),await this._clientContactChannelsCache.refresh([await this._getSession()]),t}async getUser(e){this._ensurePersistentTokenStore(e?.tokenStore);let t=await this._getSession(e?.tokenStore),r=tv.orThrow(await this._currentUserCache.getOrWait([t],"write-only"));if(r?.is_anonymous&&e?.or!=="anonymous"&&e?.or!=="anonymous-if-exists"&&(r=null),null===r)switch(e?.or){case"redirect":await this.redirectToSignIn({replace:!0});break;case"throw":throw Error("User is not signed in but getUser was called with { or: 'throw' }");case"anonymous":{let e=await this._signUpAnonymously();return await this.getUser({tokenStore:e,or:"anonymous-if-exists"})??(0,h.fZ)("Something went wrong while signing up anonymously")}case void 0:case"anonymous-if-exists":case"return-null":return null}return r&&this._currentUserFromCrud(r,t)}useUser(e){this._ensurePersistentTokenStore(e?.tokenStore);let t=this._useSession(e?.tokenStore),r=iS(this._currentUserCache,[t],"useUser()");if(r?.is_anonymous&&e?.or!=="anonymous"&&e?.or!=="anonymous-if-exists"&&(r=null),null===r)switch(e?.or){case"redirect":throw tA(this.redirectToSignIn({replace:!0})),iu(),new h.AJ("suspend should never return");case"throw":throw Error("User is not signed in but useUser was called with { or: 'throw' }");case"anonymous":throw tA(async()=>{await this._signUpAnonymously(),"undefined"!=typeof window&&window.location.reload()}),iu(),new h.AJ("suspend should never return")}return(0,ii.useMemo)(()=>r&&this._currentUserFromCrud(r,t),[r,t,e?.or])}async _updateClientUser(e,t){let r=await this._interface.updateClientUser({display_name:e.displayName,client_metadata:e.clientMetadata,selected_team_id:e.selectedTeamId,totp_secret_base64:null!=e.totpMultiFactorSecret?th(e.totpMultiFactorSecret):e.totpMultiFactorSecret,profile_image_url:e.profileImageUrl,otp_auth_enabled:e.otpAuthEnabled,passkey_auth_enabled:e.passkeyAuthEnabled},t);return await this._refreshUser(t),r}async signInWithOAuth(e){if("undefined"==typeof window)throw Error("signInWithOAuth can currently only be called in a browser environment");this._ensurePersistentTokenStore(),await i6(this._interface,{provider:e,redirectUrl:this.urls.oauthCallback,errorRedirectUrl:this.urls.error,providerScope:this._oauthScopesOnSignIn[e]?.join(" ")})}async _experimentalMfa(e,t){throw"undefined"!=typeof window&&window.sessionStorage.setItem("stack_mfa_attempt_code",e.details?.attempt_code??(0,h.fZ)("attempt code missing")),await this.redirectToMfa(),new h.AJ("we should have redirected in redirectToMfa()")}async _catchMfaRequiredError(e){try{return await e()}catch(e){if(ti.MultiFactorAuthenticationRequired.isInstance(e))return tv.ok(await this._experimentalMfa(e,await this._getSession()));throw e}}async signInWithCredential(e){let t;this._ensurePersistentTokenStore();let r=await this._getSession();try{t=await this._catchMfaRequiredError(async()=>await this._interface.signInWithCredential(e.email,e.password,r))}catch(e){if(ti.InvalidTotpCode.isInstance(e))return tv.error(e);throw e}return"ok"===t.status?(await this._signInToAccountWithTokens(t.data),e.noRedirect||await this.redirectToAfterSignIn({replace:!0}),tv.ok(void 0)):tv.error(t.error)}async signUpWithCredential(e){this._ensurePersistentTokenStore();let t=await this._getSession(),r=e.verificationCallbackUrl??iE(this.urls.emailVerification,"verificationCallbackUrl"),i=await this._interface.signUpWithCredential(e.email,e.password,r,t);return"ok"===i.status?(await this._signInToAccountWithTokens(i.data),e.noRedirect||await this.redirectToAfterSignUp({replace:!0}),tv.ok(void 0)):tv.error(i.error)}async _signUpAnonymously(){return this._ensurePersistentTokenStore(),this._anonymousSignUpInProgress||(this._anonymousSignUpInProgress=(async()=>{this._ensurePersistentTokenStore();let e=await this._getSession(),t=await this._interface.signUpAnonymously(e);if("ok"===t.status)await this._signInToAccountWithTokens(t.data);else throw new h.AJ("signUpAnonymously() should never return an error");return this._anonymousSignUpInProgress=null,t.data})()),await this._anonymousSignUpInProgress}async signInWithMagicLink(e,t){let r;this._ensurePersistentTokenStore();try{r=await this._catchMfaRequiredError(async()=>await this._interface.signInWithMagicLink(e))}catch(e){if(ti.InvalidTotpCode.isInstance(e))return tv.error(e);throw e}return"ok"===r.status?(await this._signInToAccountWithTokens(r.data),t?.noRedirect||(r.data.newUser?await this.redirectToAfterSignUp({replace:!0}):await this.redirectToAfterSignIn({replace:!0})),tv.ok(void 0)):tv.error(r.error)}async promptCliLogin(e){let t=await this._interface.sendClientRequest("/auth/cli",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({expires_in_millis:e.expiresInMillis})},null);if(!t.ok)return tv.error(new ti.CliAuthError(`Failed to initiate CLI auth: ${t.status} ${await t.text()}`));let r=await t.json(),i=r.polling_code,s=r.login_code,n=`${e.appUrl}/handler/cli-auth-confirm?login_code=${encodeURIComponent(s)}`;e.promptLink?e.promptLink(n):console.log(`Please visit the following URL to authenticate:
${n}`);let a=0;for(;a<(e.maxAttempts??1/0);){a++;let t=await this._interface.sendClientRequest("/auth/cli/poll",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({polling_code:i})},null);if(!t.ok)return tv.error(new ti.CliAuthError(`Failed to initiate CLI auth: ${t.status} ${await t.text()}`));let r=await t.json();if(201===t.status&&"success"===r.status)return tv.ok(r.refresh_token);if("waiting"===r.status){await tk(e.waitTimeMillis??2e3);continue}if("expired"===r.status)return tv.error(new ti.CliAuthExpiredError("CLI authentication request expired. Please try again."));if("used"===r.status)return tv.error(new ti.CliAuthUsedError("This authentication token has already been used."));return tv.error(new ti.CliAuthError(`Unexpected status from CLI auth polling: ${r.status}`))}return tv.error(new ti.CliAuthError("Timed out waiting for CLI authentication."))}async signInWithMfa(e,t,r){let i;this._ensurePersistentTokenStore();try{i=await this._catchMfaRequiredError(async()=>await this._interface.signInWithMfa(e,t))}catch(e){if(e instanceof ti.InvalidTotpCode)return tv.error(e);throw e}return"ok"===i.status?(await this._signInToAccountWithTokens(i.data),r?.noRedirect||(i.data.newUser?await this.redirectToAfterSignUp({replace:!0}):await this.redirectToAfterSignIn({replace:!0})),tv.ok(void 0)):tv.error(i.error)}async signInWithPasskey(){let e;this._ensurePersistentTokenStore();let t=await this._getSession();try{e=await this._catchMfaRequiredError(async()=>{let e=await this._interface.initiatePasskeyAuthentication({},t);if("ok"!==e.status)return tv.error(new ti.PasskeyAuthenticationFailed("Failed to get initiation options for passkey authentication"));let{options_json:r,code:i}=e.data;if("THIS_VALUE_WILL_BE_REPLACED.example.com"!==r.rpId)throw new h.AJ(`Expected returned RP ID from server to equal sentinel, but found ${r.rpId}`);r.rpId=window.location.hostname;let s=await iF({optionsJSON:r});return await this._interface.signInWithPasskey({authentication_response:s,code:i})})}catch(e){if(e instanceof ix)return tv.error(new ti.PasskeyWebAuthnError(e.message,e.name));return tv.error(new ti.PasskeyAuthenticationFailed("Failed to sign in with passkey"))}return"ok"===e.status?(await this._signInToAccountWithTokens(e.data),await this.redirectToAfterSignIn({replace:!0}),tv.ok(void 0)):tv.error(e.error)}async callOAuthCallback(){let e;if("undefined"==typeof window)throw Error("callOAuthCallback can currently only be called in a browser environment");this._ensurePersistentTokenStore();try{e=await this._catchMfaRequiredError(async()=>await i7(this._interface,this.urls.oauthCallback))}catch(e){if(ti.InvalidTotpCode.isInstance(e))return alert("Invalid TOTP code. Please try signing in again."),!1;throw e}return"ok"===e.status&&!!e.data&&((await this._signInToAccountWithTokens(e.data),"afterCallbackRedirectUrl"in e.data&&e.data.afterCallbackRedirectUrl)?await this._redirectTo({url:e.data.afterCallbackRedirectUrl,replace:!0}):e.data.newUser?await this.redirectToAfterSignUp({replace:!0}):await this.redirectToAfterSignIn({replace:!0}),!0)}async _signOut(e,t){await r2.withWriteLock(async()=>{await this._interface.signOut(e),t?.redirectUrl?await this._redirectTo({url:t.redirectUrl,replace:!0}):await this.redirectToAfterSignOut()})}async signOut(e){let t=await this.getUser();t&&await t.signOut(e)}async getProject(){let e=tv.orThrow(await this._currentProjectCache.getOrWait([],"write-only"));return this._clientProjectFromCrud(e)}useProject(){let e=iS(this._currentProjectCache,[],"useProject()");return(0,ii.useMemo)(()=>this._clientProjectFromCrud(e),[e])}async _listOwnedProjects(e){return this._ensureInternalProject(),tv.orThrow(await this._ownedProjectsCache.getOrWait([e],"write-only")).map(t=>this._getOwnedAdminApp(t.id,e)._adminOwnedProjectFromCrud(t,()=>this._refreshOwnedProjects(e)))}_useOwnedProjects(e){this._ensureInternalProject();let t=iS(this._ownedProjectsCache,[e],"useOwnedProjects()");return(0,ii.useMemo)(()=>t.map(t=>this._getOwnedAdminApp(t.id,e)._adminOwnedProjectFromCrud(t,()=>this._refreshOwnedProjects(e))),[t])}async _createProject(e,t){this._ensureInternalProject();let r=await this._interface.createProject({...ia(t),display_name:t.displayName},e),i=this._getOwnedAdminApp(r.id,e)._adminOwnedProjectFromCrud(r,()=>this._refreshOwnedProjects(e));return await this._refreshOwnedProjects(e),i}async _refreshUser(e){await this._refreshSession(e)}async _refreshSession(e){await this._currentUserCache.refresh([e])}async _refreshUsers(){}async _refreshProject(){await this._currentProjectCache.refresh([])}async _refreshOwnedProjects(e){await this._ownedProjectsCache.refresh([e])}static get[is.G](){return{fromClientJson:t=>{let r=JSON.stringify((0,tn.CE)(t,[])),i=ss.get(t.uniqueIdentifier);if(i){let[e,s]=i;if(void 0!==e&&e!==r)throw new h.AJ("The provided app JSON does not match the configuration of the existing client app with the same unique identifier",{providedObj:t,existingString:e});return s}return new e({...t,checkString:r})}}}get[is.G](){return{toClientJson:()=>{if(!("publishableClientKey"in this._interface.options))throw new h.AJ("Cannot serialize to JSON from an application without a publishable client key");if("string"!=typeof this._redirectMethod)throw new h.AJ("Cannot serialize to JSON from an application with a non-string redirect method");return{baseUrl:this._options.baseUrl,projectId:this.projectId,publishableClientKey:this._interface.options.publishableClientKey,tokenStore:this._tokenStoreInit,urls:this._urlOptions,oauthScopesOnSignIn:this._oauthScopesOnSignIn,uniqueIdentifier:this._getUniqueIdentifier(),redirectMethod:this._redirectMethod,extraRequestHeaders:this._options.extraRequestHeaders}},setCurrentUser:e=>{tA(async()=>{await this._currentUserCache.forceSetCachedValueAsync([await this._getSession()],tv.fromPromise(e))})},sendRequest:async(e,t,r="client")=>await this._interface.sendClientRequest(e,t,await this._getSession(),r)}}};sn.LazyStackAdminAppImpl={value:void 0};var sa=sn,so=class extends sa{constructor(e){super("interface"in e?{interface:e.interface,tokenStore:e.tokenStore,urls:e.urls,oauthScopesOnSignIn:e.oauthScopesOnSignIn}:{interface:new ie({getBaseUrl:()=>iC(e.baseUrl),projectId:e.projectId??iw(),extraRequestHeaders:e.extraRequestHeaders??{},clientVersion:im,publishableClientKey:e.publishableClientKey??ig(),secretServerKey:e.secretServerKey??iT()}),baseUrl:e.baseUrl,extraRequestHeaders:e.extraRequestHeaders,projectId:e.projectId,publishableClientKey:e.publishableClientKey,tokenStore:e.tokenStore,urls:e.urls,oauthScopesOnSignIn:e.oauthScopesOnSignIn,redirectMethod:e.redirectMethod}),this._currentServerUserCache=iy(async e=>e.isKnownToBeInvalid()?null:await this._interface.getServerUserByToken(e)),this._serverUsersCache=i_(async([e,t,r,i,s])=>await this._interface.listServerUsers({cursor:e,limit:t,orderBy:r,desc:i,query:s})),this._serverUserCache=i_(async([e])=>{let t=await this._interface.getServerUserById(e);return tv.or(t,null)}),this._serverTeamsCache=i_(async([e])=>await this._interface.listServerTeams({userId:e})),this._serverTeamUserPermissionsCache=i_(async([e,t,r])=>await this._interface.listServerTeamPermissions({teamId:e,userId:t,recursive:r},null)),this._serverUserProjectPermissionsCache=i_(async([e,t])=>await this._interface.listServerProjectPermissions({userId:e,recursive:t},null)),this._serverUserOAuthConnectionAccessTokensCache=i_(async([e,t,r])=>{try{return{accessToken:(await this._interface.createServerProviderAccessToken(e,t,r||"")).access_token}}catch(e){if(!(ti.OAuthConnectionDoesNotHaveRequiredScope.isInstance(e)||ti.OAuthConnectionNotConnectedToUser.isInstance(e)))throw e}return null}),this._serverUserOAuthConnectionCache=i_(async([e,t,r,i])=>await this._getUserOAuthConnectionCacheFn({getUser:async()=>tv.orThrow(await this._serverUserCache.getOrWait([e],"write-only")),getOrWaitOAuthToken:async()=>tv.orThrow(await this._serverUserOAuthConnectionAccessTokensCache.getOrWait([e,t,r||""],"write-only")),useOAuthToken:()=>iS(this._serverUserOAuthConnectionAccessTokensCache,[e,t,r||""],"user.useConnectedAccount()"),providerId:t,scope:r,redirect:i,session:null})),this._serverTeamMemberProfilesCache=i_(async([e])=>await this._interface.listServerTeamMemberProfiles({teamId:e})),this._serverTeamInvitationsCache=i_(async([e])=>await this._interface.listServerTeamInvitations({teamId:e})),this._serverUserTeamProfileCache=i_(async([e,t])=>await this._interface.getServerTeamMemberProfile({teamId:e,userId:t})),this._serverContactChannelsCache=i_(async([e])=>await this._interface.listServerContactChannels(e)),this._serverUserApiKeysCache=i_(async([e])=>await this._interface.listProjectApiKeys({user_id:e},null,"server")),this._serverTeamApiKeysCache=i_(async([e])=>await this._interface.listProjectApiKeys({team_id:e},null,"server")),this._serverCheckApiKeyCache=i_(async([e,t])=>await this._interface.checkProjectApiKey(e,t,null,"server"))}async _updateServerUser(e,t){let r=await this._interface.updateServerUser(e,{display_name:t.displayName,primary_email:t.primaryEmail,client_metadata:t.clientMetadata,client_read_only_metadata:t.clientReadOnlyMetadata,server_metadata:t.serverMetadata,selected_team_id:t.selectedTeamId,primary_email_auth_enabled:t.primaryEmailAuthEnabled,primary_email_verified:t.primaryEmailVerified,password:t.password,profile_image_url:t.profileImageUrl,totp_secret_base64:null!=t.totpMultiFactorSecret?th(t.totpMultiFactorSecret):t.totpMultiFactorSecret});return await this._refreshUsers(),r}_serverEditableTeamProfileFromCrud(e){let t=this;return{displayName:e.display_name,profileImageUrl:e.profile_image_url,async update(r){await t._interface.updateServerTeamMemberProfile({teamId:e.team_id,userId:e.user_id,profile:{display_name:r.displayName,profile_image_url:r.profileImageUrl}}),await t._serverUserTeamProfileCache.refresh([e.team_id,e.user_id])}}}_serverContactChannelFromCrud(e,t){let r=this;return{id:t.id,value:t.value,type:t.type,isVerified:t.is_verified,isPrimary:t.is_primary,usedForAuth:t.used_for_auth,async sendVerificationEmail(i){await r._interface.sendServerContactChannelVerificationEmail(e,t.id,i?.callbackUrl??iE(r.urls.emailVerification,"callbackUrl"))},async update(i){await r._interface.updateServerContactChannel(e,t.id,{value:i.value,is_verified:i.isVerified,used_for_auth:i.usedForAuth,is_primary:i.isPrimary}),await Promise.all([r._serverContactChannelsCache.refresh([e]),r._serverUserCache.refresh([e])])},async delete(){await r._interface.deleteServerContactChannel(e,t.id),await Promise.all([r._serverContactChannelsCache.refresh([e]),r._serverUserCache.refresh([e])])}}}_serverApiKeyFromCrud(e){return{...this._baseApiKeyFromCrud(e),async revoke(){await this.update({revoked:!0})},update:async t=>{await this._interface.updateProjectApiKey("team"===e.type?{team_id:e.team_id}:{user_id:e.user_id},e.id,await iI(e.type,t),null,"server"),"team"===e.type?await this._serverTeamApiKeysCache.refresh([e.team_id]):await this._serverUserApiKeysCache.refresh([e.user_id])}}}_serverUserFromCrud(e){let t=this;async function r(r,i){let s=i?.scopes?.join(" ");return tv.orThrow(await t._serverUserOAuthConnectionCache.getOrWait([e.id,r,s||"",i?.or==="redirect"],"write-only"))}return{...super._createBaseUser(e),lastActiveAt:new Date(e.last_active_at_millis),serverMetadata:e.server_metadata,async setPrimaryEmail(r,i){await t._updateServerUser(e.id,{primaryEmail:r,primaryEmailVerified:i?.verified})},async grantPermission(r,i){if(r&&"string"!=typeof r&&i)for(let s of(await t._interface.grantServerTeamUserPermission(r.id,e.id,i),[!0,!1]))await t._serverTeamUserPermissionsCache.refresh([r.id,e.id,s]);else for(let i of(await t._interface.grantServerProjectPermission(e.id,r),[!0,!1]))await t._serverUserProjectPermissionsCache.refresh([e.id,i])},async revokePermission(r,i){if(r&&"string"!=typeof r&&i)for(let s of(await t._interface.revokeServerTeamUserPermission(r.id,e.id,i),[!0,!1]))await t._serverTeamUserPermissionsCache.refresh([r.id,e.id,s]);else for(let i of(await t._interface.revokeServerProjectPermission(e.id,r),[!0,!1]))await t._serverUserProjectPermissionsCache.refresh([e.id,i])},async delete(){let r=await t._interface.deleteServerUser(e.id);return await t._refreshUsers(),r},async createSession(r){let i=await t._interface.createServerUserSession(e.id,r.expiresInMillis??31536e6,r.isImpersonation??!1);return{getTokens:async()=>i}},getActiveSessions:async()=>(await t._interface.listServerSessions(e.id)).map(e=>t._clientSessionFromCrud(e)),async revokeSession(e){await t._interface.deleteServerSession(e)},async setDisplayName(e){return await this.update({displayName:e})},async setClientMetadata(e){return await this.update({clientMetadata:e})},async setClientReadOnlyMetadata(e){return await this.update({clientReadOnlyMetadata:e})},async setServerMetadata(e){return await this.update({serverMetadata:e})},async setSelectedTeam(e){return await this.update({selectedTeamId:e?.id??null})},getConnectedAccount:r,useConnectedAccount:function(r,i){let s=i?.scopes?.join(" ");return iS(t._serverUserOAuthConnectionCache,[e.id,r,s||"",i?.or==="redirect"],"user.useConnectedAccount()")},selectedTeam:e.selected_team?t._serverTeamFromCrud(e.selected_team):null,async getTeam(e){return(await this.listTeams()).find(t=>t.id===e)??null},useTeam(e){let t=this.useTeams();return(0,ii.useMemo)(()=>t.find(t=>t.id===e)??null,[t,e])},listTeams:async()=>tv.orThrow(await t._serverTeamsCache.getOrWait([e.id],"write-only")).map(e=>t._serverTeamFromCrud(e)),useTeams(){let r=iS(t._serverTeamsCache,[e.id],"user.useTeams()");return(0,ii.useMemo)(()=>r.map(e=>t._serverTeamFromCrud(e)),[r])},createTeam:async r=>{let i=await t._interface.createServerTeam(iR({creatorUserId:e.id,...r}));return await t._serverTeamsCache.refresh([void 0]),await t._updateServerUser(e.id,{selectedTeamId:i.id}),t._serverTeamFromCrud(i)},leaveTeam:async r=>{await t._interface.leaveServerTeam({teamId:r.id,userId:e.id})},async listPermissions(r,i){if(r&&"id"in r){let s=i?.recursive??!0;return tv.orThrow(await t._serverTeamUserPermissionsCache.getOrWait([r.id,e.id,s],"write-only")).map(e=>t._serverPermissionFromCrud(e))}{let i=r?.recursive??!0;return tv.orThrow(await t._serverUserProjectPermissionsCache.getOrWait([e.id,i],"write-only")).map(e=>t._serverPermissionFromCrud(e))}},usePermissions(r,i){if(r&&"id"in r){let s=i?.recursive??!0,n=iS(t._serverTeamUserPermissionsCache,[r.id,e.id,s],"user.usePermissions()");return(0,ii.useMemo)(()=>n.map(e=>t._serverPermissionFromCrud(e)),[n])}{let i=r?.recursive??!0,s=iS(t._serverUserProjectPermissionsCache,[e.id,i],"user.usePermissions()");return(0,ii.useMemo)(()=>s.map(e=>t._serverPermissionFromCrud(e)),[s])}},async getPermission(e,t){return e&&"string"!=typeof e?(await this.listPermissions(e)).find(e=>e.id===t)??null:(await this.listPermissions()).find(t=>t.id===e)??null},usePermission(e,t){if(e&&"string"!=typeof e){let r=this.usePermissions(e);return(0,ii.useMemo)(()=>r.find(e=>e.id===t)??null,[r,t])}{let t=this.usePermissions();return(0,ii.useMemo)(()=>t.find(t=>t.id===e)??null,[t,e])}},async hasPermission(e,t){return e&&"string"!=typeof e?await this.getPermission(e,t)!==null:await this.getPermission(e)!==null},async update(r){await t._updateServerUser(e.id,r)},sendVerificationEmail:async()=>await t._checkFeatureSupport("sendVerificationEmail() on ServerUser",{}),async updatePassword(r){let i=await t._interface.updatePassword(r);return await t._serverUserCache.refresh([e.id]),i},async setPassword(r){let i=await this.update(r);return await t._serverUserCache.refresh([e.id]),i},async getTeamProfile(r){let i=tv.orThrow(await t._serverUserTeamProfileCache.getOrWait([r.id,e.id],"write-only"));return t._serverEditableTeamProfileFromCrud(i)},useTeamProfile(r){let i=iS(t._serverUserTeamProfileCache,[r.id,e.id],"user.useTeamProfile()");return(0,ii.useMemo)(()=>t._serverEditableTeamProfileFromCrud(i),[i])},listContactChannels:async()=>tv.orThrow(await t._serverContactChannelsCache.getOrWait([e.id],"write-only")).map(r=>t._serverContactChannelFromCrud(e.id,r)),useContactChannels(){let r=iS(t._serverContactChannelsCache,[e.id],"user.useContactChannels()");return(0,ii.useMemo)(()=>r.map(r=>t._serverContactChannelFromCrud(e.id,r)),[r])},createContactChannel:async r=>{var i;let s=await t._interface.createServerContactChannel((i=e.id,{type:r.type,value:r.value,is_verified:r.isVerified,user_id:i,used_for_auth:r.usedForAuth,is_primary:r.isPrimary}));return await Promise.all([t._serverContactChannelsCache.refresh([e.id]),t._serverUserCache.refresh([e.id])]),t._serverContactChannelFromCrud(e.id,s)},useApiKeys:()=>iS(t._serverUserApiKeysCache,[e.id],"user.useApiKeys()").map(e=>t._serverApiKeyFromCrud(e)),listApiKeys:async()=>tv.orThrow(await t._serverUserApiKeysCache.getOrWait([e.id],"write-only")).map(e=>t._serverApiKeyFromCrud(e)),async createApiKey(r){let i=await t._interface.createProjectApiKey(await ib("user",e.id,r),null,"server");return await t._serverUserApiKeysCache.refresh([e.id]),t._serverApiKeyFromCrud(i)}}}_serverTeamUserFromCrud(e){return{...this._serverUserFromCrud(e.user),teamProfile:{displayName:e.display_name,profileImageUrl:e.profile_image_url}}}_serverTeamInvitationFromCrud(e){return{id:e.id,recipientEmail:e.recipient_email,expiresAt:new Date(e.expires_at_millis),revoke:async()=>{await this._interface.revokeServerTeamInvitation(e.id,e.team_id)}}}_currentUserFromCrud(e,t){let r={...this._serverUserFromCrud(e),...this._createAuth(t),...this._isInternalProject()?this._createInternalUserExtra(t):{}};return Object.freeze(r),r}_serverTeamFromCrud(e){let t=this;return{id:e.id,displayName:e.display_name,profileImageUrl:e.profile_image_url,createdAt:new Date(e.created_at_millis),clientMetadata:e.client_metadata,clientReadOnlyMetadata:e.client_read_only_metadata,serverMetadata:e.server_metadata,async update(r){await t._interface.updateServerTeam(e.id,{display_name:r.displayName,profile_image_url:r.profileImageUrl,client_metadata:r.clientMetadata,client_read_only_metadata:r.clientReadOnlyMetadata,server_metadata:r.serverMetadata}),await t._serverTeamsCache.refresh([void 0])},async delete(){await t._interface.deleteServerTeam(e.id),await t._serverTeamsCache.refresh([void 0])},listUsers:async()=>tv.orThrow(await t._serverTeamMemberProfilesCache.getOrWait([e.id],"write-only")).map(e=>t._serverTeamUserFromCrud(e)),useUsers(){let r=iS(t._serverTeamMemberProfilesCache,[e.id],"team.useUsers()");return(0,ii.useMemo)(()=>r.map(e=>t._serverTeamUserFromCrud(e)),[r])},async addUser(r){await t._interface.addServerUserToTeam({teamId:e.id,userId:r}),await t._serverTeamMemberProfilesCache.refresh([e.id])},async removeUser(r){await t._interface.removeServerUserFromTeam({teamId:e.id,userId:r}),await t._serverTeamMemberProfilesCache.refresh([e.id])},async inviteUser(r){await t._interface.sendServerTeamInvitation({teamId:e.id,email:r.email,callbackUrl:r.callbackUrl??iE(t.urls.teamInvitation,"callbackUrl")}),await t._serverTeamInvitationsCache.refresh([e.id])},listInvitations:async()=>tv.orThrow(await t._serverTeamInvitationsCache.getOrWait([e.id],"write-only")).map(e=>t._serverTeamInvitationFromCrud(e)),useInvitations(){let r=iS(t._serverTeamInvitationsCache,[e.id],"team.useInvitations()");return(0,ii.useMemo)(()=>r.map(e=>t._serverTeamInvitationFromCrud(e)),[r])},useApiKeys:()=>iS(t._serverTeamApiKeysCache,[e.id],"team.useApiKeys()").map(e=>t._serverApiKeyFromCrud(e)),listApiKeys:async()=>tv.orThrow(await t._serverTeamApiKeysCache.getOrWait([e.id],"write-only")).map(e=>t._serverApiKeyFromCrud(e)),async createApiKey(r){let i=await t._interface.createProjectApiKey(await ib("team",e.id,r),null,"server");return await t._serverTeamApiKeysCache.refresh([e.id]),t._serverApiKeyFromCrud(i)}}}async _getUserApiKey(e){let t=tv.orThrow(await this._serverCheckApiKeyCache.getOrWait(["user",e.apiKey],"write-only"));return t?this._serverApiKeyFromCrud(t):null}async _getTeamApiKey(e){let t=tv.orThrow(await this._serverCheckApiKeyCache.getOrWait(["team",e.apiKey],"write-only"));return t?this._serverApiKeyFromCrud(t):null}_useUserApiKey(e){let t=iS(this._serverCheckApiKeyCache,["user",e.apiKey],"useUserApiKey()");return(0,ii.useMemo)(()=>t?this._serverApiKeyFromCrud(t):null,[t])}_useTeamApiKey(e){let t=iS(this._serverCheckApiKeyCache,["team",e.apiKey],"useTeamApiKey()");return(0,ii.useMemo)(()=>t?this._serverApiKeyFromCrud(t):null,[t])}async _getUserByApiKey(e){let t=await this._getUserApiKey({apiKey:e});return null===t?null:await this.getServerUserById(t.userId)}_useUserByApiKey(e){let t=this._useUserApiKey({apiKey:e});return null===t?null:this.useUserById(t.userId)}async _getTeamByApiKey(e){let t=await this._getTeamApiKey({apiKey:e});return null===t?null:await this.getTeam(t.teamId)}_useTeamByApiKey(e){let t=this._useTeamApiKey({apiKey:e});return null===t?null:this.useTeam(t.teamId)}async createUser(e){let t=await this._interface.createServerUser({primary_email:e.primaryEmail,password:e.password,otp_auth_enabled:e.otpAuthEnabled,primary_email_auth_enabled:e.primaryEmailAuthEnabled,display_name:e.displayName,primary_email_verified:e.primaryEmailVerified,client_metadata:e.clientMetadata,client_read_only_metadata:e.clientReadOnlyMetadata,server_metadata:e.serverMetadata});return await this._refreshUsers(),this._serverUserFromCrud(t)}async getUser(e){if("string"==typeof e)return await this.getServerUserById(e);if("object"==typeof e&&"apiKey"in e)return await this._getUserByApiKey(e.apiKey);{this._ensurePersistentTokenStore(e?.tokenStore);let t=await this._getSession(e?.tokenStore),r=tv.orThrow(await this._currentServerUserCache.getOrWait([t],"write-only"));if(r?.is_anonymous&&e?.or!=="anonymous"&&e?.or!=="anonymous-if-exists"&&(r=null),null===r)switch(e?.or){case"redirect":await this.redirectToSignIn({replace:!0});break;case"throw":throw Error("User is not signed in but getUser was called with { or: 'throw' }");case"anonymous":{let e=await this._signUpAnonymously();return await this.getUser({tokenStore:e,or:"anonymous-if-exists"})??(0,h.fZ)("Something went wrong while signing up anonymously")}case void 0:case"anonymous-if-exists":case"return-null":return null}return r&&this._currentUserFromCrud(r,t)}}async getServerUser(){return console.warn("stackServerApp.getServerUser is deprecated; use stackServerApp.getUser instead"),await this.getUser()}async getServerUserById(e){let t=tv.orThrow(await this._serverUserCache.getOrWait([e],"write-only"));return t&&this._serverUserFromCrud(t)}useUser(e){if("string"==typeof e)return this.useUserById(e);if("object"==typeof e&&"apiKey"in e)return this._useUserByApiKey(e.apiKey);{this._ensurePersistentTokenStore(e?.tokenStore);let t=this._useSession(e?.tokenStore),r=iS(this._currentServerUserCache,[t],"useUser()");if(r?.is_anonymous&&e?.or!=="anonymous"&&e?.or!=="anonymous-if-exists"&&(r=null),null===r)switch(e?.or){case"redirect":throw tA(this.redirectToSignIn({replace:!0})),iu(),new h.AJ("suspend should never return");case"throw":throw Error("User is not signed in but useUser was called with { or: 'throw' }");case"anonymous":throw tA(async()=>{await this._signUpAnonymously(),"undefined"!=typeof window&&window.location.reload()}),iu(),new h.AJ("suspend should never return")}return(0,ii.useMemo)(()=>r&&this._currentUserFromCrud(r,t),[r,t,e?.or])}}useUserById(e){let t=iS(this._serverUserCache,[e],"useUserById()");return(0,ii.useMemo)(()=>t&&this._serverUserFromCrud(t),[t])}async listUsers(e){let t=tv.orThrow(await this._serverUsersCache.getOrWait([e?.cursor,e?.limit,e?.orderBy,e?.desc,e?.query],"write-only")),r=t.items.map(e=>this._serverUserFromCrud(e));return r.nextCursor=t.pagination?.next_cursor??null,r}useUsers(e){let t=iS(this._serverUsersCache,[e?.cursor,e?.limit,e?.orderBy,e?.desc,e?.query],"useServerUsers()"),r=t.items.map(e=>this._serverUserFromCrud(e));return r.nextCursor=t.pagination?.next_cursor??null,r}_serverPermissionFromCrud(e){return{id:e.id}}_serverTeamPermissionDefinitionFromCrud(e){return{id:e.id,description:e.description,containedPermissionIds:e.contained_permission_ids}}_serverProjectPermissionDefinitionFromCrud(e){return{id:e.id,description:e.description,containedPermissionIds:e.contained_permission_ids}}async listTeams(){return tv.orThrow(await this._serverTeamsCache.getOrWait([void 0],"write-only")).map(e=>this._serverTeamFromCrud(e))}async createTeam(e){let t=await this._interface.createServerTeam(iR(e));return await this._serverTeamsCache.refresh([void 0]),this._serverTeamFromCrud(t)}useTeams(){let e=iS(this._serverTeamsCache,[void 0],"useServerTeams()");return(0,ii.useMemo)(()=>e.map(e=>this._serverTeamFromCrud(e)),[e])}async getTeam(e){return"object"==typeof e&&"apiKey"in e?await this._getTeamByApiKey(e.apiKey):(await this.listTeams()).find(t=>t.id===e)??null}useTeam(e){if("object"==typeof e&&"apiKey"in e)return this._useTeamByApiKey(e.apiKey);{let t=this.useTeams();return(0,ii.useMemo)(()=>t.find(t=>t.id===e)??null,[t,e])}}async _refreshSession(e){await Promise.all([super._refreshUser(e),this._currentServerUserCache.refresh([e])])}async _refreshUsers(){await Promise.all([super._refreshUsers(),this._serverUserCache.refreshWhere(()=>!0),this._serverUsersCache.refreshWhere(()=>!0),this._serverContactChannelsCache.refreshWhere(()=>!0)])}},sc=class extends so{constructor(e){super({interface:new it({getBaseUrl:()=>iC(e.baseUrl),projectId:e.projectId??iw(),extraRequestHeaders:e.extraRequestHeaders??{},clientVersion:im,..."projectOwnerSession"in e?{projectOwnerSession:e.projectOwnerSession}:{publishableClientKey:e.publishableClientKey??ig(),secretServerKey:e.secretServerKey??iT(),superSecretAdminKey:e.superSecretAdminKey??(ip.env.STACK_SUPER_SECRET_ADMIN_KEY||(0,h.fZ)(Error("No super secret admin key provided. Please copy your key from the Stack dashboard and put it in the STACK_SUPER_SECRET_ADMIN_KEY environment variable.")))}}),baseUrl:e.baseUrl,extraRequestHeaders:e.extraRequestHeaders,projectId:e.projectId,tokenStore:e.tokenStore,urls:e.urls,oauthScopesOnSignIn:e.oauthScopesOnSignIn,redirectMethod:e.redirectMethod}),this._adminProjectCache=i_(async()=>await this._interface.getProject()),this._internalApiKeysCache=i_(async()=>await this._interface.listInternalApiKeys()),this._adminEmailTemplatesCache=i_(async()=>await this._interface.listEmailTemplates()),this._adminTeamPermissionDefinitionsCache=i_(async()=>await this._interface.listTeamPermissionDefinitions()),this._adminProjectPermissionDefinitionsCache=i_(async()=>await this._interface.listProjectPermissionDefinitions()),this._svixTokenCache=i_(async()=>await this._interface.getSvixToken()),this._metricsCache=i_(async()=>await this._interface.getMetrics())}_adminOwnedProjectFromCrud(e,t){if(null!==this._tokenStoreInit)throw new h.AJ("Owned apps must always have tokenStore === null — did you not create this project with app._createOwnedApp()?");return{...this._adminProjectFromCrud(e,t),app:this}}_adminProjectFromCrud(e,t){if(e.id!==this.projectId)throw new h.AJ(`The project ID of the provided project JSON (${e.id}) does not match the project ID of the app (${this.projectId})!`);let r=this;return{id:e.id,displayName:e.display_name,description:e.description,createdAt:new Date(e.created_at_millis),userCount:e.user_count,isProductionMode:e.is_production_mode,config:{signUpEnabled:e.config.sign_up_enabled,credentialEnabled:e.config.credential_enabled,magicLinkEnabled:e.config.magic_link_enabled,passkeyEnabled:e.config.passkey_enabled,clientTeamCreationEnabled:e.config.client_team_creation_enabled,clientUserDeletionEnabled:e.config.client_user_deletion_enabled,allowLocalhost:e.config.allow_localhost,oauthAccountMergeStrategy:e.config.oauth_account_merge_strategy,allowUserApiKeys:e.config.allow_user_api_keys,allowTeamApiKeys:e.config.allow_team_api_keys,oauthProviders:e.config.oauth_providers.map(e=>"shared"===e.type?{id:e.id,type:"shared"}:{id:e.id,type:"standard",clientId:e.client_id??(0,h.fZ)("Client ID is missing"),clientSecret:e.client_secret??(0,h.fZ)("Client secret is missing"),facebookConfigId:e.facebook_config_id,microsoftTenantId:e.microsoft_tenant_id}),emailConfig:"shared"===e.config.email_config.type?{type:"shared"}:{type:"standard",host:e.config.email_config.host??(0,h.fZ)("Email host is missing"),port:e.config.email_config.port??(0,h.fZ)("Email port is missing"),username:e.config.email_config.username??(0,h.fZ)("Email username is missing"),password:e.config.email_config.password??(0,h.fZ)("Email password is missing"),senderName:e.config.email_config.sender_name??(0,h.fZ)("Email sender name is missing"),senderEmail:e.config.email_config.sender_email??(0,h.fZ)("Email sender email is missing")},domains:e.config.domains.map(e=>({domain:e.domain,handlerPath:e.handler_path})),createTeamOnSignUp:e.config.create_team_on_sign_up,teamCreatorDefaultPermissions:e.config.team_creator_default_permissions,teamMemberDefaultPermissions:e.config.team_member_default_permissions,userDefaultPermissions:e.config.user_default_permissions},async update(e){await r._interface.updateProject(ia(e)),await t()},async delete(){await r._interface.deleteProject()},getProductionModeErrors:async()=>ir(e),useProductionModeErrors:()=>ir(e)}}_adminEmailTemplateFromCrud(e){return{type:e.type,subject:e.subject,content:e.content,isDefault:e.is_default}}async getProject(){return this._adminProjectFromCrud(tv.orThrow(await this._adminProjectCache.getOrWait([],"write-only")),()=>this._refreshProject())}useProject(){let e=iS(this._adminProjectCache,[],"useProjectAdmin()");return(0,ii.useMemo)(()=>this._adminProjectFromCrud(e,()=>this._refreshProject()),[e])}_createInternalApiKeyBaseFromCrud(e){let t=this;return{id:e.id,description:e.description,expiresAt:new Date(e.expires_at_millis),manuallyRevokedAt:e.manually_revoked_at_millis?new Date(e.manually_revoked_at_millis):null,createdAt:new Date(e.created_at_millis),isValid(){return null===this.whyInvalid()},whyInvalid(){return this.expiresAt.getTime()<Date.now()?"expired":this.manuallyRevokedAt?"manually-revoked":null},async revoke(){let r=await t._interface.revokeInternalApiKeyById(e.id);return await t._refreshInternalApiKeys(),r}}}_createInternalApiKeyFromCrud(e){return{...this._createInternalApiKeyBaseFromCrud(e),publishableClientKey:e.publishable_client_key?{lastFour:e.publishable_client_key.last_four}:null,secretServerKey:e.secret_server_key?{lastFour:e.secret_server_key.last_four}:null,superSecretAdminKey:e.super_secret_admin_key?{lastFour:e.super_secret_admin_key.last_four}:null}}_createInternalApiKeyFirstViewFromCrud(e){return{...this._createInternalApiKeyBaseFromCrud(e),publishableClientKey:e.publishable_client_key,secretServerKey:e.secret_server_key,superSecretAdminKey:e.super_secret_admin_key}}async listInternalApiKeys(){return tv.orThrow(await this._internalApiKeysCache.getOrWait([],"write-only")).map(e=>this._createInternalApiKeyFromCrud(e))}useInternalApiKeys(){let e=iS(this._internalApiKeysCache,[],"useInternalApiKeys()");return(0,ii.useMemo)(()=>e.map(e=>this._createInternalApiKeyFromCrud(e)),[e])}async createInternalApiKey(e){let t=await this._interface.createInternalApiKey({description:e.description,expires_at_millis:e.expiresAt.getTime(),has_publishable_client_key:e.hasPublishableClientKey,has_secret_server_key:e.hasSecretServerKey,has_super_secret_admin_key:e.hasSuperSecretAdminKey});return await this._refreshInternalApiKeys(),this._createInternalApiKeyFirstViewFromCrud(t)}useEmailTemplates(){let e=iS(this._adminEmailTemplatesCache,[],"useEmailTemplates()");return(0,ii.useMemo)(()=>e.map(e=>this._adminEmailTemplateFromCrud(e)),[e])}async listEmailTemplates(){return tv.orThrow(await this._adminEmailTemplatesCache.getOrWait([],"write-only")).map(e=>this._adminEmailTemplateFromCrud(e))}async updateEmailTemplate(e,t){await this._interface.updateEmailTemplate(e,{subject:t.subject,content:t.content}),await this._adminEmailTemplatesCache.refresh([])}async resetEmailTemplate(e){await this._interface.resetEmailTemplate(e),await this._adminEmailTemplatesCache.refresh([])}async createTeamPermissionDefinition(e){let t=await this._interface.createTeamPermissionDefinition({id:e.id,description:e.description,contained_permission_ids:e.containedPermissionIds});return await this._adminTeamPermissionDefinitionsCache.refresh([]),this._serverTeamPermissionDefinitionFromCrud(t)}async updateTeamPermissionDefinition(e,t){await this._interface.updateTeamPermissionDefinition(e,{description:t.description,contained_permission_ids:t.containedPermissionIds}),await this._adminTeamPermissionDefinitionsCache.refresh([])}async deleteTeamPermissionDefinition(e){await this._interface.deleteTeamPermissionDefinition(e),await this._adminTeamPermissionDefinitionsCache.refresh([])}async listTeamPermissionDefinitions(){return tv.orThrow(await this._adminTeamPermissionDefinitionsCache.getOrWait([],"write-only")).map(e=>this._serverTeamPermissionDefinitionFromCrud(e))}useTeamPermissionDefinitions(){let e=iS(this._adminTeamPermissionDefinitionsCache,[],"usePermissions()");return(0,ii.useMemo)(()=>e.map(e=>this._serverTeamPermissionDefinitionFromCrud(e)),[e])}async createProjectPermissionDefinition(e){let t=await this._interface.createProjectPermissionDefinition({id:e.id,description:e.description,contained_permission_ids:e.containedPermissionIds});return await this._adminProjectPermissionDefinitionsCache.refresh([]),this._serverProjectPermissionDefinitionFromCrud(t)}async updateProjectPermissionDefinition(e,t){await this._interface.updateProjectPermissionDefinition(e,{description:t.description,contained_permission_ids:t.containedPermissionIds}),await this._adminProjectPermissionDefinitionsCache.refresh([])}async deleteProjectPermissionDefinition(e){await this._interface.deleteProjectPermissionDefinition(e),await this._adminProjectPermissionDefinitionsCache.refresh([])}async listProjectPermissionDefinitions(){return tv.orThrow(await this._adminProjectPermissionDefinitionsCache.getOrWait([],"write-only")).map(e=>this._serverProjectPermissionDefinitionFromCrud(e))}useProjectPermissionDefinitions(){let e=iS(this._adminProjectPermissionDefinitionsCache,[],"useProjectPermissions()");return(0,ii.useMemo)(()=>e.map(e=>this._serverProjectPermissionDefinitionFromCrud(e)),[e])}useSvixToken(){return iS(this._svixTokenCache,[],"useSvixToken()").token}async _refreshProject(){await Promise.all([super._refreshProject(),this._adminProjectCache.refresh([])])}async _refreshInternalApiKeys(){await this._internalApiKeysCache.refresh([])}get[is.G](){return{...super[is.G],useMetrics:()=>iS(this._metricsCache,[],"useMetrics()")}}async sendTestEmail(e){let t=await this._interface.sendTestEmail({recipient_email:e.recipientEmail,email_config:{...(0,tn.ei)(e.emailConfig,["host","port","username","password"]),sender_email:e.emailConfig.senderEmail,sender_name:e.emailConfig.senderName}});return t.success?tv.ok(void 0):tv.error({errorMessage:t.error_message??(0,h.fZ)("Email test error not specified")})}async listSentEmails(){return(await this._interface.listSentEmails()).items.map(e=>({id:e.id,to:e.to??[],subject:e.subject,recipient:e.to?.[0]??"",sentAt:new Date(e.sent_at_millis),error:e.error}))}},{_StackAdminAppImpl:sl,_StackClientAppImpl:su,_StackServerAppImpl:sd}=(sa.LazyStackAdminAppImpl.value=sc,{_StackAdminAppImpl:n(sc),_StackClientAppImpl:n(sa),_StackServerAppImpl:n(so)}),sh=su},8019:function(e,t,r){"use strict";r.d(t,{G:function(){return i}});var i=Symbol.for("StackAuth--DO-NOT-USE-OR-YOU-WILL-BE-FIRED--StackAppInternals")},3876:function(e,t,r){"use strict";r.d(t,{Lp:function(){return d},SR:function(){return l},U8:function(){return u}});var i=r(5250),s=r(2265),n=r(2394),a=r(2917),o=r(8019),c=r(7437),l=s.createContext(null);function u(e){let t=e.serialized?a.f[o.G].fromClientJson(e.app):e.app;return i.z.__STACK_AUTH__={app:t},(0,c.jsx)(l.Provider,{value:{app:t},children:e.children})}function d(e){let t=(0,n.I)();return(0,s.useEffect)(()=>{let r=(async()=>await e.userJsonPromise)();t[o.G].setCurrentUser(r)},[]),null}},3408:function(e,t,r){"use strict";r.d(t,{AJ:function(){return l},O7:function(){return h},PV:function(){return c},fZ:function(){return a},vK:function(){return p}});var i=r(5250),s=r(7974),n=r(5829);function a(...e){if("string"==typeof e[0])throw new l(e[0],e[1]);if(e[0]instanceof Error)throw e[0];throw new p(...e)}function o(e){let t=Error().stack?.startsWith("Error\n");return e.split("\n").slice(t?1:0).join("\n")}function c(e,...t){let r=e.stack?.endsWith("\n"),i=o(Error().stack??"").split("\n")[0];for(let s of t){let t=o(s.stack??"");e.stack+=(r?"":"\n")+i+"\n"+t}}var l=class extends Error{constructor(e,t){let r=`

This is likely an error in Stack. Please make sure you are running the newest version and report it.`;super(`${e}${e.endsWith(r)?"":r}`,(0,s.ei)(t??{},["cause"])),this.extraData=t,Object.defineProperty(this,"customCaptureExtraArgs",{get(){return[this.extraData]},enumerable:!1})}};l.prototype.name="StackAssertionError";var u=new Set;function d(e){u.has(e)||u.add(e)}function h(e,t){for(let r of u)r(e,t,...t&&("object"==typeof t||"function"==typeof t)&&"customCaptureExtraArgs"in t&&Array.isArray(t.customCaptureExtraArgs)?t.customCaptureExtraArgs:[])}d((e,t,...r)=>{console.error(`\x1b[41mCaptured error in ${e}:`,t instanceof Error?(0,n.NZ)(t,{maxDepth:8}):`${typeof t}<${(0,n.NZ)(t)}>`,...r,"\x1b[0m")}),d((e,t,...r)=>{i.z.stackCapturedErrors=i.z.stackCapturedErrors??[],i.z.stackCapturedErrors.push({location:e,error:t,extraArgs:r})});var p=class extends Error{constructor(e,t){if("object"==typeof e&&(t??=e.message,e=e.statusCode),super(t),this.__stackStatusErrorBrand="stack-status-error-brand-sentinel",this.name="StatusError",this.statusCode=e,!t)throw new l("StatusError always requires a message unless a Status object is passed",{cause:this})}static isStatusError(e){return"object"==typeof e&&null!==e&&"__stackStatusErrorBrand"in e&&"stack-status-error-brand-sentinel"===e.__stackStatusErrorBrand}isClientError(){return this.statusCode>=400&&this.statusCode<500}isServerError(){return!this.isClientError()}getStatusCode(){return this.statusCode}getBody(){return new TextEncoder().encode(this.message)}getHeaders(){return{"Content-Type":["text/plain; charset=utf-8"]}}toDescriptiveJson(){return{status_code:this.getStatusCode(),message:this.message,headers:this.getHeaders()}}toHttpJson(){return{status_code:this.statusCode,body:this.message,headers:this.getHeaders()}}};p.BadRequest={statusCode:400,message:"Bad Request"},p.Unauthorized={statusCode:401,message:"Unauthorized"},p.PaymentRequired={statusCode:402,message:"Payment Required"},p.Forbidden={statusCode:403,message:"Forbidden"},p.NotFound={statusCode:404,message:"Not Found"},p.MethodNotAllowed={statusCode:405,message:"Method Not Allowed"},p.NotAcceptable={statusCode:406,message:"Not Acceptable"},p.ProxyAuthenticationRequired={statusCode:407,message:"Proxy Authentication Required"},p.RequestTimeout={statusCode:408,message:"Request Timeout"},p.Conflict={statusCode:409,message:"Conflict"},p.Gone={statusCode:410,message:"Gone"},p.LengthRequired={statusCode:411,message:"Length Required"},p.PreconditionFailed={statusCode:412,message:"Precondition Failed"},p.PayloadTooLarge={statusCode:413,message:"Payload Too Large"},p.URITooLong={statusCode:414,message:"URI Too Long"},p.UnsupportedMediaType={statusCode:415,message:"Unsupported Media Type"},p.RangeNotSatisfiable={statusCode:416,message:"Range Not Satisfiable"},p.ExpectationFailed={statusCode:417,message:"Expectation Failed"},p.ImATeapot={statusCode:418,message:"I'm a teapot"},p.MisdirectedRequest={statusCode:421,message:"Misdirected Request"},p.UnprocessableEntity={statusCode:422,message:"Unprocessable Entity"},p.Locked={statusCode:423,message:"Locked"},p.FailedDependency={statusCode:424,message:"Failed Dependency"},p.TooEarly={statusCode:425,message:"Too Early"},p.UpgradeRequired={statusCode:426,message:"Upgrade Required"},p.PreconditionRequired={statusCode:428,message:"Precondition Required"},p.TooManyRequests={statusCode:429,message:"Too Many Requests"},p.RequestHeaderFieldsTooLarge={statusCode:431,message:"Request Header Fields Too Large"},p.UnavailableForLegalReasons={statusCode:451,message:"Unavailable For Legal Reasons"},p.InternalServerError={statusCode:500,message:"Internal Server Error"},p.NotImplemented={statusCode:501,message:"Not Implemented"},p.BadGateway={statusCode:502,message:"Bad Gateway"},p.ServiceUnavailable={statusCode:503,message:"Service Unavailable"},p.GatewayTimeout={statusCode:504,message:"Gateway Timeout"},p.HTTPVersionNotSupported={statusCode:505,message:"HTTP Version Not Supported"},p.VariantAlsoNegotiates={statusCode:506,message:"Variant Also Negotiates"},p.InsufficientStorage={statusCode:507,message:"Insufficient Storage"},p.LoopDetected={statusCode:508,message:"Loop Detected"},p.NotExtended={statusCode:510,message:"Not Extended"},p.NetworkAuthenticationRequired={statusCode:511,message:"Network Authentication Required"},p.prototype.name="StatusError"},5250:function(e,t,r){"use strict";r.d(t,{z:function(){return i}});var i="undefined"!=typeof globalThis?globalThis:void 0!==r.g?r.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{};"undefined"==typeof globalThis&&(i.globalThis=i);var s=Symbol.for("__stack-globals");i[s]??={}},7974:function(e,t,r){"use strict";r.d(t,{CE:function(){return c},FR:function(){return s},JT:function(){return function e(t,r,i={}){if(typeof t!=typeof r)return!1;if(t===r)return!0;switch(typeof t){case"object":{if(!t||!r)return!1;if(Array.isArray(t)||Array.isArray(r)){if(!Array.isArray(t)||!Array.isArray(r)||t.length!==r.length)return!1;return t.every((t,s)=>e(t,r[s],i))}let s=Object.entries(t).filter(([e,t])=>!i.ignoreUndefinedValues||void 0!==t),n=Object.entries(r).filter(([e,t])=>!i.ignoreUndefinedValues||void 0!==t);if(s.length!==n.length)return!1;return s.every(([t,r])=>{let s=n.find(([e])=>t===e);return!!s&&e(r,s[1],i)})}case"undefined":case"string":case"number":case"boolean":case"bigint":case"symbol":case"function":return!1;default:throw Error("Unexpected typeof "+typeof t)}}},YU:function(){return n},ei:function(){return o},ye:function(){return a}});var i=r(3408);function s(e){return Object.entries(e)}function n(e){return Object.fromEntries(Object.entries(e).filter(([,e])=>void 0!==e))}function a(e){return Object.fromEntries(Object.entries(e).filter(([,e])=>null!=e))}function o(e,t){return Object.fromEntries(Object.entries(e).filter(([e])=>t.includes(e)))}function c(e,t){if(!Array.isArray(t))throw new i.AJ("omit: keys must be an array",{obj:e,keys:t});return Object.fromEntries(Object.entries(e).filter(([e])=>!t.includes(e)))}r(5829)},5829:function(e,t,r){"use strict";r.d(t,{Ac:function(){return o},yf:function(){return l},NZ:function(){return function e(t,r={}){let n={maxDepth:5,currentIndent:"",lineIndent:"  ",multiline:!0,refs:new Map,path:"value",parent:null,overrides:()=>null,keyInParent:null,hideFields:[],...(0,s.YU)(r)},{maxDepth:a,currentIndent:c,lineIndent:l,multiline:h,refs:p,path:m,overrides:_,hideFields:f}=n,y=`
${c}`,w=_(t,r);if(null!==w)return w;if(["function","object","symbol"].includes(typeof t)&&null!==t){if(p.has(t))return`Ref<${p.get(t)}>`;p.set(t,m)}let g={maxDepth:a-1,currentIndent:c,lineIndent:l,multiline:h,refs:p,path:m+"->[unknown property]",overrides:_,parent:{value:t,options:n},keyInParent:null,hideFields:[]},T=(t,r,i,s={})=>e(t,{...g,path:r,currentIndent:c+l,keyInParent:i,...s});switch(typeof t){case"boolean":case"number":return JSON.stringify(t);case"string":{let e=e=>o(e)===e&&e.includes("\n"),r=e=>o`
        deindent\`
        ${c+l}${e.replaceAll("`","\\`").replaceAll("\\","\\\\").replaceAll("$","\\$").replaceAll("\n",y+l)}
        ${c}\`
      `;if(e(t))return r(t);if(t.endsWith("\n")&&e(t.slice(0,-1)))return r(t.slice(0,-1))+' + "\\n"';return JSON.stringify(t)}case"undefined":return"undefined";case"symbol":return t.toString();case"bigint":return`${t}n`;case"function":if(t.name)return`function ${t.name}(...) { ... }`;return"(...) => { ... }";case"object":{var C;if(null===t)return"null";if(Array.isArray(t)){let e=d(t),r=t.length+e.length;if(a<=0&&0===r)return"[...]";let s=t.map((e,t)=>T(e,`${m}[${t}]`,t));if(s.push(...e),s.length!==r)throw new i.AJ("nicify of object: resValues.length !== resValueLength",{value:t,resValues:s,resValueLength:r});if(s.length>4||s.some(e=>s.length>1&&e.length>4||e.includes("\n")))return`[${y}${s.map(e=>`${l}${e},${y}`).join("")}]`;return`[${s.join(", ")}]`}if(t instanceof URL)return`URL(${T(t.toString(),`${m}.toString()`,null)})`;if(ArrayBuffer.isView(t))return`${t.constructor.name}([${t.toString()}])`;if(t instanceof Error){let e=t.stack??"",r=t.toString();return e.startsWith(r)||(e=`${r}
${e}`),e=(e=(e=e.trimEnd()).replace(/\n\s+/g,`
${l}${l}`)).replace("\n",`
${l}Stack:
`),Object.keys(t).length>0&&(e+=`
${l}Extra properties: ${T(Object.fromEntries(Object.entries(t)),m,null)}`),t.cause&&(e+=`
${l}Cause:
${l}${l}${T(t.cause,m,null,{currentIndent:c+l+l})}`),e=e.replaceAll("\n",`
${c}`)}let e=[null,Object.prototype].includes(Object.getPrototypeOf(t))?null:u.get(t.constructor)??t.constructor.name,r=e?`${e} `:"",s=(C=t,[Headers].some(e=>C instanceof e)?[...C.entries()].sort(([e],[t])=>(function(e,t){if("string"!=typeof e||"string"!=typeof t)throw new i.AJ(`Expected two strings for stringCompare, found ${typeof e} and ${typeof t}`,{a:e,b:t});let r=(e,t)=>e<t?-1:e>t?1:0;return r(e.toUpperCase(),t.toUpperCase())||r(t,e)})(`${e}`,`${t}`)):(function(e){let t=("getNicifiableKeys"in e?e.getNicifiableKeys?.bind(e):null)?.();return null!=t?t:e instanceof Response?["status","headers"]:[...new Set(Object.keys(e).sort())]})(C).map(e=>[e,C[e]])).filter(([e])=>!f.includes(e)),n=[...d(t),...f.length>0?["<some fields may have been hidden>"]:[]],o=s.length+n.length;if(0===o)return`${r}{}`;if(a<=0)return`${r}{ ... }`;let h=s.map(([e,t],r)=>{let i=T(e,`Object.keys(${m})[${r}]`,null),s="string"==typeof e?JSON.stringify(e):`[${i}]`;return"function"==typeof t&&t.name===e?`${s}(...): { ... }`:`${s}: ${T(t,`${m}[${i}]`,e)}`});if(h.push(...n),h.length!==o)throw new i.AJ("nicify of object: resValues.length !== resValueLength",{value:t,resValues:h,resValueLength:o});let p=h.length>1||h.some(e=>e.includes("\n"));if(0===h.length)return`${r}{}`;if(p)return`${r}{${y}${h.map(e=>`${l}${e},${y}`).join("")}}`;return`${r}{ ${h.join(", ")} }`}default:return`${typeof t}<${t}>`}}},yz:function(){return a}});var i=r(3408),s=r(7974);function n(e){return e.substring(0,e.length-e.trimStart().length)}function a(e,...t){if(t.length!==e.length-1)throw new i.AJ("Invalid number of values; must be one less than strings",{strings:e,values:t});return e.reduce((e,r,i)=>e+r+(t[i]??""),"")}function o(e,...t){return"string"==typeof e?o([e]):a(...function(e,...t){if(t.length!==e.length-1)throw new i.AJ("Invalid number of values; must be one less than strings",{strings:e,values:t});let r=[...e];r[0]=(function(e){let t=e.split("\n"),r=t.findIndex(e=>""!==e.trim());return -1===r?"":t.slice(r).join("\n")})(r[0]+"+").slice(0,-1),r[r.length-1]=(function(e){let t=e.split("\n"),r=function(e,t){for(let r=e.length-1;r>=0;r--)if(t(e[r]))return r;return -1}(t,e=>""!==e.trim());return t.slice(0,r+1).join("\n")})("+"+r[r.length-1]).slice(1);let s=r.join("${SOME_VALUE}").split("\n").filter(e=>""!==e.trim()).map(e=>n(e).length).reduce((e,t)=>Math.min(e,t),1/0),a=r.map((e,t)=>e.split("\n").map((e,r)=>0!==t&&0===r?e:e.substring(s)).join("\n")),o=t.map((e,t)=>{let r=n(a[t].split("\n").at(-1));return`${e}`.replaceAll("\n",`
${r}`)});return[a,...o]}(e,...t))}function c(e,t=!0){let r=e.trim().split(/\s+/).filter(e=>e.length>0);return t?[...new Set(r)]:r}function l(...e){let t=e.map(e=>c(e)).flat().join(" ");return c(t).join(" ")}var u=new Map(Object.entries({Headers}).map(([e,t])=>[t,e]));function d(e){return("getNicifiedObjectExtraLines"in e?e.getNicifiedObjectExtraLines:null)?.()??[]}},469:function(e,t){"use strict";function r(e){return -1!==e.indexOf("%")?decodeURIComponent(e):e}t.Q=function(e,t){if("string"!=typeof e)throw TypeError("argument str must be a string");for(var i={},s=(t||{}).decode||r,n=0;n<e.length;){var a=e.indexOf("=",n);if(-1===a)break;var o=e.indexOf(";",n);if(-1===o)o=e.length;else if(o<a){n=e.lastIndexOf(";",a-1)+1;continue}var c=e.slice(n,a).trim();if(void 0===i[c]){var l=e.slice(a+1,o).trim();34===l.charCodeAt(0)&&(l=l.slice(1,-1)),i[c]=function(e,t){try{return t(e)}catch(t){return e}}(l,s)}n=o+1}return i},Object.prototype.toString},9376:function(e,t,r){"use strict";r.r(t);var i=r(5475),s={};for(var n in i)"default"!==n&&(s[n]=(function(e){return i[e]}).bind(0,n));r.d(t,s)},257:function(e,t,r){"use strict";var i,s;e.exports=(null==(i=r.g.process)?void 0:i.env)&&"object"==typeof(null==(s=r.g.process)?void 0:s.env)?r.g.process:r(4227)},1057:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"DraftMode",{enumerable:!0,get:function(){return n}});let i=r(1845),s=r(6999);class n{get isEnabled(){return this._provider.isEnabled}enable(){let e=i.staticGenerationAsyncStorage.getStore();return e&&(0,s.trackDynamicDataAccessed)(e,"draftMode().enable()"),this._provider.enable()}disable(){let e=i.staticGenerationAsyncStorage.getStore();return e&&(0,s.trackDynamicDataAccessed)(e,"draftMode().disable()"),this._provider.disable()}constructor(e){this._provider=e}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},2439:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{cookies:function(){return h},draftMode:function(){return p},headers:function(){return d}});let i=r(692),s=r(2637),n=r(9767),a=r(295),o=r(1057),c=r(6999),l=r(1845),u=r(544);function d(){let e="headers",t=l.staticGenerationAsyncStorage.getStore();if(t){if(t.forceStatic)return s.HeadersAdapter.seal(new Headers({}));(0,c.trackDynamicDataAccessed)(t,e)}return(0,u.getExpectedRequestStore)(e).headers}function h(){let e="cookies",t=l.staticGenerationAsyncStorage.getStore();if(t){if(t.forceStatic)return i.RequestCookiesAdapter.seal(new n.RequestCookies(new Headers({})));(0,c.trackDynamicDataAccessed)(t,e)}let r=(0,u.getExpectedRequestStore)(e),s=a.actionAsyncStorage.getStore();return(null==s?void 0:s.isAction)||(null==s?void 0:s.isAppRoute)?r.mutableCookies:r.cookies}function p(){let e=(0,u.getExpectedRequestStore)("draftMode");return new o.DraftMode(e.draftMode)}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},2849:function(e){"use strict";var t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,s=Object.prototype.hasOwnProperty,n={};function a(e){var t;let r=["path"in e&&e.path&&`Path=${e.path}`,"expires"in e&&(e.expires||0===e.expires)&&`Expires=${("number"==typeof e.expires?new Date(e.expires):e.expires).toUTCString()}`,"maxAge"in e&&"number"==typeof e.maxAge&&`Max-Age=${e.maxAge}`,"domain"in e&&e.domain&&`Domain=${e.domain}`,"secure"in e&&e.secure&&"Secure","httpOnly"in e&&e.httpOnly&&"HttpOnly","sameSite"in e&&e.sameSite&&`SameSite=${e.sameSite}`,"partitioned"in e&&e.partitioned&&"Partitioned","priority"in e&&e.priority&&`Priority=${e.priority}`].filter(Boolean),i=`${e.name}=${encodeURIComponent(null!=(t=e.value)?t:"")}`;return 0===r.length?i:`${i}; ${r.join("; ")}`}function o(e){let t=new Map;for(let r of e.split(/; */)){if(!r)continue;let e=r.indexOf("=");if(-1===e){t.set(r,"true");continue}let[i,s]=[r.slice(0,e),r.slice(e+1)];try{t.set(i,decodeURIComponent(null!=s?s:"true"))}catch{}}return t}function c(e){var t,r;if(!e)return;let[[i,s],...n]=o(e),{domain:a,expires:c,httponly:d,maxage:h,path:p,samesite:m,secure:_,partitioned:f,priority:y}=Object.fromEntries(n.map(([e,t])=>[e.toLowerCase(),t]));return function(e){let t={};for(let r in e)e[r]&&(t[r]=e[r]);return t}({name:i,value:decodeURIComponent(s),domain:a,...c&&{expires:new Date(c)},...d&&{httpOnly:!0},..."string"==typeof h&&{maxAge:Number(h)},path:p,...m&&{sameSite:l.includes(t=(t=m).toLowerCase())?t:void 0},..._&&{secure:!0},...y&&{priority:u.includes(r=(r=y).toLowerCase())?r:void 0},...f&&{partitioned:!0}})}((e,r)=>{for(var i in r)t(e,i,{get:r[i],enumerable:!0})})(n,{RequestCookies:()=>d,ResponseCookies:()=>h,parseCookie:()=>o,parseSetCookie:()=>c,stringifyCookie:()=>a}),e.exports=((e,n,a,o)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let c of i(n))s.call(e,c)||c===a||t(e,c,{get:()=>n[c],enumerable:!(o=r(n,c))||o.enumerable});return e})(t({},"__esModule",{value:!0}),n);var l=["strict","lax","none"],u=["low","medium","high"],d=class{constructor(e){this._parsed=new Map,this._headers=e;let t=e.get("cookie");if(t)for(let[e,r]of o(t))this._parsed.set(e,{name:e,value:r})}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed);if(!e.length)return r.map(([e,t])=>t);let i="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(([e])=>e===i).map(([e,t])=>t)}has(e){return this._parsed.has(e)}set(...e){let[t,r]=1===e.length?[e[0].name,e[0].value]:e,i=this._parsed;return i.set(t,{name:t,value:r}),this._headers.set("cookie",Array.from(i).map(([e,t])=>a(t)).join("; ")),this}delete(e){let t=this._parsed,r=Array.isArray(e)?e.map(e=>t.delete(e)):t.delete(e);return this._headers.set("cookie",Array.from(t).map(([e,t])=>a(t)).join("; ")),r}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(e=>`${e.name}=${encodeURIComponent(e.value)}`).join("; ")}},h=class{constructor(e){var t,r,i;this._parsed=new Map,this._headers=e;let s=null!=(i=null!=(r=null==(t=e.getSetCookie)?void 0:t.call(e))?r:e.get("set-cookie"))?i:[];for(let e of Array.isArray(s)?s:function(e){if(!e)return[];var t,r,i,s,n,a=[],o=0;function c(){for(;o<e.length&&/\s/.test(e.charAt(o));)o+=1;return o<e.length}for(;o<e.length;){for(t=o,n=!1;c();)if(","===(r=e.charAt(o))){for(i=o,o+=1,c(),s=o;o<e.length&&"="!==(r=e.charAt(o))&&";"!==r&&","!==r;)o+=1;o<e.length&&"="===e.charAt(o)?(n=!0,o=s,a.push(e.substring(t,i)),t=o):o=i+1}else o+=1;(!n||o>=e.length)&&a.push(e.substring(t,e.length))}return a}(s)){let t=c(e);t&&this._parsed.set(t.name,t)}}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed.values());if(!e.length)return r;let i="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(e=>e.name===i)}has(e){return this._parsed.has(e)}set(...e){let[t,r,i]=1===e.length?[e[0].name,e[0].value,e[0]]:e,s=this._parsed;return s.set(t,function(e={name:"",value:""}){return"number"==typeof e.expires&&(e.expires=new Date(e.expires)),e.maxAge&&(e.expires=new Date(Date.now()+1e3*e.maxAge)),(null===e.path||void 0===e.path)&&(e.path="/"),e}({name:t,value:r,...i})),function(e,t){for(let[,r]of(t.delete("set-cookie"),e)){let e=a(r);t.append("set-cookie",e)}}(s,this._headers),this}delete(...e){let[t,r,i]="string"==typeof e[0]?[e[0]]:[e[0].name,e[0].path,e[0].domain];return this.set({name:t,path:r,domain:i,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(a).join("; ")}}},4227:function(e){!function(){var t={229:function(e){var t,r,i,s=e.exports={};function n(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===n||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:n}catch(e){t=n}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var c=[],l=!1,u=-1;function d(){l&&i&&(l=!1,i.length?c=i.concat(c):u=-1,c.length&&h())}function h(){if(!l){var e=o(d);l=!0;for(var t=c.length;t;){for(i=c,c=[];++u<t;)i&&i[u].run();u=-1,t=c.length}i=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new p(e,t)),1!==c.length||l||o(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},r={};function i(e){var s=r[e];if(void 0!==s)return s.exports;var n=r[e]={exports:{}},a=!0;try{t[e](n,n.exports,i),a=!1}finally{a&&delete r[e]}return n.exports}i.ab="//";var s=i(229);e.exports=s}()},2637:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{HeadersAdapter:function(){return n},ReadonlyHeadersError:function(){return s}});let i=r(650);class s extends Error{constructor(){super("Headers cannot be modified. Read more: https://nextjs.org/docs/app/api-reference/functions/headers")}static callable(){throw new s}}class n extends Headers{constructor(e){super(),this.headers=new Proxy(e,{get(t,r,s){if("symbol"==typeof r)return i.ReflectAdapter.get(t,r,s);let n=r.toLowerCase(),a=Object.keys(e).find(e=>e.toLowerCase()===n);if(void 0!==a)return i.ReflectAdapter.get(t,a,s)},set(t,r,s,n){if("symbol"==typeof r)return i.ReflectAdapter.set(t,r,s,n);let a=r.toLowerCase(),o=Object.keys(e).find(e=>e.toLowerCase()===a);return i.ReflectAdapter.set(t,o??r,s,n)},has(t,r){if("symbol"==typeof r)return i.ReflectAdapter.has(t,r);let s=r.toLowerCase(),n=Object.keys(e).find(e=>e.toLowerCase()===s);return void 0!==n&&i.ReflectAdapter.has(t,n)},deleteProperty(t,r){if("symbol"==typeof r)return i.ReflectAdapter.deleteProperty(t,r);let s=r.toLowerCase(),n=Object.keys(e).find(e=>e.toLowerCase()===s);return void 0===n||i.ReflectAdapter.deleteProperty(t,n)}})}static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"append":case"delete":case"set":return s.callable;default:return i.ReflectAdapter.get(e,t,r)}}})}merge(e){return Array.isArray(e)?e.join(", "):e}static from(e){return e instanceof Headers?e:new n(e)}append(e,t){let r=this.headers[e];"string"==typeof r?this.headers[e]=[r,t]:Array.isArray(r)?r.push(t):this.headers[e]=t}delete(e){delete this.headers[e]}get(e){let t=this.headers[e];return void 0!==t?this.merge(t):null}has(e){return void 0!==this.headers[e]}set(e,t){this.headers[e]=t}forEach(e,t){for(let[r,i]of this.entries())e.call(t,i,r,this)}*entries(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase(),r=this.get(t);yield[t,r]}}*keys(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase();yield t}}*values(){for(let e of Object.keys(this.headers)){let t=this.get(e);yield t}}[Symbol.iterator](){return this.entries()}}},692:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{MutableRequestCookiesAdapter:function(){return d},ReadonlyRequestCookiesError:function(){return a},RequestCookiesAdapter:function(){return o},appendMutableCookies:function(){return u},getModifiedCookieValues:function(){return l}});let i=r(9767),s=r(650),n=r(1845);class a extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#cookiessetname-value-options")}static callable(){throw new a}}class o{static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"clear":case"delete":case"set":return a.callable;default:return s.ReflectAdapter.get(e,t,r)}}})}}let c=Symbol.for("next.mutated.cookies");function l(e){let t=e[c];return t&&Array.isArray(t)&&0!==t.length?t:[]}function u(e,t){let r=l(t);if(0===r.length)return!1;let s=new i.ResponseCookies(e),n=s.getAll();for(let e of r)s.set(e);for(let e of n)s.set(e);return!0}class d{static wrap(e,t){let r=new i.ResponseCookies(new Headers);for(let t of e.getAll())r.set(t);let a=[],o=new Set,l=()=>{let e=n.staticGenerationAsyncStorage.getStore();if(e&&(e.pathWasRevalidated=!0),a=r.getAll().filter(e=>o.has(e.name)),t){let e=[];for(let t of a){let r=new i.ResponseCookies(new Headers);r.set(t),e.push(r.toString())}t(e)}};return new Proxy(r,{get(e,t,r){switch(t){case c:return a;case"delete":return function(...t){o.add("string"==typeof t[0]?t[0]:t[0].name);try{e.delete(...t)}finally{l()}};case"set":return function(...t){o.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.set(...t)}finally{l()}};default:return s.ReflectAdapter.get(e,t,r)}}})}}},9767:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{RequestCookies:function(){return i.RequestCookies},ResponseCookies:function(){return i.ResponseCookies},stringifyCookie:function(){return i.stringifyCookie}});let i=r(2849)}}]);