"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[306],{9306:function(e,t,a){a.d(t,{o:function(){return h}});var o=a(7437),r=a(2265),s=a(2489),n=a(9205);let l=(0,n.Z)("CircleCheckBig",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),i=(0,n.Z)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var c=a(5252),d=a(338),u=a(1901);let p="http://localhost:8888",h=e=>{var t;let{problemId:a,onClose:n,onShowQuoteModal:h}=e,[m,f]=(0,r.useState)(null),[x,g]=(0,r.useState)([]),{isAuthenticated:b,user:y,userProfile:w,fetchMyRequests:v,fetchPublicProblems:j,fetchMyQuotes:k}=r.useContext(d.I),N=(0,r.useCallback)(async()=>{try{let e=await fetch("".concat(p,"/.netlify/functions/get-problem-details?problemId=").concat(a));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();f(t);let o=await fetch("".concat(p,"/.netlify/functions/get-quotes-for-problem?problemId=").concat(a));if(!o.ok)throw Error("HTTP error! status: ".concat(o.status));let r=await o.json();g(r)}catch(e){console.error("Failed to fetch problem details or quotes:",e),alert("Failed to load problem details: "+e.message)}},[a]);(0,r.useEffect)(()=>{N()},[N]);let S=(0,r.useCallback)(async e=>{if(!b||!y||!w||(null==m?void 0:m.user_id)!==w.id){alert("You are not authorized to accept this quote.");return}try{let t=await fetch("".concat(p,"/.netlify/functions/update-quote-status"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({quoteId:e,status:"accepted",problemId:m.id,userId:w.id})});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));await t.json(),alert("Quote accepted! Problem status updated."),N(),v&&v(),j&&j()}catch(e){console.error("Failed to accept quote:",e),alert("Failed to accept quote: "+e.message)}},[b,y,w,m,N,v,j]),C=(0,r.useCallback)(async(e,t)=>{if(!b||(null==w?void 0:w.role)!=="provider"||!(null==w?void 0:w.id)){alert("You must be logged in as an approved provider to submit a quote.");return}try{let a=await fetch("".concat(p,"/.netlify/functions/submit-quote"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({problemId:e,providerId:w.id,amount:t.proposedBudget,details:t.motivation,proposedStartDate:t.proposedStartDate,proposedEndDate:t.proposedEndDate})});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));await a.json(),alert("Quote submitted successfully!"),N(),k&&k()}catch(e){console.error("Failed to submit quote:",e),alert("Failed to submit quote: "+e.message)}},[b,w,N,k]),[E,T]=(0,r.useState)(!1);if(!m)return(0,o.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,o.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-xl w-full max-w-2xl rounded-md relative",children:[(0,o.jsx)("div",{className:"text-center",children:"Loading problem details..."}),(0,o.jsx)("button",{onClick:n,className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700",children:(0,o.jsx)(s.Z,{size:24})})]})});let P=b&&w&&m.user_id===w.id,D=b&&(null==w?void 0:w.role)==="provider";return(0,o.jsxs)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50",children:[(0,o.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-xl w-full max-w-3xl rounded-md relative overflow-y-auto max-h-[90vh]",children:[(0,o.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-4",children:m.title}),(0,o.jsx)("p",{className:"text-gray-700 mb-6",children:m.description}),(0,o.jsxs)("p",{className:"text-gray-500 text-sm mb-4",children:["Location: ",m.location," | Status: ",m.status," | Budget: R",(null===(t=m.estimated_budget)||void 0===t?void 0:t.toFixed(2))||"N/A"]}),P&&"open"===m.status&&(0,o.jsxs)("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-md",children:[(0,o.jsx)("h3",{className:"text-xl font-semibold text-yellow-800 mb-2",children:"Quotes for Your Problem"}),x.length>0?(0,o.jsx)("div",{className:"space-y-4",children:x.map(e=>{var t;return(0,o.jsxs)("div",{className:"p-4 bg-white border border-gray-200 rounded-md shadow-sm",children:[(0,o.jsxs)("p",{className:"font-semibold text-lg text-blue-700",children:["Amount: R",null===(t=e.amount)||void 0===t?void 0:t.toFixed(2)]}),(0,o.jsx)("p",{className:"text-gray-700 text-sm mb-2",children:e.details})," ",(0,o.jsxs)("p",{className:"text-gray-600 text-xs",children:["By Provider ID: ",e.provider_id||"N/A"," | Status: ",e.status,e.proposedStartDate&&" | Start: ".concat(new Date(e.proposedStartDate).toLocaleDateString()),e.proposedEndDate&&" | End: ".concat(new Date(e.proposedEndDate).toLocaleDateString())]}),"pending"===e.status&&(0,o.jsx)("div",{className:"mt-3 flex space-x-2",children:(0,o.jsxs)("button",{onClick:()=>S(e.id),className:"px-3 py-1 bg-green-500 text-white text-sm rounded-md hover:bg-green-600 flex items-center",children:[(0,o.jsx)(l,{size:16,className:"mr-1"})," Accept"]})}),"accepted"===e.status&&(0,o.jsxs)("p",{className:"text-green-600 font-semibold mt-2 flex items-center",children:[(0,o.jsx)(i,{size:16,className:"mr-1"})," Accepted!"]})]},e.id)})}):(0,o.jsx)("p",{className:"text-gray-600",children:"No quotes submitted yet for this problem."})]}),D&&"open"===m.status&&!x.some(e=>e.provider_id===w.id&&"pending"===e.status)&&(0,o.jsxs)("button",{onClick:()=>T(!0),className:"mt-6 px-6 py-3 bg-green-600 text-white font-semibold rounded-md hover:bg-green-700 transition-colors duration-200 flex items-center shadow-md",children:[(0,o.jsx)(c.Z,{size:20,className:"mr-2"})," Submit a Quote"]}),(0,o.jsx)("div",{className:"flex justify-end mt-8",children:(0,o.jsx)("button",{onClick:n,className:"px-6 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition-colors duration-200",children:"Close"})}),(0,o.jsx)("button",{onClick:n,className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700",children:(0,o.jsx)(s.Z,{size:24})})]}),E&&(0,o.jsx)(u.G,{isOpen:E,onClose:()=>T(!1),problem:m,onSubmitQuote:C})]})}},1901:function(e,t,a){a.d(t,{G:function(){return n}});var o=a(7437),r=a(2265),s=a(2489);let n=e=>{let{isOpen:t,onClose:a,problem:n,onSubmitQuote:l}=e,[i,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(""),[p,h]=(0,r.useState)(""),[m,f]=(0,r.useState)(""),[x,g]=(0,r.useState)("");return t&&n?(0,o.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,o.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-md max-h-screen overflow-y-auto rounded-md relative",children:[(0,o.jsxs)("h3",{className:"text-2xl font-bold text-gray-800 mb-6",children:['Submit Quote for: "',n.title,'"']}),(0,o.jsx)("button",{onClick:a,className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700",children:(0,o.jsx)(s.Z,{size:24})}),(0,o.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),g(""),!i||!d||!p||!m){g("All fields are required.");return}if(0>=parseFloat(i)){g("Proposed Budget must be a positive number.");return}if(new Date(p)>new Date(m)){g("Proposed Start Date cannot be after Proposed End Date.");return}l(n.id,{proposedBudget:parseFloat(i),motivation:d,proposedStartDate:p,proposedEndDate:m})},className:"space-y-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"proposedBudget",children:"Proposed Budget (R)"}),(0,o.jsx)("input",{type:"number",id:"proposedBudget",step:"0.01",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:i,onChange:e=>c(e.target.value),required:!0})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"motivation",children:"Motivation / Details"}),(0,o.jsx)("textarea",{id:"motivation",rows:"4",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:d,onChange:e=>u(e.target.value),required:!0})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"proposedStartDate",children:"Proposed Start Date"}),(0,o.jsx)("input",{type:"date",id:"proposedStartDate",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:p,onChange:e=>h(e.target.value),required:!0})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"proposedEndDate",children:"Proposed End Date"}),(0,o.jsx)("input",{type:"date",id:"proposedEndDate",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:m,onChange:e=>f(e.target.value),required:!0})]}),x&&(0,o.jsx)("p",{className:"text-red-500 text-sm",children:x}),(0,o.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[(0,o.jsx)("button",{type:"button",onClick:a,className:"px-6 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition-colors duration-200",children:"Cancel"}),(0,o.jsx)("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200",children:"Submit Quote"})]})]})]})}):null}},1870:function(e,t,a){a.d(t,{B:function(){return l},b:function(){return n}});var o=a(7437),r=a(2265);let s=(0,r.createContext)({isStackReady:!1,stackError:null});function n(e){let{children:t}=e,[a,n]=(0,r.useState)(!1),[l,i]=(0,r.useState)(null);return(0,r.useEffect)(()=>{(async()=>{try{try{localStorage.setItem("__stack_test__","test"),localStorage.removeItem("__stack_test__")}catch(e){throw Error("localStorage not available")}"complete"!==document.readyState&&await new Promise(e=>{"complete"===document.readyState?e():window.addEventListener("load",()=>e(),{once:!0})}),await new Promise(e=>setTimeout(e,200)),n(!0)}catch(e){console.error("Stack Auth initialization failed:",e),i(e instanceof Error?e.message:"Unknown error")}})()},[]),(0,o.jsx)(s.Provider,{value:{isStackReady:a,stackError:l},children:t})}function l(){return(0,r.useContext)(s)}},338:function(e,t,a){a.d(t,{I:function(){return l},w:function(){return c}});var o=a(7437),r=a(2265),s=a(8104),n=a(1870);let l=(0,r.createContext)(null),i="http://localhost:8888",c=e=>{let{children:t}=e,{isStackReady:a,stackError:c}=(0,n.B)(),d=!1,u=null,p=!0,h=()=>console.warn("Stack Auth login not available (context not ready)."),m=()=>console.warn("Stack Auth logout not available (context not ready).");if(a&&!c)try{let{isAuthenticated:e,user:t,isLoading:a}=(0,s.a)(),o=(0,s.I)();d=e,u=t,p=a,h=o.login,m=o.logout}catch(e){console.warn("Error accessing Stack Auth context in AppProvider (might be a transient issue):",e)}let[f,x]=(0,r.useState)(null),[g,b]=(0,r.useState)([]),[y,w]=(0,r.useState)([]),[v,j]=(0,r.useState)(null),[k,N]=(0,r.useState)(!0),[S,C]=(0,r.useState)([]),[E,T]=(0,r.useState)([]),P=(0,r.useCallback)(async()=>{try{let e=await fetch("".concat(i,"/.netlify/functions/get-branding"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();x(t)}catch(e){console.error("Failed to fetch branding:",e)}},[]),D=(0,r.useCallback)(async()=>{try{let e=await fetch("".concat(i,"/.netlify/functions/get-pricing-plans"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();b(t)}catch(e){console.error("Failed to fetch pricing plans:",e)}},[]),I=(0,r.useCallback)(async()=>{try{let e=await fetch("".concat(i,"/.netlify/functions/get-problems"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();w(t)}catch(e){console.error("Failed to fetch public problems:",e)}},[]),_=(0,r.useCallback)(async()=>{if(!d||!(null==u?void 0:u.id)){j(null);return}try{let e=await u.getIdToken(),t=await fetch("".concat(i,"/.netlify/functions/get-or-create-user-profile"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({auth_id:u.id,email:u.email,name:u.name||(u.email?u.email.split("@")[0]:"User")})});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let a=await t.json();j(a)}catch(e){console.error("Failed to fetch or create user profile:",e),j(null)}},[d,u]),q=(0,r.useCallback)(async()=>{if(!d||!(null==v?void 0:v.id)){C([]);return}try{let e=await u.getIdToken(),t=await fetch("".concat(i,"/.netlify/functions/get-my-requests?userId=").concat(v.id),{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let a=await t.json();C(a)}catch(e){console.error("Failed to fetch my requests:",e),C([])}},[d,null==v?void 0:v.id,u]),A=(0,r.useCallback)(async()=>{if(!d||!(null==v?void 0:v.id)||(null==v?void 0:v.role)!=="provider"){T([]);return}try{let e=await u.getIdToken(),t=await fetch("".concat(i,"/.netlify/functions/get-my-quotes?providerId=").concat(v.id),{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let a=await t.json();T(a)}catch(e){console.error("Failed to fetch my quotes:",e),T([])}},[d,null==v?void 0:v.id,null==v?void 0:v.role,u]);(0,r.useEffect)(()=>{(async()=>{N(!0),await Promise.all([P(),D(),I()]),N(!1)})()},[P,D,I]),(0,r.useEffect)(()=>{d&&a?_():(j(null),C([]),T([]))},[d,_,a]),(0,r.useEffect)(()=>{(null==v?void 0:v.id)&&d&&a&&(q(),A())},[null==v?void 0:v.id,d,q,A,a]);let F={branding:f,pricingPlans:g,publicProblems:y,userProfile:v,myRequests:S,myQuotes:E,fetchMyRequests:q,fetchPublicProblems:I,fetchMyQuotes:A,isAuthenticated:d,user:u,isLoading:p||k||!a,login:h,logout:m};return(0,o.jsx)(l.Provider,{value:F,children:t})}},8104:function(e,t,a){a.d(t,{I:function(){return i},a:function(){return l}});var o=a(2265),r="undefined"!=typeof globalThis?globalThis:void 0!==a.g?a.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{};"undefined"==typeof globalThis&&(r.globalThis=r);var s=Symbol.for("__stack-globals");r[s]??={},a(7437);var n=o.createContext(null);function l(e={}){let t=i(e);if(e.projectIdMustMatch&&t.projectId!==e.projectIdMustMatch)throw Error("Unexpected project ID in useStackApp: "+t.projectId);return e.projectIdMustMatch,t.useUser(e)}function i(e={}){let t=(0,o.useContext)(n);if(null===t)throw Error("useStackApp must be used within a StackProvider");let a=t.app;if(e.projectIdMustMatch&&a.projectId!==e.projectIdMustMatch)throw Error("Unexpected project ID in useStackApp: "+a.projectId);return a}},9205:function(e,t,a){a.d(t,{Z:function(){return u}});var o=a(5583),r=a(6796),s=a(2265);let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&a.indexOf(e)===t).join(" ")};var i=a(1780),c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let d=(0,s.forwardRef)((e,t)=>{var{color:a="currentColor",size:n=24,strokeWidth:d=2,absoluteStrokeWidth:u,className:p="",children:h,iconNode:m}=e,f=(0,r._)(e,["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"]);return(0,s.createElement)("svg",(0,o._)((0,i._)((0,o._)({ref:t},c),{width:n,height:n,stroke:a,strokeWidth:u?24*Number(d)/Number(n):d,className:l("lucide",p)}),f),[...m.map(e=>{let[t,a]=e;return(0,s.createElement)(t,a)}),...Array.isArray(h)?h:[h]])}),u=(e,t)=>{let a=(0,s.forwardRef)((a,i)=>{var{className:c}=a,u=(0,r._)(a,["className"]);return(0,s.createElement)(d,(0,o._)({ref:i,iconNode:t,className:l("lucide-".concat(n(e)),c)},u))});return a.displayName="".concat(e),a}},5252:function(e,t,a){a.d(t,{Z:function(){return o}});let o=(0,a(9205).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},2489:function(e,t,a){a.d(t,{Z:function(){return o}});let o=(0,a(9205).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}}]);