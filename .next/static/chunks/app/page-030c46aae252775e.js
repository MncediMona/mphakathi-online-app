(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7867:function(e,t,a){Promise.resolve().then(a.bind(a,434))},1870:function(e,t,a){"use strict";a.d(t,{B:function(){return l},b:function(){return n}});var r=a(7437),s=a(2265);let o=(0,s.createContext)({isStackReady:!1,stackError:null});function n(e){let{children:t}=e,[a,n]=(0,s.useState)(!1),[l,i]=(0,s.useState)(null);return(0,s.useEffect)(()=>{(async()=>{try{try{localStorage.setItem("__stack_test__","test"),localStorage.removeItem("__stack_test__")}catch(e){throw Error("localStorage not available")}"complete"!==document.readyState&&await new Promise(e=>{"complete"===document.readyState?e():window.addEventListener("load",()=>e(),{once:!0})}),await new Promise(e=>setTimeout(e,200)),n(!0)}catch(e){console.error("Stack Auth initialization failed:",e),i(e instanceof Error?e.message:"Unknown error")}})()},[]),(0,r.jsx)(o.Provider,{value:{isStackReady:a,stackError:l},children:t})}function l(){return(0,s.useContext)(o)}},434:function(e,t,a){"use strict";a.r(t);var r=a(7437),s=a(2265),o=a(338);t.default=()=>{let{publicProblems:e,isLoading:t,error:a,isAuthenticated:n,userProfile:l,login:i}=(0,o.b)(),[c,u]=(0,s.useState)(!1),[d,h]=(0,s.useState)(null),m=e=>{h(e),u(!0)};return t?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("p",{className:"text-xl text-gray-700",children:"Loading application data..."})}):a?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("p",{className:"text-xl text-red-600",children:["Error loading data: ",a]})}):(0,r.jsxs)("div",{className:"container mx-auto p-4",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-6 text-gray-800",children:"Welcome to Mphakathi Online"}),!n&&(0,r.jsxs)("div",{className:"bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 mb-6",role:"alert",children:[(0,r.jsx)("p",{className:"font-bold",children:"Join Us!"}),(0,r.jsx)("p",{children:"Login to request services or provide quotes. It's quick and easy!"})," ",(0,r.jsx)("button",{onClick:i,className:"mt-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Login"})]}),n&&l&&(0,r.jsxs)("div",{className:"bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6",role:"alert",children:[(0,r.jsxs)("p",{className:"font-bold",children:["Welcome back, ",l.name||l.email,"!"]}),(0,r.jsxs)("p",{children:["Your role: ",(0,r.jsx)("span",{className:"font-semibold capitalize",children:l.role})]}),"member"===l.role&&(0,r.jsx)("p",{className:"mt-2",children:'Ready to request a service? Click the "New Request" button!'}),"provider"===l.role&&(0,r.jsx)("p",{className:"mt-2",children:"Check out the latest service requests to provide your quotes!"})]}),(0,r.jsx)("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:"Available Public Service Requests"}),0===e.length?(0,r.jsx)("p",{className:"text-gray-600",children:"No public service requests available at the moment."}):(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-200",children:[(0,r.jsx)("h3",{className:"text-xl font-semibold mb-2 text-gray-700",children:e.title}),(0,r.jsxs)("p",{className:"text-gray-600 text-sm mb-3",children:[e.description.substring(0,100),"..."]}),(0,r.jsxs)("p",{className:"text-gray-600",children:["Category: ",(0,r.jsx)("span",{className:"font-medium",children:e.category})]}),(0,r.jsxs)("p",{className:"text-gray-600",children:["Status: ",(0,r.jsx)("span",{className:"font-medium ".concat("open"===e.status?"text-green-600":"pending_quotes"===e.status?"text-yellow-600":"text-red-600"),children:e.status})]}),(0,r.jsx)("button",{onClick:()=>m(e),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-200",children:"View Details"})]},e.id))})]})}},338:function(e,t,a){"use strict";a.d(t,{b:function(){return u},w:function(){return c}});var r=a(7437),s=a(2265),o=a(2394),n=a(1870);let l=(0,s.createContext)(void 0),i="http://localhost:8888";function c(e){let{children:t}=e,{isStackReady:a,stackError:c}=(0,n.B)(),{isAuthenticated:u,user:d,isLoading:h}=(0,o.a)(),m=(0,o.I)(),[f,b]=(0,s.useState)(null),[x,g]=(0,s.useState)([]),[p,y]=(0,s.useState)([]),[v,w]=(0,s.useState)(null),[j,k]=(0,s.useState)(!0),[N,S]=(0,s.useState)([]),[C,E]=(0,s.useState)([]),T=(0,s.useCallback)(()=>{(null==m?void 0:m.login)?m.login():console.warn("Stack Auth login not available.")},[m]),_=(0,s.useCallback)(()=>{(null==m?void 0:m.logout)?m.logout():console.warn("Stack Auth logout not available.")},[m]),P=(0,s.useCallback)(async()=>{try{let e=await fetch("".concat(i,"/.netlify/functions/get-branding"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();b(t)}catch(e){console.error("Failed to fetch branding:",e)}},[]),q=(0,s.useCallback)(async()=>{try{let e=await fetch("".concat(i,"/.netlify/functions/get-pricing-plans"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();g(t)}catch(e){console.error("Failed to fetch pricing plans:",e)}},[]),A=(0,s.useCallback)(async()=>{try{let e=await fetch("".concat(i,"/.netlify/functions/get-problems"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();y(t)}catch(e){console.error("Failed to fetch public problems:",e)}},[]),I=(0,s.useCallback)(async()=>{if(!a||c||!u||!(null==d?void 0:d.id)){w(null);return}try{let e=await d.getIdToken(),t=await fetch("".concat(i,"/.netlify/functions/get-or-create-user-profile"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({auth_id:d.id,email:d.email,name:d.name||(d.email?d.email.split("@")[0]:"User")})});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let a=await t.json();w(a)}catch(e){console.error("Failed to fetch or create user profile:",e),w(null)}},[u,d,a,c]),F=(0,s.useCallback)(async()=>{if(!a||c||!u||!(null==v?void 0:v.id)){S([]);return}try{let e=await d.getIdToken(),t=await fetch("".concat(i,"/.netlify/functions/get-my-requests?userId=").concat(v.id),{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let a=await t.json();S(a)}catch(e){console.error("Failed to fetch my requests:",e),S([])}},[u,null==v?void 0:v.id,d,a,c]),H=(0,s.useCallback)(async()=>{if(!a||c||!u||!(null==v?void 0:v.id)||(null==v?void 0:v.role)!=="provider"){E([]);return}try{let e=await d.getIdToken(),t=await fetch("".concat(i,"/.netlify/functions/get-my-quotes?providerId=").concat(v.id),{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let a=await t.json();E(a)}catch(e){console.error("Failed to fetch my quotes:",e),E([])}},[u,null==v?void 0:v.id,null==v?void 0:v.role,d,a,c]);return(0,s.useEffect)(()=>{(async()=>{k(!0),await Promise.all([P(),q(),A()]),k(!1)})()},[P,q,A]),(0,s.useEffect)(()=>{u&&a&&!c?I():(w(null),S([]),E([]))},[u,I,a,c]),(0,s.useEffect)(()=>{(null==v?void 0:v.id)&&u&&a&&!c&&(F(),H())},[null==v?void 0:v.id,u,F,H,a,c]),(0,r.jsx)(l.Provider,{value:{branding:f,pricingPlans:x,publicProblems:p,userProfile:v,myRequests:N,myQuotes:C,fetchMyRequests:F,fetchPublicProblems:A,fetchMyQuotes:H,isAuthenticated:u,user:d,isLoading:h||j||!a,error:c,login:T,logout:_},children:t})}function u(){let e=(0,s.useContext)(l);if(void 0===e)throw Error("useAppContext must be used within an AppProvider");return e}}},function(e){e.O(0,[347,971,117,744],function(){return e(e.s=7867)}),_N_E=e.O()}]);