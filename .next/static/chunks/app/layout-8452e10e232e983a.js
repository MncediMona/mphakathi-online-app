(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{7327:function(e,t,r){Promise.resolve().then(r.bind(r,8154))},1870:function(e,t,r){"use strict";r.d(t,{B:function(){return i},b:function(){return l}});var s=r(7437),a=r(2265);let n=(0,a.createContext)({isStackReady:!1,stackError:null});function l(e){let{children:t}=e,[r,l]=(0,a.useState)(!1),[i,o]=(0,a.useState)(null);return(0,a.useEffect)(()=>{(async()=>{try{try{localStorage.setItem("__stack_test__","test"),localStorage.removeItem("__stack_test__")}catch(e){throw Error("localStorage not available")}"complete"!==document.readyState&&await new Promise(e=>{"complete"===document.readyState?e():window.addEventListener("load",()=>e(),{once:!0})}),await new Promise(e=>setTimeout(e,200)),l(!0)}catch(e){console.error("Stack Auth initialization failed:",e),o(e instanceof Error?e.message:"Unknown error")}})()},[]),(0,s.jsx)(n.Provider,{value:{isStackReady:r,stackError:i},children:t})}function i(){return(0,a.useContext)(n)}},8154:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return w}});var s=r(7437),a=r(2265),n=r(338),l=r(7648),i=r(9376),o=r(8293),c=r(9637),d=r(8736),u=r(5252),h=r(4286),m=r(8728),x=r(7692),f=r(2369),b=r(1870);function g(){let{isAuthenticated:e,userProfile:t,login:r,logout:g,isLoading:v}=a.useContext(n.AppContext),{isStackReady:y,stackError:j}=(0,b.B)(),p=(0,i.usePathname)(),[w,k]=(0,a.useState)(!1);return v||!y?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"hidden md:flex items-center space-x-6",children:(0,s.jsx)("div",{className:"text-gray-500",children:"Loading navigation..."})}),(0,s.jsx)("div",{className:"md:hidden",children:(0,s.jsx)(o.Z,{size:24,className:"text-gray-400 animate-pulse"})})]}):j?(0,s.jsxs)("div",{className:"hidden md:flex items-center space-x-6 text-red-600",children:["Authentication Error: ",j]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"hidden md:flex items-center space-x-6",children:[(0,s.jsxs)(l.default,{href:"/",className:"text-gray-700 hover:text-blue-600 flex items-center ".concat("/"===p?"text-blue-600 font-semibold":""),children:[(0,s.jsx)(c.Z,{size:20,className:"mr-1"})," Dashboard"]}),e&&(null==t?void 0:t.role)==="member"&&(0,s.jsxs)(l.default,{href:"/my-requests",className:"text-gray-700 hover:text-blue-600 flex items-center ".concat("/my-requests"===p?"text-blue-600 font-semibold":""),children:[(0,s.jsx)(d.Z,{size:20,className:"mr-1"})," My Requests"]}),e&&(null==t?void 0:t.role)==="provider"&&(0,s.jsxs)(l.default,{href:"/my-quotes",className:"text-gray-700 hover:text-blue-600 flex items-center ".concat("/my-quotes"===p?"text-blue-600 font-semibold":""),children:[(0,s.jsx)(u.Z,{size:20,className:"mr-1"})," My Quotes"]}),e&&(null==t?void 0:t.role)==="admin"&&(0,s.jsxs)(l.default,{href:"/admin",className:"text-gray-700 hover:text-blue-600 flex items-center ".concat("/admin"===p?"text-blue-600 font-semibold":""),children:[(0,s.jsx)(h.Z,{size:20,className:"mr-1"})," Admin"]}),e&&(0,s.jsxs)(l.default,{href:"/settings",className:"text-gray-700 hover:text-blue-600 flex items-center ".concat("/settings"===p?"text-blue-600 font-semibold":""),children:[(0,s.jsx)(m.Z,{size:20,className:"mr-1"})," Settings"]}),e?(0,s.jsxs)("button",{onClick:g,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 flex items-center",children:[(0,s.jsx)(x.Z,{size:20,className:"mr-1"})," Logout"]}):(0,s.jsxs)("button",{onClick:r,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center",children:[(0,s.jsx)(f.Z,{size:20,className:"mr-1"})," Login"]})]}),(0,s.jsx)("div",{className:"md:hidden",children:(0,s.jsx)("button",{onClick:()=>k(!w),className:"text-gray-700 hover:text-blue-600",children:(0,s.jsx)(o.Z,{size:24})})}),w&&(0,s.jsxs)("div",{className:"absolute top-16 left-0 right-0 bg-white shadow-lg p-4 md:hidden z-30",children:[(0,s.jsx)(l.default,{href:"/",className:"block py-2 text-gray-700 hover:text-blue-600",onClick:()=>k(!1),children:"Dashboard"}),e&&(null==t?void 0:t.role)==="member"&&(0,s.jsx)(l.default,{href:"/my-requests",className:"block py-2 text-gray-700 hover:text-blue-600",onClick:()=>k(!1),children:"My Requests"}),e&&(null==t?void 0:t.role)==="provider"&&(0,s.jsx)(l.default,{href:"/my-quotes",className:"block py-2 text-gray-700 hover:text-blue-600",onClick:()=>k(!1),children:"My Quotes"}),e&&(null==t?void 0:t.role)==="admin"&&(0,s.jsx)(l.default,{href:"/admin",className:"block py-2 text-gray-700 hover:text-blue-600",onClick:()=>k(!1),children:"Admin"}),e&&(0,s.jsx)(l.default,{href:"/settings",className:"block py-2 text-gray-700 hover:text-blue-600",onClick:()=>k(!1),children:"Settings"}),e?(0,s.jsx)("button",{onClick:()=>{g(),k(!1)},className:"w-full text-left py-2 bg-red-600 text-white rounded-md hover:bg-red-700 mt-2",children:"Logout"}):(0,s.jsx)("button",{onClick:()=>{r(),k(!1)},className:"w-full text-left py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 mt-2",children:"Login"})]})]})}var v=r(228),y=r(2917);let j=null;function p(e){let{children:t}=e,{isStackReady:r,stackError:a}=(0,b.B)(),n=function(){if(!j){let e="39e32132-4994-4c0c-90db-05150db4054e",t="pck_vzrmv65na39bvj84erejggxshygga2vxrvtkj1n1cfg5g";if(!e||!t)return console.error("Stack Auth: Missing NEXT_PUBLIC_STACK_PROJECT_ID or NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY. Cannot initialize StackClientApp."),null;try{j=new y.f({projectId:e,publishableClientKey:t})}catch(e){return console.error("Stack Auth: Error initializing StackClientApp:",e),j=null,null}}return j}();return a?(console.warn("Stack Auth Error:",a),(0,s.jsxs)("div",{className:"p-4 bg-red-50 border border-red-200 rounded",children:[(0,s.jsx)("h2",{className:"text-red-800 font-semibold",children:"Authentication Error"}),(0,s.jsx)("p",{className:"text-red-600 text-sm",children:a}),(0,s.jsx)("p",{className:"text-red-600 text-sm mt-2",children:"Please refresh the page or contact support if this persists."})]})):r&&n?(0,s.jsx)(v.Z,{app:n,children:t}):(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,s.jsx)("p",{className:"mt-2 text-gray-600",children:"Initializing authentication..."})]})})}function w(e){let{children:t}=e;return(0,s.jsxs)("html",{lang:"en",children:[(0,s.jsxs)("head",{children:[(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),(0,s.jsx)("title",{children:"Mphakathi Online"})]}),(0,s.jsx)("body",{children:(0,s.jsx)(b.b,{children:(0,s.jsx)(p,{children:(0,s.jsx)(n.w,{children:(0,s.jsxs)("div",{className:"min-h-screen bg-gray-100 flex flex-col",children:[(0,s.jsxs)("nav",{className:"bg-white shadow-md p-4 flex justify-between items-center sticky top-0 z-40",children:[(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Mphakathi Online"})}),(0,s.jsx)(g,{})]}),(0,s.jsx)("main",{className:"flex-grow p-4 md:p-8",children:t})]})})})})})]})}r(5660)},338:function(e,t,r){"use strict";r.d(t,{b:function(){return d},w:function(){return c}});var s=r(7437),a=r(2265),n=r(2394),l=r(1870);let i=(0,a.createContext)(void 0),o="http://localhost:8888";function c(e){let{children:t}=e,{isStackReady:r,stackError:c}=(0,l.B)(),{isAuthenticated:d,user:u,isLoading:h}=(0,n.a)(),m=(0,n.I)(),[x,f]=(0,a.useState)(null),[b,g]=(0,a.useState)([]),[v,y]=(0,a.useState)([]),[j,p]=(0,a.useState)(null),[w,k]=(0,a.useState)(!0),[N,C]=(0,a.useState)([]),[S,E]=(0,a.useState)([]),_=(0,a.useCallback)(()=>{(null==m?void 0:m.login)?m.login():console.warn("Stack Auth login not available.")},[m]),T=(0,a.useCallback)(()=>{(null==m?void 0:m.logout)?m.logout():console.warn("Stack Auth logout not available.")},[m]),A=(0,a.useCallback)(async()=>{try{let e=await fetch("".concat(o,"/.netlify/functions/get-branding"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();f(t)}catch(e){console.error("Failed to fetch branding:",e)}},[]),P=(0,a.useCallback)(async()=>{try{let e=await fetch("".concat(o,"/.netlify/functions/get-pricing-plans"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();g(t)}catch(e){console.error("Failed to fetch pricing plans:",e)}},[]),z=(0,a.useCallback)(async()=>{try{let e=await fetch("".concat(o,"/.netlify/functions/get-problems"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();y(t)}catch(e){console.error("Failed to fetch public problems:",e)}},[]),I=(0,a.useCallback)(async()=>{if(!r||c||!d||!(null==u?void 0:u.id)){p(null);return}try{let e=await u.getIdToken(),t=await fetch("".concat(o,"/.netlify/functions/get-or-create-user-profile"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({auth_id:u.id,email:u.email,name:u.name||(u.email?u.email.split("@")[0]:"User")})});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let r=await t.json();p(r)}catch(e){console.error("Failed to fetch or create user profile:",e),p(null)}},[d,u,r,c]),L=(0,a.useCallback)(async()=>{if(!r||c||!d||!(null==j?void 0:j.id)){C([]);return}try{let e=await u.getIdToken(),t=await fetch("".concat(o,"/.netlify/functions/get-my-requests?userId=").concat(j.id),{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let r=await t.json();C(r)}catch(e){console.error("Failed to fetch my requests:",e),C([])}},[d,null==j?void 0:j.id,u,r,c]),q=(0,a.useCallback)(async()=>{if(!r||c||!d||!(null==j?void 0:j.id)||(null==j?void 0:j.role)!=="provider"){E([]);return}try{let e=await u.getIdToken(),t=await fetch("".concat(o,"/.netlify/functions/get-my-quotes?providerId=").concat(j.id),{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let r=await t.json();E(r)}catch(e){console.error("Failed to fetch my quotes:",e),E([])}},[d,null==j?void 0:j.id,null==j?void 0:j.role,u,r,c]);return(0,a.useEffect)(()=>{(async()=>{k(!0),await Promise.all([A(),P(),z()]),k(!1)})()},[A,P,z]),(0,a.useEffect)(()=>{d&&r&&!c?I():(p(null),C([]),E([]))},[d,I,r,c]),(0,a.useEffect)(()=>{(null==j?void 0:j.id)&&d&&r&&!c&&(L(),q())},[null==j?void 0:j.id,d,L,q,r,c]),(0,s.jsx)(i.Provider,{value:{branding:x,pricingPlans:b,publicProblems:v,userProfile:j,myRequests:N,myQuotes:S,fetchMyRequests:L,fetchPublicProblems:z,fetchMyQuotes:q,isAuthenticated:d,user:u,isLoading:h||w||!r,error:c,login:_,logout:T},children:t})}function d(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAppContext must be used within an AppProvider");return e}},5660:function(){}},function(e){e.O(0,[152,906,347,942,971,117,744],function(){return e(e.s=7327)}),_N_E=e.O()}]);