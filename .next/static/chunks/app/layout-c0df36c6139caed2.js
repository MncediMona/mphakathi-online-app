(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{7327:function(e,t,s){Promise.resolve().then(s.bind(s,8039))},1870:function(e,t,s){"use strict";s.d(t,{B:function(){return o},b:function(){return l}});var a=s(7437),r=s(2265);let n=(0,r.createContext)({isStackReady:!1,stackError:null});function l(e){let{children:t}=e,[s,l]=(0,r.useState)(!1),[o,i]=(0,r.useState)(null);return(0,r.useEffect)(()=>{(async()=>{try{try{localStorage.setItem("__stack_test__","test"),localStorage.removeItem("__stack_test__")}catch(e){throw Error("localStorage not available")}"complete"!==document.readyState&&await new Promise(e=>{"complete"===document.readyState?e():window.addEventListener("load",()=>e(),{once:!0})}),await new Promise(e=>setTimeout(e,200)),l(!0)}catch(e){console.error("Stack Auth initialization failed:",e),i(e instanceof Error?e.message:"Unknown error")}})()},[]),(0,a.jsx)(n.Provider,{value:{isStackReady:s,stackError:o},children:t})}function o(){return(0,r.useContext)(n)}},8039:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return y}});var a=s(7437),r=s(2265),n=s(338),l=s(7648),o=s(9376),i=s(8293),c=s(9637),d=s(8736),u=s(5252),h=s(4286),m=s(8728),x=s(7692),f=s(2369),b=s(1870);function g(){let{isAuthenticated:e,userProfile:t,login:s,logout:g,isLoading:y}=r.useContext(n.I),{isStackReady:v,stackError:j}=(0,b.B)(),w=(0,o.usePathname)(),[p,k]=(0,r.useState)(!1);return y||!v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"hidden md:flex items-center space-x-6",children:(0,a.jsx)("div",{className:"text-gray-500",children:"Loading navigation..."})}),(0,a.jsx)("div",{className:"md:hidden",children:(0,a.jsx)(i.Z,{size:24,className:"text-gray-400 animate-pulse"})})]}):j?(0,a.jsxs)("div",{className:"hidden md:flex items-center space-x-6 text-red-600",children:["Authentication Error: ",j]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"hidden md:flex items-center space-x-6",children:[(0,a.jsxs)(l.default,{href:"/",className:"text-gray-700 hover:text-blue-600 flex items-center ".concat("/"===w?"text-blue-600 font-semibold":""),children:[(0,a.jsx)(c.Z,{size:20,className:"mr-1"})," Dashboard"]}),e&&(null==t?void 0:t.role)==="member"&&(0,a.jsxs)(l.default,{href:"/my-requests",className:"text-gray-700 hover:text-blue-600 flex items-center ".concat("/my-requests"===w?"text-blue-600 font-semibold":""),children:[(0,a.jsx)(d.Z,{size:20,className:"mr-1"})," My Requests"]}),e&&(null==t?void 0:t.role)==="provider"&&(0,a.jsxs)(l.default,{href:"/my-quotes",className:"text-gray-700 hover:text-blue-600 flex items-center ".concat("/my-quotes"===w?"text-blue-600 font-semibold":""),children:[(0,a.jsx)(u.Z,{size:20,className:"mr-1"})," My Quotes"]}),e&&(null==t?void 0:t.role)==="admin"&&(0,a.jsxs)(l.default,{href:"/admin",className:"text-gray-700 hover:text-blue-600 flex items-center ".concat("/admin"===w?"text-blue-600 font-semibold":""),children:[(0,a.jsx)(h.Z,{size:20,className:"mr-1"})," Admin"]}),e&&(0,a.jsxs)(l.default,{href:"/settings",className:"text-gray-700 hover:text-blue-600 flex items-center ".concat("/settings"===w?"text-blue-600 font-semibold":""),children:[(0,a.jsx)(m.Z,{size:20,className:"mr-1"})," Settings"]}),e?(0,a.jsxs)("button",{onClick:g,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 flex items-center",children:[(0,a.jsx)(x.Z,{size:20,className:"mr-1"})," Logout"]}):(0,a.jsxs)("button",{onClick:s,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center",children:[(0,a.jsx)(f.Z,{size:20,className:"mr-1"})," Login"]})]}),(0,a.jsx)("div",{className:"md:hidden",children:(0,a.jsx)("button",{onClick:()=>k(!p),className:"text-gray-700 hover:text-blue-600",children:(0,a.jsx)(i.Z,{size:24})})}),p&&(0,a.jsxs)("div",{className:"absolute top-16 left-0 right-0 bg-white shadow-lg p-4 md:hidden z-30",children:[(0,a.jsx)(l.default,{href:"/",className:"block py-2 text-gray-700 hover:text-blue-600",onClick:()=>k(!1),children:"Dashboard"}),e&&(null==t?void 0:t.role)==="member"&&(0,a.jsx)(l.default,{href:"/my-requests",className:"block py-2 text-gray-700 hover:text-blue-600",onClick:()=>k(!1),children:"My Requests"}),e&&(null==t?void 0:t.role)==="provider"&&(0,a.jsx)(l.default,{href:"/my-quotes",className:"block py-2 text-gray-700 hover:text-blue-600",onClick:()=>k(!1),children:"My Quotes"}),e&&(null==t?void 0:t.role)==="admin"&&(0,a.jsx)(l.default,{href:"/admin",className:"block py-2 text-gray-700 hover:text-blue-600",onClick:()=>k(!1),children:"Admin"}),e&&(0,a.jsx)(l.default,{href:"/settings",className:"block py-2 text-gray-700 hover:text-blue-600",onClick:()=>k(!1),children:"Settings"}),e?(0,a.jsx)("button",{onClick:()=>{g(),k(!1)},className:"w-full text-left py-2 bg-red-600 text-white rounded-md hover:bg-red-700 mt-2",children:"Logout"}):(0,a.jsx)("button",{onClick:()=>{s(),k(!1)},className:"w-full text-left py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 mt-2",children:"Login"})]})]})}function y(e){let{children:t}=e;return(0,a.jsxs)("html",{lang:"en",children:[(0,a.jsxs)("head",{children:[(0,a.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),(0,a.jsx)("title",{children:"Mphakathi Online"})]}),(0,a.jsx)("body",{children:(0,a.jsx)(b.b,{children:(0,a.jsx)(b.SafeStackProvider,{children:(0,a.jsx)(n.w,{children:(0,a.jsxs)("div",{className:"min-h-screen bg-gray-100 flex flex-col",children:[(0,a.jsxs)("nav",{className:"bg-white shadow-md p-4 flex justify-between items-center sticky top-0 z-40",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Mphakathi Online"})}),(0,a.jsx)(g,{})]}),(0,a.jsx)("main",{className:"flex-grow p-4 md:p-8",children:t})]})})})})})]})}s(5660)},338:function(e,t,s){"use strict";s.d(t,{I:function(){return o},w:function(){return c}});var a=s(7437),r=s(2265),n=s(8104),l=s(1870);let o=(0,r.createContext)(null),i="http://localhost:8888",c=e=>{let{children:t}=e,{isStackReady:s,stackError:c}=(0,l.B)(),d=!1,u=null,h=!0,m=()=>console.warn("Stack Auth login not available (context not ready)."),x=()=>console.warn("Stack Auth logout not available (context not ready).");if(s&&!c)try{let{isAuthenticated:e,user:t,isLoading:s}=(0,n.a)(),a=(0,n.I)();d=e,u=t,h=s,m=a.login,x=a.logout}catch(e){console.warn("Error accessing Stack Auth context in AppProvider (might be a transient issue):",e)}let[f,b]=(0,r.useState)(null),[g,y]=(0,r.useState)([]),[v,j]=(0,r.useState)([]),[w,p]=(0,r.useState)(null),[k,N]=(0,r.useState)(!0),[S,C]=(0,r.useState)([]),[E,T]=(0,r.useState)([]),_=(0,r.useCallback)(async()=>{try{let e=await fetch("".concat(i,"/.netlify/functions/get-branding"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();b(t)}catch(e){console.error("Failed to fetch branding:",e)}},[]),P=(0,r.useCallback)(async()=>{try{let e=await fetch("".concat(i,"/.netlify/functions/get-pricing-plans"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();y(t)}catch(e){console.error("Failed to fetch pricing plans:",e)}},[]),z=(0,r.useCallback)(async()=>{try{let e=await fetch("".concat(i,"/.netlify/functions/get-problems"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();j(t)}catch(e){console.error("Failed to fetch public problems:",e)}},[]),q=(0,r.useCallback)(async()=>{if(!d||!(null==u?void 0:u.id)){p(null);return}try{let e=await u.getIdToken(),t=await fetch("".concat(i,"/.netlify/functions/get-or-create-user-profile"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({auth_id:u.id,email:u.email,name:u.name||(u.email?u.email.split("@")[0]:"User")})});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let s=await t.json();p(s)}catch(e){console.error("Failed to fetch or create user profile:",e),p(null)}},[d,u]),A=(0,r.useCallback)(async()=>{if(!d||!(null==w?void 0:w.id)){C([]);return}try{let e=await u.getIdToken(),t=await fetch("".concat(i,"/.netlify/functions/get-my-requests?userId=").concat(w.id),{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let s=await t.json();C(s)}catch(e){console.error("Failed to fetch my requests:",e),C([])}},[d,null==w?void 0:w.id,u]),I=(0,r.useCallback)(async()=>{if(!d||!(null==w?void 0:w.id)||(null==w?void 0:w.role)!=="provider"){T([]);return}try{let e=await u.getIdToken(),t=await fetch("".concat(i,"/.netlify/functions/get-my-quotes?providerId=").concat(w.id),{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let s=await t.json();T(s)}catch(e){console.error("Failed to fetch my quotes:",e),T([])}},[d,null==w?void 0:w.id,null==w?void 0:w.role,u]);(0,r.useEffect)(()=>{(async()=>{N(!0),await Promise.all([_(),P(),z()]),N(!1)})()},[_,P,z]),(0,r.useEffect)(()=>{d&&s?q():(p(null),C([]),T([]))},[d,q,s]),(0,r.useEffect)(()=>{(null==w?void 0:w.id)&&d&&s&&(A(),I())},[null==w?void 0:w.id,d,A,I,s]);let L={branding:f,pricingPlans:g,publicProblems:v,userProfile:w,myRequests:S,myQuotes:E,fetchMyRequests:A,fetchPublicProblems:z,fetchMyQuotes:I,isAuthenticated:d,user:u,isLoading:h||k||!s,login:m,logout:x};return(0,a.jsx)(o.Provider,{value:L,children:t})}},5660:function(){}},function(e){e.O(0,[152,487,971,117,744],function(){return e(e.s=7327)}),_N_E=e.O()}]);