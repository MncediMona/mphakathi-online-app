(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[569],{2849:function(t,e,o){Promise.resolve().then(o.bind(o,1806))},1870:function(t,e,o){"use strict";o.d(e,{B:function(){return i},b:function(){return s}});var r=o(7437),a=o(2265);let n=(0,a.createContext)({isStackReady:!1,stackError:null});function s(t){let{children:e}=t,[o,s]=(0,a.useState)(!1),[i,l]=(0,a.useState)(null);return(0,a.useEffect)(()=>{(async()=>{try{try{localStorage.setItem("__stack_test__","test"),localStorage.removeItem("__stack_test__")}catch(t){throw Error("localStorage not available")}"complete"!==document.readyState&&await new Promise(t=>{"complete"===document.readyState?t():window.addEventListener("load",()=>t(),{once:!0})}),await new Promise(t=>setTimeout(t,200)),s(!0)}catch(t){console.error("Stack Auth initialization failed:",t),l(t instanceof Error?t.message:"Unknown error")}})()},[]),(0,r.jsx)(n.Provider,{value:{isStackReady:o,stackError:i},children:e})}function i(){return(0,a.useContext)(n)}},1806:function(t,e,o){"use strict";o.r(e),o.d(e,{default:function(){return s}});var r=o(7437),a=o(2265),n=o(338);function s(){let{isAuthenticated:t,userProfile:e,myQuotes:o,fetchMyQuotes:s,isLoading:i}=a.useContext(n.I);return((0,a.useEffect)(()=>{t&&(null==e?void 0:e.id)&&(null==e?void 0:e.role)==="provider"&&!i&&s()},[t,null==e?void 0:e.id,null==e?void 0:e.role,s,i]),i)?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-[calc(100vh-100px)]",children:(0,r.jsx)("div",{className:"text-xl font-semibold text-gray-700",children:"Loading your quotes..."})}):t&&(null==e?void 0:e.role)==="provider"?(0,r.jsxs)("section",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[(0,r.jsxs)("h2",{className:"text-2xl font-semibold text-gray-800 mb-4",children:["My Submitted Quotes (",o.length,")"]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.length>0?o.map(t=>{var e;return(0,r.jsxs)("div",{className:"p-4 bg-gray-50 rounded-md border border-gray-200 shadow-sm",children:[(0,r.jsxs)("h4",{className:"text-lg font-medium text-gray-800 mb-1",children:["Quote for: ",t.problem_title]}),(0,r.jsxs)("p",{className:"text-gray-600 text-sm mb-2",children:["Amount: R",null===(e=t.amount)||void 0===e?void 0:e.toFixed(2)]}),(0,r.jsxs)("p",{className:"text-gray-500 text-xs",children:["Status: ",t.status]})]},t.id)}):(0,r.jsx)("p",{className:"text-gray-600",children:"You haven't submitted any quotes yet."})})]}):(0,r.jsxs)("section",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 mb-4",children:"Access Denied"}),(0,r.jsx)("p",{className:"text-gray-700",children:"You must be logged in as a provider to view your quotes."})]})}},338:function(t,e,o){"use strict";o.d(e,{I:function(){return i},w:function(){return c}});var r=o(7437),a=o(2265),n=o(8104),s=o(1870);let i=(0,a.createContext)(null),l="http://localhost:8888",c=t=>{let{children:e}=t,{isStackReady:o,stackError:c}=(0,s.B)(),u=!1,d=null,f=!0,h=()=>console.warn("Stack Auth login not available (context not ready)."),m=()=>console.warn("Stack Auth logout not available (context not ready).");if(o&&!c)try{let{isAuthenticated:t,user:e,isLoading:o}=(0,n.a)(),r=(0,n.I)();u=t,d=e,f=o,h=r.login,m=r.logout}catch(t){console.warn("Error accessing Stack Auth context in AppProvider (might be a transient issue):",t)}let[p,g]=(0,a.useState)(null),[y,w]=(0,a.useState)([]),[v,x]=(0,a.useState)([]),[b,j]=(0,a.useState)(null),[k,S]=(0,a.useState)(!0),[E,I]=(0,a.useState)([]),[T,_]=(0,a.useState)([]),N=(0,a.useCallback)(async()=>{try{let t=await fetch("".concat(l,"/.netlify/functions/get-branding"));if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let e=await t.json();g(e)}catch(t){console.error("Failed to fetch branding:",t)}},[]),C=(0,a.useCallback)(async()=>{try{let t=await fetch("".concat(l,"/.netlify/functions/get-pricing-plans"));if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let e=await t.json();w(e)}catch(t){console.error("Failed to fetch pricing plans:",t)}},[]),P=(0,a.useCallback)(async()=>{try{let t=await fetch("".concat(l,"/.netlify/functions/get-problems"));if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let e=await t.json();x(e)}catch(t){console.error("Failed to fetch public problems:",t)}},[]),A=(0,a.useCallback)(async()=>{if(!u||!(null==d?void 0:d.id)){j(null);return}try{let t=await d.getIdToken(),e=await fetch("".concat(l,"/.netlify/functions/get-or-create-user-profile"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({auth_id:d.id,email:d.email,name:d.name||(d.email?d.email.split("@")[0]:"User")})});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let o=await e.json();j(o)}catch(t){console.error("Failed to fetch or create user profile:",t),j(null)}},[u,d]),M=(0,a.useCallback)(async()=>{if(!u||!(null==b?void 0:b.id)){I([]);return}try{let t=await d.getIdToken(),e=await fetch("".concat(l,"/.netlify/functions/get-my-requests?userId=").concat(b.id),{headers:{Authorization:"Bearer ".concat(t)}});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let o=await e.json();I(o)}catch(t){console.error("Failed to fetch my requests:",t),I([])}},[u,null==b?void 0:b.id,d]),q=(0,a.useCallback)(async()=>{if(!u||!(null==b?void 0:b.id)||(null==b?void 0:b.role)!=="provider"){_([]);return}try{let t=await d.getIdToken(),e=await fetch("".concat(l,"/.netlify/functions/get-my-quotes?providerId=").concat(b.id),{headers:{Authorization:"Bearer ".concat(t)}});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let o=await e.json();_(o)}catch(t){console.error("Failed to fetch my quotes:",t),_([])}},[u,null==b?void 0:b.id,null==b?void 0:b.role,d]);(0,a.useEffect)(()=>{(async()=>{S(!0),await Promise.all([N(),C(),P()]),S(!1)})()},[N,C,P]),(0,a.useEffect)(()=>{u&&o?A():(j(null),I([]),_([]))},[u,A,o]),(0,a.useEffect)(()=>{(null==b?void 0:b.id)&&u&&o&&(M(),q())},[null==b?void 0:b.id,u,M,q,o]);let F={branding:p,pricingPlans:y,publicProblems:v,userProfile:b,myRequests:E,myQuotes:T,fetchMyRequests:M,fetchPublicProblems:P,fetchMyQuotes:q,isAuthenticated:u,user:d,isLoading:f||k||!o,login:h,logout:m};return(0,r.jsx)(i.Provider,{value:F,children:e})}},8104:function(t,e,o){"use strict";o.d(e,{I:function(){return l},a:function(){return i}});var r=o(2265),a="undefined"!=typeof globalThis?globalThis:void 0!==o.g?o.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{};"undefined"==typeof globalThis&&(a.globalThis=a);var n=Symbol.for("__stack-globals");a[n]??={},o(7437);var s=r.createContext(null);function i(t={}){let e=l(t);if(t.projectIdMustMatch&&e.projectId!==t.projectIdMustMatch)throw Error("Unexpected project ID in useStackApp: "+e.projectId);return t.projectIdMustMatch,e.useUser(t)}function l(t={}){let e=(0,r.useContext)(s);if(null===e)throw Error("useStackApp must be used within a StackProvider");let o=e.app;if(t.projectIdMustMatch&&o.projectId!==t.projectIdMustMatch)throw Error("Unexpected project ID in useStackApp: "+o.projectId);return o}}},function(t){t.O(0,[971,117,744],function(){return t(t.s=2849)}),_N_E=t.O()}]);