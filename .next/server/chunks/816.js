"use strict";exports.id=816,exports.ids=[816],exports.modules={816:(e,t,s)=>{s.d(t,{o:()=>x});var a=s(326),o=s(7577),r=s.n(o),l=s(4019),d=s(2881);let i=(0,d.Z)("CircleCheckBig",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),n=(0,d.Z)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var c=s(1821),u=s(9974),p=s(819);let m="http://localhost:8888",x=({problemId:e,onClose:t,onShowQuoteModal:s})=>{let[d,x]=(0,o.useState)(null),[h,b]=(0,o.useState)([]),{isAuthenticated:g,user:y,userProfile:f,fetchMyRequests:j,fetchPublicProblems:v,fetchMyQuotes:w}=r().useContext(u.I),N=(0,o.useCallback)(async()=>{try{let t=await fetch(`${m}/.netlify/functions/get-problem-details?problemId=${e}`);if(!t.ok)throw Error(`HTTP error! status: ${t.status}`);let s=await t.json();x(s);let a=await fetch(`${m}/.netlify/functions/get-quotes-for-problem?problemId=${e}`);if(!a.ok)throw Error(`HTTP error! status: ${a.status}`);let o=await a.json();b(o)}catch(e){console.error("Failed to fetch problem details or quotes:",e),alert("Failed to load problem details: "+e.message)}},[e]);(0,o.useEffect)(()=>{N()},[N]);let S=(0,o.useCallback)(async e=>{if(!g||!y||!f||d?.user_id!==f.id){alert("You are not authorized to accept this quote.");return}try{let t=await fetch(`${m}/.netlify/functions/update-quote-status`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({quoteId:e,status:"accepted",problemId:d.id,userId:f.id})});if(!t.ok)throw Error(`HTTP error! status: ${t.status}`);await t.json(),alert("Quote accepted! Problem status updated."),N(),j&&j(),v&&v()}catch(e){console.error("Failed to accept quote:",e),alert("Failed to accept quote: "+e.message)}},[g,y,f,d,N,j,v]),k=(0,o.useCallback)(async(e,t)=>{if(!g||f?.role!=="provider"||!f?.id){alert("You must be logged in as an approved provider to submit a quote.");return}try{let s=await fetch(`${m}/.netlify/functions/submit-quote`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({problemId:e,providerId:f.id,amount:t.proposedBudget,details:t.motivation,proposedStartDate:t.proposedStartDate,proposedEndDate:t.proposedEndDate})});if(!s.ok)throw Error(`HTTP error! status: ${s.status}`);await s.json(),alert("Quote submitted successfully!"),N(),w&&w()}catch(e){console.error("Failed to submit quote:",e),alert("Failed to submit quote: "+e.message)}},[g,f,N,w]),[D,C]=(0,o.useState)(!1);if(!d)return a.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-xl w-full max-w-2xl rounded-md relative",children:[a.jsx("div",{className:"text-center",children:"Loading problem details..."}),a.jsx("button",{onClick:t,className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700",children:a.jsx(l.Z,{size:24})})]})});let q=g&&f&&d.user_id===f.id,P=g&&f?.role==="provider";return(0,a.jsxs)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50",children:[(0,a.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-xl w-full max-w-3xl rounded-md relative overflow-y-auto max-h-[90vh]",children:[a.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-4",children:d.title}),a.jsx("p",{className:"text-gray-700 mb-6",children:d.description}),(0,a.jsxs)("p",{className:"text-gray-500 text-sm mb-4",children:["Location: ",d.location," | Status: ",d.status," | Budget: R",d.estimated_budget?.toFixed(2)||"N/A"]}),q&&"open"===d.status&&(0,a.jsxs)("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-md",children:[a.jsx("h3",{className:"text-xl font-semibold text-yellow-800 mb-2",children:"Quotes for Your Problem"}),h.length>0?a.jsx("div",{className:"space-y-4",children:h.map(e=>(0,a.jsxs)("div",{className:"p-4 bg-white border border-gray-200 rounded-md shadow-sm",children:[(0,a.jsxs)("p",{className:"font-semibold text-lg text-blue-700",children:["Amount: R",e.amount?.toFixed(2)]}),a.jsx("p",{className:"text-gray-700 text-sm mb-2",children:e.details})," ",(0,a.jsxs)("p",{className:"text-gray-600 text-xs",children:["By Provider ID: ",e.provider_id||"N/A"," | Status: ",e.status,e.proposedStartDate&&` | Start: ${new Date(e.proposedStartDate).toLocaleDateString()}`,e.proposedEndDate&&` | End: ${new Date(e.proposedEndDate).toLocaleDateString()}`]}),"pending"===e.status&&a.jsx("div",{className:"mt-3 flex space-x-2",children:(0,a.jsxs)("button",{onClick:()=>S(e.id),className:"px-3 py-1 bg-green-500 text-white text-sm rounded-md hover:bg-green-600 flex items-center",children:[a.jsx(i,{size:16,className:"mr-1"})," Accept"]})}),"accepted"===e.status&&(0,a.jsxs)("p",{className:"text-green-600 font-semibold mt-2 flex items-center",children:[a.jsx(n,{size:16,className:"mr-1"})," Accepted!"]})]},e.id))}):a.jsx("p",{className:"text-gray-600",children:"No quotes submitted yet for this problem."})]}),P&&"open"===d.status&&!h.some(e=>e.provider_id===f.id&&"pending"===e.status)&&(0,a.jsxs)("button",{onClick:()=>C(!0),className:"mt-6 px-6 py-3 bg-green-600 text-white font-semibold rounded-md hover:bg-green-700 transition-colors duration-200 flex items-center shadow-md",children:[a.jsx(c.Z,{size:20,className:"mr-2"})," Submit a Quote"]}),a.jsx("div",{className:"flex justify-end mt-8",children:a.jsx("button",{onClick:t,className:"px-6 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition-colors duration-200",children:"Close"})}),a.jsx("button",{onClick:t,className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700",children:a.jsx(l.Z,{size:24})})]}),D&&a.jsx(p.G,{isOpen:D,onClose:()=>C(!1),problem:d,onSubmitQuote:k})]})}},819:(e,t,s)=>{s.d(t,{G:()=>l});var a=s(326),o=s(7577),r=s(4019);let l=({isOpen:e,onClose:t,problem:s,onSubmitQuote:l})=>{let[d,i]=(0,o.useState)(""),[n,c]=(0,o.useState)(""),[u,p]=(0,o.useState)(""),[m,x]=(0,o.useState)(""),[h,b]=(0,o.useState)("");return e&&s?a.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-md max-h-screen overflow-y-auto rounded-md relative",children:[(0,a.jsxs)("h3",{className:"text-2xl font-bold text-gray-800 mb-6",children:['Submit Quote for: "',s.title,'"']}),a.jsx("button",{onClick:t,className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700",children:a.jsx(r.Z,{size:24})}),(0,a.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),b(""),!d||!n||!u||!m){b("All fields are required.");return}if(0>=parseFloat(d)){b("Proposed Budget must be a positive number.");return}if(new Date(u)>new Date(m)){b("Proposed Start Date cannot be after Proposed End Date.");return}l(s.id,{proposedBudget:parseFloat(d),motivation:n,proposedStartDate:u,proposedEndDate:m})},className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"proposedBudget",children:"Proposed Budget (R)"}),a.jsx("input",{type:"number",id:"proposedBudget",step:"0.01",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:d,onChange:e=>i(e.target.value),required:!0})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"motivation",children:"Motivation / Details"}),a.jsx("textarea",{id:"motivation",rows:"4",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:n,onChange:e=>c(e.target.value),required:!0})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"proposedStartDate",children:"Proposed Start Date"}),a.jsx("input",{type:"date",id:"proposedStartDate",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:u,onChange:e=>p(e.target.value),required:!0})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"proposedEndDate",children:"Proposed End Date"}),a.jsx("input",{type:"date",id:"proposedEndDate",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:m,onChange:e=>x(e.target.value),required:!0})]}),h&&a.jsx("p",{className:"text-red-500 text-sm",children:h}),(0,a.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[a.jsx("button",{type:"button",onClick:t,className:"px-6 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition-colors duration-200",children:"Cancel"}),a.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200",children:"Submit Quote"})]})]})]})}):null}},4019:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(2881).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}};