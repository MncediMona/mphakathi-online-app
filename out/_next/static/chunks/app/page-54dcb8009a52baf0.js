(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7867:function(e,t,s){Promise.resolve().then(s.bind(s,8107))},9210:function(e,t,s){"use strict";s.d(t,{c:function(){return l}});var a=s(7437);s(2265);let l=e=>{let{message:t,onConfirm:s,onCancel:l,confirmText:r="Confirm",cancelText:o="Cancel"}=e;return(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-xl w-full max-w-sm rounded-md",children:[(0,a.jsx)("p",{className:"text-lg text-gray-800 mb-6",children:t}),(0,a.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,a.jsx)("button",{onClick:l,className:"px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition-colors duration-200",children:o}),(0,a.jsx)("button",{onClick:s,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200",children:r})]})]})})}},8107:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return b}});var a=s(5583),l=s(1780),r=s(7437),o=s(2265),i=s(7911);let d=(0,s(9205).Z)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);var n=s(2489);let c=e=>{let{isOpen:t,onClose:s,onPost:a,isPaidMember:l}=e,[i,d]=(0,o.useState)(""),[c,m]=(0,o.useState)(""),[u,x]=(0,o.useState)(""),[h,b]=(0,o.useState)(""),[g,p]=(0,o.useState)(""),[y,j]=(0,o.useState)("");return t?(0,r.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-md max-h-screen overflow-y-auto rounded-md relative",children:[(0,r.jsx)("h3",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Post a New Problem"}),(0,r.jsx)("button",{onClick:s,className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700",children:(0,r.jsx)(n.Z,{size:24})}),!l&&(0,r.jsxs)("div",{className:"bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-4 rounded-md",role:"alert",children:[(0,r.jsx)("p",{className:"font-bold",children:"Free member limit:"}),(0,r.jsx)("p",{className:"text-sm",children:"As a free member, your problem will be public but features like accepting quotes are locked. Upgrade to a paid plan to unlock all features."})]}),(0,r.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),j(""),!i||!c||!u||!h||!g){j("All fields are required.");return}if(0>=parseFloat(g)){j("Budget must be a positive number.");return}a({title:i,description:c,category:u,location:h,estimated_budget:parseFloat(g),status:"open",is_approved:!1})},className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"title",children:"Title"}),(0,r.jsx)("input",{type:"text",id:"title",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:i,onChange:e=>d(e.target.value),required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"description",children:"Description"}),(0,r.jsx)("textarea",{id:"description",rows:"3",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:c,onChange:e=>m(e.target.value),required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"category",children:"Category"}),(0,r.jsx)("input",{type:"text",id:"category",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:u,onChange:e=>x(e.target.value),required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"location",children:"Location"}),(0,r.jsx)("input",{type:"text",id:"location",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:h,onChange:e=>b(e.target.value),required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"estimatedBudget",children:"Estimated Budget (R)"}),(0,r.jsx)("input",{type:"number",id:"estimatedBudget",step:"0.01",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:g,onChange:e=>p(e.target.value),required:!0})]}),y&&(0,r.jsx)("p",{className:"text-red-500 text-sm",children:y}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[(0,r.jsx)("button",{type:"button",onClick:s,className:"px-6 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition-colors duration-200",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors duration-200",children:"Post Problem"})]})]})]})}):null};var m=s(1901),u=s(9306),x=s(9210);let h="http://localhost:8888";function b(){let{isAuthenticated:e,user:t,userProfile:s,publicProblems:n,pricingPlans:b,myRequests:g,myQuotes:p,fetchMyRequests:y,fetchPublicProblems:j,fetchMyQuotes:v,isLoading:f}=o.useContext(i.I),[N,w]=(0,o.useState)(!1),[C,k]=(0,o.useState)(!1),[S,P]=(0,o.useState)(null),[_,F]=(0,o.useState)(!1),[q,O]=(0,o.useState)(null),[D,M]=(0,o.useState)(!1),[T,E]=(0,o.useState)(""),[Q,B]=(0,o.useState)(()=>()=>{}),Y=o.useCallback(async t=>{if(!e||!(null==s?void 0:s.id)){alert("You must be logged in to post a problem.");return}try{let e=await fetch("".concat(h,"/.netlify/functions/post-problem"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,l._)((0,a._)({},t),{userId:s.id}))});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));(await e.json()).is_approved&&j(),y(),w(!1),alert("Problem posted successfully! Awaiting admin approval if applicable.")}catch(e){console.error("Failed to post problem:",e),alert("Failed to post problem: "+e.message)}},[e,s,j,y]),A=o.useCallback(async(t,a)=>{if(!e||(null==s?void 0:s.role)!=="provider"||!(null==s?void 0:s.id)){alert("You must be logged in as an approved provider to submit a quote.");return}try{let e=await fetch("".concat(h,"/.netlify/functions/submit-quote"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({problemId:t,providerId:s.id,amount:a.proposedBudget,details:a.motivation,proposedStartDate:a.proposedStartDate,proposedEndDate:a.proposedEndDate})});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));await e.json(),P(null),k(!1),v(),alert("Quote submitted successfully!")}catch(e){console.error("Failed to submit quote:",e),alert("Failed to submit quote: "+e.message)}},[e,s,v]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(()=>f?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-[calc(100vh-100px)]",children:(0,r.jsx)("div",{className:"text-xl font-semibold text-gray-700",children:"Loading dashboard data..."})}):e?(null==s?void 0:s.role)==="member"?(0,r.jsxs)("section",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 mb-4",children:"Member Dashboard"}),(0,r.jsxs)("p",{className:"text-gray-700 mb-4",children:["Hello, ",(null==s?void 0:s.name)||(null==s?void 0:s.email)||(null==t?void 0:t.email)||"User","! Your role is Member."]}),(0,r.jsxs)("button",{onClick:()=>w(!0),className:"mb-6 px-6 py-3 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition-colors duration-200 flex items-center shadow-md",children:[(0,r.jsx)(d,{size:20,className:"mr-2"})," Post a New Problem"]}),(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsxs)("h3",{className:"text-xl font-semibold text-gray-700 mb-4",children:["My Posted Problems (",g.length,")"]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:g.length>0?g.map(e=>(0,r.jsxs)("div",{className:"p-4 bg-gray-50 rounded-md border border-gray-200 shadow-sm",children:[(0,r.jsx)("h4",{className:"text-lg font-medium text-gray-800 mb-1",children:e.title}),(0,r.jsx)("p",{className:"text-gray-600 text-sm mb-2",children:e.description}),(0,r.jsxs)("p",{className:"text-gray-500 text-xs",children:["Status: ",e.status]}),(0,r.jsx)("button",{onClick:()=>{O(e.id),F(!0)},className:"mt-2 px-3 py-1 bg-blue-500 text-white text-sm rounded-md hover:bg-blue-600",children:"View Details"})]},e.id)):(0,r.jsx)("p",{className:"text-gray-600",children:"You haven't posted any problems yet."})})]})]}):(null==s?void 0:s.role)==="provider"?(0,r.jsxs)("section",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 mb-4",children:"Provider Dashboard"}),(0,r.jsxs)("p",{className:"text-gray-700 mb-4",children:["Hello, ",(null==s?void 0:s.name)||(null==s?void 0:s.email)||(null==t?void 0:t.email)||"User","! Your role is Provider."]}),(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsxs)("h3",{className:"text-xl font-semibold text-gray-700 mb-4",children:["Available Problems to Quote On (",n.length,")"]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.length>0?n.filter(e=>"open"===e.status).map(e=>{var t;return(0,r.jsxs)("div",{className:"p-4 bg-gray-50 rounded-md border border-gray-200 shadow-md",children:[(0,r.jsx)("h4",{className:"text-lg font-medium text-gray-800 mb-1",children:e.title}),(0,r.jsx)("p",{className:"text-gray-600 text-sm mb-2",children:e.description}),(0,r.jsxs)("p",{className:"text-gray-500 text-xs",children:["Location: ",e.location," | Budget: R",null===(t=e.estimated_budget)||void 0===t?void 0:t.toFixed(2)]}),(0,r.jsx)("button",{onClick:()=>{O(e.id),F(!0)},className:"mt-2 px-3 py-1 bg-blue-500 text-white text-sm rounded-md hover:bg-blue-600",children:"View Details"}),p.some(t=>t.problem_id===e.id&&t.provider_id===s.id)?(0,r.jsx)("span",{className:"text-sm text-gray-500 ml-2",children:" (Quoted)"}):(0,r.jsx)("button",{onClick:()=>{P(e),k(!0)},className:"mt-2 ml-2 px-3 py-1 bg-green-500 text-white text-sm rounded-md hover:bg-green-600",children:"Submit Quote"})]},e.id)}):(0,r.jsx)("p",{className:"text-gray-600",children:"No open problems available to quote on."})})]}),(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsxs)("h3",{className:"text-xl font-semibold text-gray-700 mb-4",children:["My Submitted Quotes (",p.length,")"]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:p.length>0?p.map(e=>{var t;return(0,r.jsxs)("div",{className:"p-4 bg-gray-50 rounded-md border border-gray-200 shadow-sm",children:[(0,r.jsxs)("h4",{className:"text-lg font-medium text-gray-800 mb-1",children:["Quote for: ",e.problem_title]}),(0,r.jsxs)("p",{className:"text-gray-600 text-sm mb-2",children:["Amount: R",null===(t=e.amount)||void 0===t?void 0:t.toFixed(2)]}),(0,r.jsxs)("p",{className:"text-gray-500 text-xs",children:["Status: ",e.status]})]},e.id)}):(0,r.jsx)("p",{className:"text-gray-600",children:"You haven't submitted any quotes yet."})})]})]}):null:(0,r.jsxs)("section",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 mb-4",children:"Welcome to Mphakathi Online!"}),(0,r.jsx)("p",{className:"text-gray-700",children:"Please log in to access all features."}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsxs)("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:["Public Problems (",n.length,")"]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.length>0?n.map(e=>(0,r.jsxs)("div",{className:"p-4 bg-gray-50 rounded-md border border-gray-200 shadow-sm",children:[(0,r.jsx)("h4",{className:"text-lg font-medium text-gray-800 mb-1",children:e.title}),(0,r.jsx)("p",{className:"text-gray-600 text-sm mb-2",children:e.description}),(0,r.jsxs)("p",{className:"text-gray-500 text-xs",children:["Location: ",e.location]})]},e.id)):(0,r.jsx)("p",{className:"text-gray-600",children:"No public problems available. Check back soon!"})}),(0,r.jsxs)("div",{className:"mt-8",children:[(0,r.jsxs)("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:["Our Pricing Plans (",b.length,")"]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:b.length>0?b.map(e=>{var t;return(0,r.jsxs)("div",{className:"p-6 bg-gray-50 rounded-lg border border-gray-200 shadow-md flex flex-col justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-xl font-bold text-blue-700 mb-2",children:e.name}),(0,r.jsx)("p",{className:"text-gray-700 text-sm mb-3",children:e.description}),(0,r.jsx)("p",{className:"text-2xl font-extrabold text-gray-900 mb-4",children:e.price_display}),(0,r.jsx)("ul",{className:"mt-2 text-gray-600 text-sm list-disc list-inside space-y-1",children:null===(t=e.features)||void 0===t?void 0:t.map((e,t)=>(0,r.jsx)("li",{children:e},t))})]}),(0,r.jsx)("button",{className:"mt-6 w-full py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200 shadow-sm",children:"Contact Us"===e.price_display?"Contact Sales":"Choose Plan"})]},e.id)}):(0,r.jsx)("p",{className:"text-gray-600",children:"No pricing plans available at the moment."})})]})]})]}),{}),(0,r.jsx)(c,{isOpen:N,onClose:()=>w(!1),onPost:Y,isPaidMember:null==s?void 0:s.is_paid_member}),(0,r.jsx)(m.G,{isOpen:C,onClose:()=>k(!1),problem:S,onSubmitQuote:A}),_&&(0,r.jsx)(u.o,{problemId:q,onClose:()=>F(!1),onShowQuoteModal:e=>{P(e),k(!0)}}),D&&(0,r.jsx)(x.c,{message:T,onConfirm:Q,onCancel:()=>M(!1)})]})}}},function(e){e.O(0,[347,306,971,117,744],function(){return e(e.s=7867)}),_N_E=e.O()}]);