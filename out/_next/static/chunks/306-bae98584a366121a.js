"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[306],{9306:function(e,t,a){a.d(t,{o:function(){return p}});var o=a(7437),s=a(2265),r=a(2489),l=a(9205);let n=(0,l.Z)("CircleCheckBig",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),i=(0,l.Z)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var d=a(5252),c=a(7911),u=a(1901);let m="http://localhost:8888",p=e=>{var t;let{problemId:a,onClose:l,onShowQuoteModal:p}=e,[x,g]=(0,s.useState)(null),[h,b]=(0,s.useState)([]),{isAuthenticated:f,user:y,userProfile:v,fetchMyRequests:j,fetchPublicProblems:w,fetchMyQuotes:N}=s.useContext(c.I),k=(0,s.useCallback)(async()=>{try{let e=await fetch("".concat(m,"/.netlify/functions/get-problem-details?problemId=").concat(a));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();g(t);let o=await fetch("".concat(m,"/.netlify/functions/get-quotes-for-problem?problemId=").concat(a));if(!o.ok)throw Error("HTTP error! status: ".concat(o.status));let s=await o.json();b(s)}catch(e){console.error("Failed to fetch problem details or quotes:",e),alert("Failed to load problem details: "+e.message)}},[a]);(0,s.useEffect)(()=>{k()},[k]);let S=(0,s.useCallback)(async e=>{if(!f||!y||!v||(null==x?void 0:x.user_id)!==v.id){alert("You are not authorized to accept this quote.");return}try{let t=await fetch("".concat(m,"/.netlify/functions/update-quote-status"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({quoteId:e,status:"accepted",problemId:x.id,userId:v.id})});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));await t.json(),alert("Quote accepted! Problem status updated."),k(),j&&j(),w&&w()}catch(e){console.error("Failed to accept quote:",e),alert("Failed to accept quote: "+e.message)}},[f,y,v,x,k,j,w]),C=(0,s.useCallback)(async(e,t)=>{if(!f||(null==v?void 0:v.role)!=="provider"||!(null==v?void 0:v.id)){alert("You must be logged in as an approved provider to submit a quote.");return}try{let a=await fetch("".concat(m,"/.netlify/functions/submit-quote"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({problemId:e,providerId:v.id,amount:t.proposedBudget,details:t.motivation,proposedStartDate:t.proposedStartDate,proposedEndDate:t.proposedEndDate})});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));await a.json(),alert("Quote submitted successfully!"),k(),N&&N()}catch(e){console.error("Failed to submit quote:",e),alert("Failed to submit quote: "+e.message)}},[f,v,k,N]),[E,D]=(0,s.useState)(!1);if(!x)return(0,o.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,o.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-xl w-full max-w-2xl rounded-md relative",children:[(0,o.jsx)("div",{className:"text-center",children:"Loading problem details..."}),(0,o.jsx)("button",{onClick:l,className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700",children:(0,o.jsx)(r.Z,{size:24})})]})});let _=f&&v&&x.user_id===v.id,P=f&&(null==v?void 0:v.role)==="provider";return(0,o.jsxs)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50",children:[(0,o.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-xl w-full max-w-3xl rounded-md relative overflow-y-auto max-h-[90vh]",children:[(0,o.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-4",children:x.title}),(0,o.jsx)("p",{className:"text-gray-700 mb-6",children:x.description}),(0,o.jsxs)("p",{className:"text-gray-500 text-sm mb-4",children:["Location: ",x.location," | Status: ",x.status," | Budget: R",(null===(t=x.estimated_budget)||void 0===t?void 0:t.toFixed(2))||"N/A"]}),_&&"open"===x.status&&(0,o.jsxs)("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-md",children:[(0,o.jsx)("h3",{className:"text-xl font-semibold text-yellow-800 mb-2",children:"Quotes for Your Problem"}),h.length>0?(0,o.jsx)("div",{className:"space-y-4",children:h.map(e=>{var t;return(0,o.jsxs)("div",{className:"p-4 bg-white border border-gray-200 rounded-md shadow-sm",children:[(0,o.jsxs)("p",{className:"font-semibold text-lg text-blue-700",children:["Amount: R",null===(t=e.amount)||void 0===t?void 0:t.toFixed(2)]}),(0,o.jsx)("p",{className:"text-gray-700 text-sm mb-2",children:e.details})," ",(0,o.jsxs)("p",{className:"text-gray-600 text-xs",children:["By Provider ID: ",e.provider_id||"N/A"," | Status: ",e.status,e.proposedStartDate&&" | Start: ".concat(new Date(e.proposedStartDate).toLocaleDateString()),e.proposedEndDate&&" | End: ".concat(new Date(e.proposedEndDate).toLocaleDateString())]}),"pending"===e.status&&(0,o.jsx)("div",{className:"mt-3 flex space-x-2",children:(0,o.jsxs)("button",{onClick:()=>S(e.id),className:"px-3 py-1 bg-green-500 text-white text-sm rounded-md hover:bg-green-600 flex items-center",children:[(0,o.jsx)(n,{size:16,className:"mr-1"})," Accept"]})}),"accepted"===e.status&&(0,o.jsxs)("p",{className:"text-green-600 font-semibold mt-2 flex items-center",children:[(0,o.jsx)(i,{size:16,className:"mr-1"})," Accepted!"]})]},e.id)})}):(0,o.jsx)("p",{className:"text-gray-600",children:"No quotes submitted yet for this problem."})]}),P&&"open"===x.status&&!h.some(e=>e.provider_id===v.id&&"pending"===e.status)&&(0,o.jsxs)("button",{onClick:()=>D(!0),className:"mt-6 px-6 py-3 bg-green-600 text-white font-semibold rounded-md hover:bg-green-700 transition-colors duration-200 flex items-center shadow-md",children:[(0,o.jsx)(d.Z,{size:20,className:"mr-2"})," Submit a Quote"]}),(0,o.jsx)("div",{className:"flex justify-end mt-8",children:(0,o.jsx)("button",{onClick:l,className:"px-6 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition-colors duration-200",children:"Close"})}),(0,o.jsx)("button",{onClick:l,className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700",children:(0,o.jsx)(r.Z,{size:24})})]}),E&&(0,o.jsx)(u.G,{isOpen:E,onClose:()=>D(!1),problem:x,onSubmitQuote:C})]})}},1901:function(e,t,a){a.d(t,{G:function(){return l}});var o=a(7437),s=a(2265),r=a(2489);let l=e=>{let{isOpen:t,onClose:a,problem:l,onSubmitQuote:n}=e,[i,d]=(0,s.useState)(""),[c,u]=(0,s.useState)(""),[m,p]=(0,s.useState)(""),[x,g]=(0,s.useState)(""),[h,b]=(0,s.useState)("");return t&&l?(0,o.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,o.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-md max-h-screen overflow-y-auto rounded-md relative",children:[(0,o.jsxs)("h3",{className:"text-2xl font-bold text-gray-800 mb-6",children:['Submit Quote for: "',l.title,'"']}),(0,o.jsx)("button",{onClick:a,className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700",children:(0,o.jsx)(r.Z,{size:24})}),(0,o.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),b(""),!i||!c||!m||!x){b("All fields are required.");return}if(0>=parseFloat(i)){b("Proposed Budget must be a positive number.");return}if(new Date(m)>new Date(x)){b("Proposed Start Date cannot be after Proposed End Date.");return}n(l.id,{proposedBudget:parseFloat(i),motivation:c,proposedStartDate:m,proposedEndDate:x})},className:"space-y-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"proposedBudget",children:"Proposed Budget (R)"}),(0,o.jsx)("input",{type:"number",id:"proposedBudget",step:"0.01",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:i,onChange:e=>d(e.target.value),required:!0})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"motivation",children:"Motivation / Details"}),(0,o.jsx)("textarea",{id:"motivation",rows:"4",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:c,onChange:e=>u(e.target.value),required:!0})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"proposedStartDate",children:"Proposed Start Date"}),(0,o.jsx)("input",{type:"date",id:"proposedStartDate",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:m,onChange:e=>p(e.target.value),required:!0})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"proposedEndDate",children:"Proposed End Date"}),(0,o.jsx)("input",{type:"date",id:"proposedEndDate",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:x,onChange:e=>g(e.target.value),required:!0})]}),h&&(0,o.jsx)("p",{className:"text-red-500 text-sm",children:h}),(0,o.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[(0,o.jsx)("button",{type:"button",onClick:a,className:"px-6 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition-colors duration-200",children:"Cancel"}),(0,o.jsx)("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200",children:"Submit Quote"})]})]})]})}):null}},7911:function(e,t,a){a.d(t,{I:function(){return n},w:function(){return i}});var o=a(7437),s=a(2265),r=a(2394),l=a(7856);let n=(0,s.createContext)(null),i=e=>{let{children:t}=e,a=(0,l.A)(),{isAuthenticated:i,user:d,isLoading:c}=(0,r.a)(),[u,m]=(0,s.useState)(null),[p,x]=(0,s.useState)([]),[g,h]=(0,s.useState)([]),[b,f]=(0,s.useState)(null),[y,v]=(0,s.useState)(!0),[j,w]=(0,s.useState)([]),[N,k]=(0,s.useState)([]),S=(0,s.useCallback)(async()=>{},[]),C=(0,s.useCallback)(async()=>{},[]),E=(0,s.useCallback)(async()=>{},[]),D=(0,s.useCallback)(async()=>{},[i,d]),_=(0,s.useCallback)(async()=>{},[i,null==b?void 0:b.id]),P=(0,s.useCallback)(async()=>{},[i,null==b?void 0:b.id,null==b?void 0:b.role]);(0,s.useEffect)(()=>{(async()=>{v(!0),await Promise.all([S(),C(),E()]),v(!1)})()},[S,C,E]),(0,s.useEffect)(()=>{i?D():(f(null),w([]),k([]))},[i,D]),(0,s.useEffect)(()=>{(null==b?void 0:b.id)&&i&&(_(),P())},[null==b?void 0:b.id,i,_,P]);let q={branding:u,pricingPlans:p,publicProblems:g,userProfile:b,myRequests:j,myQuotes:N,fetchMyRequests:_,fetchPublicProblems:E,fetchMyQuotes:P,isAuthenticated:i,user:d,isLoading:c||y,login:(null==a?void 0:a.login)||(()=>console.log("Login not available")),logout:(null==a?void 0:a.logout)||(()=>console.log("Logout not available"))};return(0,o.jsx)(n.Provider,{value:q,children:t})}},7856:function(e,t,a){a.d(t,{A:function(){return r}});var o=a(9831);let s=null;function r(){if(!s){let e="39e32132-4994-4c0c-90db-05150db4054e",t="pck_vzrmv65na39bvj84erejggxshygga2vxrvtkj1n1cfg5g";if(!e||!t)return console.error("Stack Auth environment variables (NEXT_PUBLIC_STACK_PROJECT_ID or NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY) are not set. Please ensure they are configured in your Netlify Environment Variables AND your local .env file. Skipping StackClientApp initialization on client due to missing keys."),{login:()=>console.log("Login not configured, missing keys."),logout:()=>console.log("Logout not configured, missing keys.")};s=new o.f({projectId:e,publishableClientKey:t})}return s}},9205:function(e,t,a){a.d(t,{Z:function(){return u}});var o=a(5583),s=a(6796),r=a(2265);let l=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&a.indexOf(e)===t).join(" ")};var i=a(1780),d={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let c=(0,r.forwardRef)((e,t)=>{var{color:a="currentColor",size:l=24,strokeWidth:c=2,absoluteStrokeWidth:u,className:m="",children:p,iconNode:x}=e,g=(0,s._)(e,["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"]);return(0,r.createElement)("svg",(0,o._)((0,i._)((0,o._)({ref:t},d),{width:l,height:l,stroke:a,strokeWidth:u?24*Number(c)/Number(l):c,className:n("lucide",m)}),g),[...x.map(e=>{let[t,a]=e;return(0,r.createElement)(t,a)}),...Array.isArray(p)?p:[p]])}),u=(e,t)=>{let a=(0,r.forwardRef)((a,i)=>{var{className:d}=a,u=(0,s._)(a,["className"]);return(0,r.createElement)(c,(0,o._)({ref:i,iconNode:t,className:n("lucide-".concat(l(e)),d)},u))});return a.displayName="".concat(e),a}},5252:function(e,t,a){a.d(t,{Z:function(){return o}});let o=(0,a(9205).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},2489:function(e,t,a){a.d(t,{Z:function(){return o}});let o=(0,a(9205).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}}]);